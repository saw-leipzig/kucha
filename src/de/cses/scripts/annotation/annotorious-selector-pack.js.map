{"version":3,"file":"annotorious-selector-pack.js","mappings":"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","sources":["webpack://Annotorious.SelectorPack/webpack/universalModuleDefinition","webpack://Annotorious.SelectorPack/./node_modules/css-loader/dist/runtime/api.js","webpack://Annotorious.SelectorPack/./node_modules/css-loader/dist/runtime/cssWithMappingToString.js","webpack://Annotorious.SelectorPack/./node_modules/rbush/rbush.min.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/fast-deep-equal/index.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/tiny-emitter/index.js","webpack://Annotorious.SelectorPack/./src/index.scss","webpack://Annotorious.SelectorPack/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://Annotorious.SelectorPack/webpack/bootstrap","webpack://Annotorious.SelectorPack/webpack/runtime/compat get default export","webpack://Annotorious.SelectorPack/webpack/runtime/define property getters","webpack://Annotorious.SelectorPack/webpack/runtime/hasOwnProperty shorthand","webpack://Annotorious.SelectorPack/webpack/runtime/nonce","webpack://Annotorious.SelectorPack/../annotorious/node_modules/uuid/dist/esm-browser/rng.js","webpack://Annotorious.SelectorPack/../annotorious/src/util/Touch.js","webpack://Annotorious.SelectorPack/../annotorious/src/util/SVG.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/uuid/dist/esm-browser/regex.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/uuid/dist/esm-browser/validate.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/uuid/dist/esm-browser/stringify.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/uuid/dist/esm-browser/v4.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/@recogito/recogito-client-core/src/WebAnnotation.js","webpack://Annotorious.SelectorPack/../annotorious/node_modules/@recogito/recogito-client-core/src/Selection.js","webpack://Annotorious.SelectorPack/../annotorious/src/tools/Tool.js","webpack://Annotorious.SelectorPack/../annotorious/src/tools/EditableShape.js","webpack://Annotorious.SelectorPack/../annotorious/src/selectors/RectFragment.js","webpack://Annotorious.SelectorPack/./src/point/Point.js","webpack://Annotorious.SelectorPack/./src/point/EditablePoint.js","webpack://Annotorious.SelectorPack/./src/point/PointTool.js","webpack://Annotorious.SelectorPack/../annotorious/src/selectors/EmbeddedSVG.js","webpack://Annotorious.SelectorPack/./src/circle/Circle.js","webpack://Annotorious.SelectorPack/./src/circle/CircleMask.js","webpack://Annotorious.SelectorPack/./src/circle/RubberbandCircle.js","webpack://Annotorious.SelectorPack/../annotorious/src/util/Formatting.js","webpack://Annotorious.SelectorPack/./src/circle/EditableCircle.js","webpack://Annotorious.SelectorPack/./src/circle/RubberbandCircleTool.js","webpack://Annotorious.SelectorPack/./src/ellipse/Ellipse.js","webpack://Annotorious.SelectorPack/./src/ellipse/EllipseMask.js","webpack://Annotorious.SelectorPack/./src/ellipse/RubberbandEllipse.js","webpack://Annotorious.SelectorPack/./src/ellipse/EditableEllipse.js","webpack://Annotorious.SelectorPack/./src/ellipse/RubberbandEllipseTool.js","webpack://Annotorious.SelectorPack/./src/freehand/RubberbandFreehand.js","webpack://Annotorious.SelectorPack/./src/freehand/EditableFreehand.js","webpack://Annotorious.SelectorPack/./src/freehand/RubberbandFreehandTool.js","webpack://Annotorious.SelectorPack/./src/multipolygon/RubberbandMultipolygon.js","webpack://Annotorious.SelectorPack/../annotorious/src/util/Geom2D.js","webpack://Annotorious.SelectorPack/./src/index.scss?7223","webpack://Annotorious.SelectorPack/./src/multipolygon/EditableMultipolygon.js","webpack://Annotorious.SelectorPack/./src/multipolygon/RubberbandMultipolygonTool.js","webpack://Annotorious.SelectorPack/./src/line/LineMask.js","webpack://Annotorious.SelectorPack/./src/line/RubberbandLine.js","webpack://Annotorious.SelectorPack/./src/line/EditableLine.js","webpack://Annotorious.SelectorPack/./src/line/RubberbandLineTool.js","webpack://Annotorious.SelectorPack/./src/index.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Annotorious\"] = factory();\n\telse\n\t\troot[\"Annotorious\"] = root[\"Annotorious\"] || {}, root[\"Annotorious\"][\"SelectorPack\"] = factory();\n})(self, () => {\nreturn ","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === \"string\") {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, \"\"]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]); if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nmodule.exports = function cssWithMappingToString(item) {\n  var _item = _slicedToArray(item, 4),\n      content = _item[1],\n      cssMapping = _item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    // eslint-disable-next-line no-undef\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","!function(t,i){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=i():\"function\"==typeof define&&define.amd?define(i):(t=t||self).RBush=i()}(this,function(){\"use strict\";function t(t,r,e,a,h){!function t(n,r,e,a,h){for(;a>e;){if(a-e>600){var o=a-e+1,s=r-e+1,l=Math.log(o),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(o-f)/o)*(s-o/2<0?-1:1),m=Math.max(e,Math.floor(r-s*f/o+u)),c=Math.min(a,Math.floor(r+(o-s)*f/o+u));t(n,r,m,c,h)}var p=n[r],d=e,x=a;for(i(n,e,r),h(n[a],p)>0&&i(n,e,a);d<x;){for(i(n,d,x),d++,x--;h(n[d],p)<0;)d++;for(;h(n[x],p)>0;)x--}0===h(n[e],p)?i(n,e,x):i(n,++x,a),x<=r&&(e=x+1),r<=x&&(a=x-1)}}(t,r,e||0,a||t.length-1,h||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var h=t.children[a];o(e,t.leaf?r(h):h)}return e}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var h=[n,r];h.length;)if(!((r=h.pop())-(n=h.pop())<=e)){var o=n+Math.ceil((r-n)/e/2)*e;t(i,o,n,r,a),h.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var h=i.children[a],o=i.leaf?r(h):h;c(t,o)&&(i.leaf?n.push(h):m(t,o)?this._all(h,n):e.push(h))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,h=this.data,o=this.toBBox(t),s=[],l=[];h||s.length;){if(h||(h=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),h.leaf){var f=e(t,h.children,i);if(-1!==f)return h.children.splice(f,1),s.push(h),this._condense(s),this}a||h.leaf||!m(h,o)?r?(n++,h=r.children[n],a=!1):h=null:(s.push(h),l.push(n),n=0,r=h,h=h.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,h=n-i+1,o=this._maxEntries;if(h<=o)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(h/o),l=s*Math.ceil(Math.sqrt(o));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,h=void 0,o=0;o<i.children.length;o++){var s=i.children[o],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,h=s):u===a&&l<e&&(e=l,h=s)}i=h||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),o(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var h=this._chooseSplitIndex(n,e,r),o=p(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,o,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=h(t,0,p,this.toBBox),x=h(t,p,n,this.toBBox),v=(e=d,a=x,o=void 0,s=void 0,l=void 0,u=void 0,o=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-o)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=h(t,0,i,e),s=h(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];o(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];o(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)o(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r});\n","'use strict';\n\n// do not edit .js files directly - edit src/index.jst\n\n\n\nmodule.exports = function equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    if (a.constructor !== b.constructor) return false;\n\n    var length, i, keys;\n    if (Array.isArray(a)) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n\n\n    if (a.constructor === RegExp) return a.source === b.source && a.flags === b.flags;\n    if (a.valueOf !== Object.prototype.valueOf) return a.valueOf() === b.valueOf();\n    if (a.toString !== Object.prototype.toString) return a.toString() === b.toString();\n\n    keys = Object.keys(a);\n    length = keys.length;\n    if (length !== Object.keys(b).length) return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      var key = keys[i];\n\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  // true if both NaN, false otherwise\n  return a!==a && b!==b;\n};\n","function E () {\n  // Keep this empty so it's easier to inherit from\n  // (via https://github.com/lipsmack from https://github.com/scottcorgan/tiny-emitter/issues/3)\n}\n\nE.prototype = {\n  on: function (name, callback, ctx) {\n    var e = this.e || (this.e = {});\n\n    (e[name] || (e[name] = [])).push({\n      fn: callback,\n      ctx: ctx\n    });\n\n    return this;\n  },\n\n  once: function (name, callback, ctx) {\n    var self = this;\n    function listener () {\n      self.off(name, listener);\n      callback.apply(ctx, arguments);\n    };\n\n    listener._ = callback\n    return this.on(name, listener, ctx);\n  },\n\n  emit: function (name) {\n    var data = [].slice.call(arguments, 1);\n    var evtArr = ((this.e || (this.e = {}))[name] || []).slice();\n    var i = 0;\n    var len = evtArr.length;\n\n    for (i; i < len; i++) {\n      evtArr[i].fn.apply(evtArr[i].ctx, data);\n    }\n\n    return this;\n  },\n\n  off: function (name, callback) {\n    var e = this.e || (this.e = {});\n    var evts = e[name];\n    var liveEvents = [];\n\n    if (evts && callback) {\n      for (var i = 0, len = evts.length; i < len; i++) {\n        if (evts[i].fn !== callback && evts[i].fn._ !== callback)\n          liveEvents.push(evts[i]);\n      }\n    }\n\n    // Remove event from queue to prevent memory leak\n    // Suggested by https://github.com/lazd\n    // Ref: https://github.com/scottcorgan/tiny-emitter/commit/c6ebfaa9bc973b33d110a84a307742b7cf94c953#commitcomment-5024910\n\n    (liveEvents.length)\n      ? e[name] = liveEvents\n      : delete e[name];\n\n    return this;\n  }\n};\n\nmodule.exports = E;\nmodule.exports.TinyEmitter = E;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".a9s-selection.improved-polygon .a9s-rubberband{fill:rgba(255,255,255,.15);stroke-width:1px;stroke:rgba(0,0,0,.3)}.a9s-selection.improved-polygon .a9s-inner,.a9s-annotation.improved-polygon.editable .a9s-inner{stroke-width:2px;stroke:#fff;stroke-dasharray:5 3}.a9s-annotation.improved-polygon.editable .a9s-inner:hover{fill:transparent}.a9s-selection.improved-polygon .a9s-outer,.a9s-annotation.improved-polygon.editable .a9s-outer{stroke-width:4px;stroke:rgba(0,0,0,.35)}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-outer,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-outer{stroke-width:1;stroke:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner{stroke-width:2;stroke:#fff;fill:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner:hover,.a9s-annotation.improved-polygon.editable .a9s-handle.selected .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner:hover{fill:#fff;color:green}.selectedCorner{fill:#fff !important}.selectedCorner .a9s-handle-inner{fill:#fff !important;color:green}.a9s-annotation.improved-polygon.editable .a9s-midpoint{display:none;fill:rgba(255,255,255,.65);stroke-width:1;stroke:rgba(0,0,0,.65)}.a9s-annotation.improved-polygon.editable:hover .a9s-midpoint{display:block}.a9s-annotation.improved-polygon.editable .a9s-midpoint:hover{fill:#fff}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/index.scss\"],\"names\":[],\"mappings\":\"AACA,gDACE,0BAAA,CACA,gBAAA,CACA,qBAAA,CAIF,gGAEE,gBAAA,CACA,WAAA,CACA,oBAAA,CAGF,2DACE,gBAAA,CAGF,gGAEE,gBAAA,CACA,sBAAA,CAIF,sIAEE,cAAA,CACA,WAAA,CACA,WAAA,CAGF,sIAEE,cAAA,CACA,WAAA,CACA,SAAA,CACA,WAAA,CAGF,mOAGE,SAAA,CACA,WAAA,CAEF,gBACE,oBAAA,CAEF,kCACE,oBAAA,CACA,WAAA,CAGF,wDACE,YAAA,CACA,0BAAA,CACA,cAAA,CACA,sBAAA,CAGF,8DACE,aAAA,CAGF,8DACE,SAAA\",\"sourcesContent\":[\"/** Rubberband **/\\n.a9s-selection.improved-polygon .a9s-rubberband {\\n  fill:rgba(255,255,255,0.15);\\n  stroke-width:1px;\\n  stroke:rgba(0, 0, 0, 0.3);\\n}\\n\\n/** Polygon **/\\n.a9s-selection.improved-polygon .a9s-inner,\\n.a9s-annotation.improved-polygon.editable .a9s-inner {\\n  stroke-width:2px;\\n  stroke:#fff;\\n  stroke-dasharray:5 3;\\n}\\n\\n.a9s-annotation.improved-polygon.editable .a9s-inner:hover {\\n  fill:transparent;\\n}\\n\\n.a9s-selection.improved-polygon .a9s-outer,\\n.a9s-annotation.improved-polygon.editable .a9s-outer {\\n  stroke-width:4px;\\n  stroke:rgba(0, 0, 0, 0.35);\\n}\\n\\n/** Corner handles **/\\n.a9s-selection.improved-polygon .a9s-handle .a9s-handle-outer,\\n.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-outer {\\n  stroke-width:1;\\n  stroke:#000;\\n  color:green;\\n}\\n\\n.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner,\\n.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner {\\n  stroke-width:2;\\n  stroke:#fff;\\n  fill:#000;\\n  color:green;\\n}\\n\\n.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner:hover,\\n.a9s-annotation.improved-polygon.editable .a9s-handle.selected .a9s-handle-inner,\\n.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner:hover {\\n  fill:#fff;\\n  color:green;\\n}\\n.selectedCorner {\\n  fill: white!important;\\n}\\n.selectedCorner .a9s-handle-inner{\\n  fill: white!important;\\n  color:green;\\n}\\n/** Midpoints **/\\n.a9s-annotation.improved-polygon.editable .a9s-midpoint {\\n  display:none;\\n  fill:rgba(255,255,255,0.65);\\n  stroke-width:1;\\n  stroke:rgba(0,0,0,0.65);\\n}\\n\\n.a9s-annotation.improved-polygon.editable:hover .a9s-midpoint {\\n  display:block;\\n}\\n\\n.a9s-annotation.improved-polygon.editable .a9s-midpoint:hover {\\n  fill:#fff;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDom.length; i++) {\n    if (stylesInDom[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var index = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3]\n    };\n\n    if (index !== -1) {\n      stylesInDom[index].references++;\n      stylesInDom[index].updater(obj);\n    } else {\n      stylesInDom.push({\n        identifier: identifier,\n        updater: addStyle(obj, options),\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.media ? \"@media \".concat(obj.media, \" {\").concat(obj.css, \"}\") : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && typeof btoa !== 'undefined') {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDom[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDom[_index].references === 0) {\n        stylesInDom[_index].updater();\n\n        stylesInDom.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","__webpack_require__.nc = undefined;","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","const SIM_EVENTS = {\n  touchstart: 'mousedown',\n  touchmove: 'mousemove',\n  touchend: 'mouseup'\n}\n\nexport const isTouchDevice = () =>\n  'ontouchstart' in window ||\n    navigator.maxTouchPoints > 0 ||\n      navigator.msMaxTouchPoints > 0;\n\nexport const enableTouchTranslation = el => {\n\n  let pressAndHoldTrigger = null;\n\n  const simulateEvent = (type, e) => new MouseEvent(type, {\n    screenX: e.screenX,\n    screenY: e.screenY,\n    clientX: e.clientX,\n    clientY: e.clientY,\n    pageX: e.pageX,\n    pageY: e.pageY,\n    bubbles: true\n  });\n\n  const touchHandler = evt => {\n    const touch = evt.changedTouches[0];\n    const simulatedEvent = simulateEvent(SIM_EVENTS[evt.type], touch);\n\n    touch.target.dispatchEvent(simulatedEvent);\n    evt.preventDefault();\n\n    if (evt.type === 'touchstart' || evt.type === 'touchmove') {\n      pressAndHoldTrigger && clearTimeout(pressAndHoldTrigger);\n\n      pressAndHoldTrigger = setTimeout(() => {\n        const simulatedEvent = simulateEvent('dblclick', touch);\n        touch.target.dispatchEvent(simulatedEvent);\n      }, 800);\n    }\n\n    if (evt.type === 'touchend')\n      pressAndHoldTrigger && clearTimeout(pressAndHoldTrigger);\n  }\n\n  el.addEventListener('touchstart', touchHandler, true);\n  el.addEventListener('touchmove', touchHandler, true);\n  el.addEventListener('touchend', touchHandler, true);\n  el.addEventListener('touchcancel', touchHandler, true);\n\n}","export const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n\nconst getClassNames = el => {\n  const attr = el.getAttribute('class');\n  return attr ? new Set(attr.split(' ')) : new Set();\n}\n\n// IE11 doesn't support adding/removing classes to SVG elements except \n// via .setAttribute\nexport const addClass = (el, className) => {\n  const classNames = getClassNames(el);\n  classNames.add(className);\n  el.setAttribute('class', Array.from(classNames).join(' '));\n}\n\nexport const removeClass = (el, className) => {\n  const classNames = getClassNames(el);\n  classNames.delete(className);\n\n  if (classNames.size === 0)\n    el.removeAttribute('class');\n  else\n    el.setAttribute('class', Array.from(classNames).join(' '));\n}\n\nexport const hasClass = (el, className) =>\n  getClassNames(el).has(className);","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","import { v4 as uuid } from 'uuid';\nimport equals from 'fast-deep-equal';\n\nexport default class WebAnnotation {\n\n  constructor(annotation, opts) {\n    this.underlying = annotation;\n    this.opts = opts;\n  }\n\n  /** For convenience - creates an empty web annotation **/\n  static create = args => {\n    const stub = {\n      '@context': 'http://www.w3.org/ns/anno.jsonld',\n      'type': 'Annotation',\n      'id': `#${uuid()}`,\n      'body': []\n    };\n\n    return new WebAnnotation({ ...stub, ...args });\n  }\n\n  /** Creates a copy of this annotation **/\n  clone = (opt_props, opt_opts) => {\n    return new WebAnnotation({ ...this.underlying, ...opt_props}, { ...this.opts, ...opt_opts });\n  }\n\n  /** An equality check based on the underlying object **/\n  isEqual(other) {\n    if (other?.type !== 'Annotation') {\n      return false;\n    } else if (this.underlying === other.underlying) {\n      return true;\n    } else if (!this.underlying.id || !other.underlying.id) {\n      return false;\n    } else {\n      return equals(this.underlying, other.underlying);\n    }\n  }\n\n  get readOnly() {\n    return this.opts?.readOnly;\n  }\n\n  /*************************************/\n  /* Getters to forward properties of  */\n  /* the underlying annotation         */\n  /*************************************/\n\n  get id() {\n    return this.underlying.id;\n  }\n\n  get context() {\n    return this.underlying['@context'];\n  }\n\n  get type() {\n    return this.underlying.type;\n  }\n\n  get motivation() {\n    return this.underlying.motivation;\n  }\n\n  get body() {\n    return this.underlying.body;\n  }\n\n  get target() {\n    return this.underlying.target;\n  }\n\n  /** Same as .body, but guaranteed to return an array **/\n  get bodies() {\n    return (Array.isArray(this.underlying.body)) ?\n      this.underlying.body : [ this.underlying.body ];\n  }\n\n  /** Only bodies are meant to be mutated by the application **/\n  set bodies(bodies) {\n    this.underlying.body = bodies;\n  }\n\n  /** Same as .target, but guaranteed to return an array **/\n  get targets() {\n    return (Array.isArray(this.underlying.target)) ?\n      this.underlying.target : [ this.underlying.target ];\n  }\n\n  /*****************************************/\n  /* Various access helpers and shorthands */\n  /*****************************************/\n\n  /** Selector of the given type **/\n  selector = type => {\n    const { target } = this.underlying;\n\n    if (target.selector) {\n      // Normalize to array\n      const selectors = Array.isArray(target.selector) ?\n        target.selector : [ target.selector ];\n\n      return selectors.find(s => s.type === type);\n    }\n  }\n\n  /** Shorthand for the 'exact' field of the TextQuoteSelector **/\n  get quote() {\n    return this.selector('TextQuoteSelector')?.exact;\n  }\n\n  /** Shorthand for the 'start' field of the TextPositionSelector **/\n  get start() {\n    return this.selector('TextPositionSelector')?.start;\n  }\n\n  /** Shorthand for the 'end' field of the TextPositionSelector **/\n  get end() {\n    return this.selector('TextPositionSelector')?.end;\n  }\n\n}\n","import WebAnnotation from './WebAnnotation';\nimport { v4 as uuid } from 'uuid';\nimport equals from 'fast-deep-equal';\n\n/**\n * An \"annotation in draft mode\". Really the same\n * data structure, but as a separate class so we can\n * tell things apart properly.\n */\nexport default class Selection {\n\n  constructor(target, body) {\n    this.underlying = {\n      '@context': 'http://www.w3.org/ns/anno.jsonld',\n      type: 'Selection',\n      body: body || [],\n      target\n    }\n  }\n\n  /** Creates a copy of this selection **/\n  clone = opt_props => {\n    // Deep-clone\n    const cloned = new Selection();\n    cloned.underlying = JSON.parse(JSON.stringify(this.underlying));\n\n    if (opt_props)\n      cloned.underlying = { ...cloned.underlying, ...opt_props };\n\n    return cloned;\n  }\n\n  get context() {\n    return this.underlying['@context'];\n  }\n\n  get type() {\n    return this.underlying.type;\n  }\n\n  get body() {\n    return this.underlying.body;\n  }\n\n  get target() {\n    return this.underlying.target;\n  }\n\n  get targets() {\n    return (Array.isArray(this.underlying.target)) ?\n      this.underlying.target : [ this.underlying.target ];\n  }\n\n  /** For consistency with WebAnnotation **/\n  isEqual(other) {\n    if (!other) {\n      return false;\n    } else {\n      return equals(this.underlying, other.underlying);\n    }\n  }\n\n  get bodies() {\n    return (Array.isArray(this.underlying.body)) ?\n      this.underlying.body : [ this.underlying.body ];\n  }\n\n  selector = type => {\n    const { target } = this.underlying;\n\n    if (target.selector) {\n      // Normalize to array\n      const selectors = Array.isArray(target.selector) ?\n        target.selector : [ target.selector ];\n\n      return selectors.find(s => s.type === type);\n    }\n  }\n\n  /** Shorthand for the 'exact' field of the TextQuoteSelector **/\n  get quote() {\n    return this.selector('TextQuoteSelector')?.exact;\n  }\n\n  /*******************************************/\n  /* Selection-specific properties & methods */\n  /*******************************************/\n\n  get isSelection() {\n    return true;\n  }\n\n  toAnnotation = () => {\n    const a = Object.assign({}, this.underlying, {\n      'type': 'Annotation',\n      'id': `#${uuid()}`\n    });\n\n    return new WebAnnotation(a);\n  }\n\n}\n","import EventEmitter from 'tiny-emitter';\nimport { isTouchDevice } from '../util/Touch';\nimport { SVG_NAMESPACE } from '../util/SVG';\n\nconst IMPLEMENTATION_MISSING = \"An implementation is missing\";\n\nconst isTouch = isTouchDevice();\n\n/**\n * A commmon base class for Tools and EditableShapes\n */\nexport class ToolLike extends EventEmitter {\n\n  constructor(g, config, env) {\n    super();\n\n    this.svg = g.closest('svg');\n\n    this.g = g;\n    this.config = config;\n    this.env = env;\n\n    // Default image scale\n    this.scale = 1;\n\n    // Bit of a hack. If we are dealing with a 'real' image, we enable\n    // reponsive mode. OpenSeadragon handles scaling in a different way,\n    // so we don't need responsive mode.\n    const { image } = env;\n    if (image instanceof Element || image instanceof HTMLDocument)\n      this.enableResponsive();\n  }\n\n  /**\n   * Implementations MAY extend this (calling super),\n   * to destroy SVG elements, mask, etc.\n   */\n  destroy() {\n    if (this.resizeObserver)\n      this.resizeObserver.disconnect();\n\n    this.resizeObserver = null;\n  }\n\n  enableResponsive = () => {\n    if (window.ResizeObserver) {\n      this.resizeObserver = new ResizeObserver(() => {\n        const svgBounds = this.svg.getBoundingClientRect();\n        const { width, height } = this.svg.viewBox.baseVal;\n\n        this.scale = Math.max(\n          width / svgBounds.width,\n          height / svgBounds.height\n        );\n\n        if (this.onScaleChanged)\n          this.onScaleChanged(this.scale);\n      });\n\n      this.resizeObserver.observe(this.svg.parentNode);\n    }\n  }\n\n  getSVGPoint = evt => {\n    const pt = this.svg.createSVGPoint();\n\n    if (isTouch) {\n      const bbox = this.svg.getBoundingClientRect();\n\n      const x = evt.clientX - bbox.x;\n      const y = evt.clientY - bbox.y;\n\n      const { left, top } = this.svg.getBoundingClientRect();\n      pt.x = x + left;\n      pt.y = y + top;\n\n      return pt.matrixTransform(this.g.getScreenCTM().inverse());\n    } else {\n      pt.x = evt.offsetX;\n      pt.y = evt.offsetY;\n\n      return pt.matrixTransform(this.g.getCTM().inverse());\n    }\n  }\n\n  /*********************************/\n  /*  Helpers for drawing handles  */\n  /*********************************/\n\n  drawHandle = (x, y) => {\n    const containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    containerGroup.setAttribute('class', 'a9s-handle');\n\n    const group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    const drawCircle = r => {\n      const c = document.createElementNS(SVG_NAMESPACE, 'circle');\n      c.setAttribute('cx', x);\n      c.setAttribute('cy', y);\n      c.setAttribute('r', r);\n      c.setAttribute('transform-origin', `${x} ${y}`);\n      return c;\n    }\n\n    const radius = this.config.handleRadius || 6;\n\n    const inner = drawCircle(radius);\n    inner.setAttribute('class', 'a9s-handle-inner')\n\n    const outer = drawCircle(radius + 1);\n    outer.setAttribute('class', 'a9s-handle-outer')\n\n    group.appendChild(outer);\n    group.appendChild(inner);\n\n    containerGroup.appendChild(group);\n    return containerGroup;\n  }\n\n  setHandleXY = (handle, x, y) => {\n    const inner = handle.querySelector('.a9s-handle-inner');\n    inner.setAttribute('cx', x);\n    inner.setAttribute('cy', y);\n    inner.setAttribute('transform-origin', `${x} ${y}`);\n\n    const outer = handle.querySelector('.a9s-handle-outer');\n    outer.setAttribute('cx', x);\n    outer.setAttribute('cy', y);\n    outer.setAttribute('transform-origin', `${x} ${y}`);\n  }\n\n  getHandleXY = handle => {\n    const outer = handle.querySelector('.a9s-handle-outer');\n    return {\n      x: parseFloat(outer.getAttribute('cx')),\n      y: parseFloat(outer.getAttribute('cy'))\n    }\n  }\n\n  scaleHandle = handle => {\n    const inner = handle.querySelector('.a9s-handle-inner');\n    const outer = handle.querySelector('.a9s-handle-outer');\n\n    const radius = this.scale * (this.config.handleRadius || 6);\n\n    inner.setAttribute('r', radius);\n    outer.setAttribute('r', radius);\n  }\n\n}\n\n/**\n * Base class that adds some convenience stuff for tool plugins.\n */\nexport default class Tool extends ToolLike {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    // We'll keep a flag set to false until\n    // the user has started moving, so we can\n    // fire the startSelection event\n    this.started = false;\n  }\n\n  attachListeners = ({ mouseMove, mouseUp, dblClick }) => {\n    // Handle SVG conversion on behalf of tool implementations\n    if (mouseMove) {\n      this.mouseMove = evt => {\n        const { x , y } = this.getSVGPoint(evt);\n\n        if (!this.started) {\n          this.emit('startSelection', { x, y });\n          this.started = true;\n        }\n\n        mouseMove(x, y, evt);\n      }\n\n      // Mouse move goes on SVG element\n      this.svg.addEventListener('mousemove', this.mouseMove);\n    }\n\n    if (mouseUp) {\n      this.mouseUp = evt => {\n        if (evt.button !== 0) return;  // left click\n        const { x , y } = this.getSVGPoint(evt);\n        mouseUp(x, y, evt);\n      }\n\n      // Mouse up goes on doc, so we capture events outside, too\n      document.addEventListener('mouseup', this.mouseUp);\n    }\n\n    if (dblClick) {\n      this.dblClick = evt => {\n        const { x , y } = this.getSVGPoint(evt);\n        dblClick(x, y, evt);\n      }\n\n      document.addEventListener('dblclick', this.dblClick);\n    }\n\n  }\n\n  detachListeners = () => {\n    if (this.mouseMove)\n      this.svg.removeEventListener('mousemove', this.mouseMove);\n\n    if (this.mouseUp)\n      document.removeEventListener('mouseup', this.mouseUp);\n\n    if (this.dblClick)\n      document.removeEventListener('dblclick', this.dblClick);\n  }\n\n  /**\n   * If startOnSingleClick is true, the tool starts on single click\n   * as well as drag. If false, starting strictly requires drag!\n   */\n  start = (evt, startOnSingleClick) => {\n    // Handle SVG conversion on behalf of tool implementations\n    const { x, y } = this.getSVGPoint(evt);\n    \n    // Constrain the initial coordinates (x, y) to be within the image bounds\n    const { naturalWidth, naturalHeight } = this.env.image;\n    const startX = x < 0 ? 0 : (x > naturalWidth ? naturalWidth : x);\n    const startY = y < 0 ? 0 : (y > naturalHeight ? naturalHeight : y);\n    \n    this.startDrawing(startX, startY, startOnSingleClick, evt);\n  }\n\n  /**\n   * Tool implementations MUST override these\n   */\n\n  get isDrawing() {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n  startDrawing = evt => {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n  createEditableShape = (annotation, formatters) => {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n}\n\n// In addition, Tool implementations need to implement the following static methods\n\n// Tool.identifier = '...'\n\nTool.supports = annotation => {\n  throw new Error(IMPLEMENTATION_MISSING);\n}\n\n// Just some convenience shortcuts to client-core, for quicker\n// importing in plugins. (In a way, the intention is to make the\n// Tool class serve as a kind of mini-SDK).\nexport { default as Selection } from '@recogito/recogito-client-core/src/Selection';\nexport { default as WebAnnotation } from '@recogito/recogito-client-core/src/WebAnnotation';\n","import { ToolLike } from './Tool';\n\nconst IMPLEMENTATION_MISSING = \"An implementation is missing\";\n\nexport default class EditableShape extends ToolLike {\n\n  constructor(annotation, g, config, env) {\n    super(g, config, env);\n\n    this.annotation = annotation;\n  }\n  \n  /**\n   * Implementations MUST override this method!\n   * \n   * Must return the 'g' element with the a9s-annotation class.\n   */\n  get element() {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n  /**\n   * Implementations MUST override this method!\n   * \n   * The annotation argument MUST be used to update\n   * the current state of the shape. It MUST NOT\n   * be stored as 'this.annotation'! 'this.annotation'\n   * MUST remain the original annotation at the time\n   * this EditableShape was created, because we will\n   * need it again in case the user cancels editing.\n   * \n   * Thinking of it in React terms, 'this.annotation'\n   * has the same purpose as props.annotation, whereas\n   * this method affects state.\n   */\n  updateState = annotation => {\n    throw new Error(IMPLEMENTATION_MISSING);\n  }\n\n}\n","import { SVG_NAMESPACE, addClass } from '../util/SVG';\n\n/** \n * Parses a W3C Web Annotation FragmentSelector conforming\n * to the Media Fragments spec. Supports (well-formed) xywh=pixel\n * and xywh=percent fragments. \n */\nexport const parseRectFragment = (annotation, image) => {\n  const selector = annotation.selector('FragmentSelector');\n\n  if (selector?.conformsTo.startsWith('http://www.w3.org/TR/media-frags')) {\n    const { value } = selector;\n  \n    const format = value.includes(':') ? value.substring(value.indexOf('=') + 1, value.indexOf(':')) : 'pixel';\n    const coords = value.includes(':') ? value.substring(value.indexOf(':') + 1) : value.substring(value.indexOf('=') + 1);\n\n    let [ x, y, w, h ] = coords.split(',').map(parseFloat);\n\n    if (format.toLowerCase() === 'percent') {\n      x = x * image.naturalWidth  / 100;\n      y = y * image.naturalHeight / 100;\n      w = w * image.naturalWidth  / 100;\n      h = h * image.naturalHeight / 100;\n    }\n\n    return { x, y, w, h };\n  }\n}\n\n/** \n * Serializes a (x, y, w, h)-tuple as Media Fragment selector\n * using pixel coordinates.\n */\nconst toPixelRectFragment = (x, y, w, h, image) => ({\n  source: image?.src,\n  selector: {\n    type: \"FragmentSelector\",\n    conformsTo: \"http://www.w3.org/TR/media-frags/\",\n    value: `xywh=pixel:${x},${y},${w},${h}`\n  }\n});\n\n/** \n * Serializes a (x, y, w, h)-tuple as Media Fragment selector \n * using percent coordinates.\n */\nconst toPercentRectFragment = (x, y, w, h, image) => {\n  const px = x / image.naturalWidth  * 100;\n  const py = y / image.naturalHeight * 100;\n  const pw = w / image.naturalWidth  * 100;\n  const ph = h / image.naturalHeight * 100;\n\n  return {\n    source: image.src,\n    selector: {\n      type: \"FragmentSelector\",\n      conformsTo: \"http://www.w3.org/TR/media-frags/\",\n      value: `xywh=percent:${px},${py},${pw},${ph}`\n    }\n  }\n}\n\nexport const toRectFragment = (x, y, w, h, image, fragmentUnit) =>\n  fragmentUnit?.toLowerCase() === 'percent' ?\n    toPercentRectFragment(x, y, w, h, image) :\n    toPixelRectFragment(x, y, w, h, image);\n\n/** Shorthand to apply the given (x, y, w, h) to the SVG shape **/\nconst setXYWH = (shape, x, y, w, h) => {\n  shape.setAttribute('x', x);\n  shape.setAttribute('y', y);\n  shape.setAttribute('width', w);\n  shape.setAttribute('height', h);\n}\n\n\nconst setPointXY = (shape, x, y) => {\n  shape.setAttribute('cx', x);\n  shape.setAttribute('cy', y);\n  shape.setAttribute('r', 7); // TODO make configurable\n}\n\nexport const drawRectMask = (imageDimensions, x, y, w, h) => {\n  const mask = document.createElementNS(SVG_NAMESPACE, 'path');\n  mask.setAttribute('fill-rule', 'evenodd');\n\n  const { naturalWidth, naturalHeight } = imageDimensions;\n  mask.setAttribute('d', `M0 0 h${naturalWidth} v${naturalHeight} h-${naturalWidth} z M${x} ${y} h${w} v${h} h-${w} z`);\n\n  return mask;\n}\n\nexport const setRectMaskSize = (mask, imageDimensions, x, y, w, h) => {\n  const { naturalWidth, naturalHeight } = imageDimensions;\n  mask.setAttribute('d', `M0 0 h${naturalWidth} v${naturalHeight} h-${naturalWidth} z M${x} ${y} h${w} v${h} h-${w} z`);\n}\n\n/** \n * Draws an SVG rectangle, either from an annotation, or an\n * (x, y, w, h)-tuple.\n */\nexport const drawRect = (arg1, arg2, arg3, arg4) => {\n  const { x, y, w, h } = arg1.type === 'Annotation' || arg1.type === 'Selection' ?\n    parseRectFragment(arg1, arg2) : { x: arg1, y: arg2, w: arg3, h: arg4 };\n\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n\n  if (w === 0 && h === 0) {\n    // Edge case: rect is actually a point\n    addClass(g, 'a9s-point');\n    addClass(g, 'a9s-non-scaling');\n    g.setAttribute('transform-origin', `${x} ${y}`);\n\n    const outerPoint  = document.createElementNS(SVG_NAMESPACE, 'circle');\n    const innerPoint  = document.createElementNS(SVG_NAMESPACE, 'circle');\n\n    innerPoint.setAttribute('class', 'a9s-inner');\n    setPointXY(innerPoint, x, y);\n\n    outerPoint.setAttribute('class', 'a9s-outer');\n    setPointXY(outerPoint, x, y);\n\n    g.appendChild(outerPoint);\n    g.appendChild(innerPoint);  \n  } else {\n    const outerRect = document.createElementNS(SVG_NAMESPACE, 'rect');\n    const innerRect = document.createElementNS(SVG_NAMESPACE, 'rect');\n\n    innerRect.setAttribute('class', 'a9s-inner');\n    setXYWH(innerRect, x, y, w, h);\n\n    outerRect.setAttribute('class', 'a9s-outer');\n    setXYWH(outerRect, x, y, w, h);\n\n    g.appendChild(outerRect);\n    g.appendChild(innerRect);\n  }\n\n  return g;\n}\n\n/** Gets the (x, y, w, h)-values from the attributes of the SVG group **/\nexport const getRectSize = g => {\n  const outer = g.querySelector('.a9s-outer');\n\n  if (outer.nodeName === 'rect') {\n    const x = parseFloat(outer.getAttribute('x'));\n    const y = parseFloat(outer.getAttribute('y'));\n    const w = parseFloat(outer.getAttribute('width'));\n    const h = parseFloat(outer.getAttribute('height'));\n\n    return { x, y, w, h };\n  } else {\n    const x = parseFloat(outer.getAttribute('cx'));\n    const y = parseFloat(outer.getAttribute('cy'));\n\n    return { x, y, w: 0, h: 0 };\n  }\n}\n\n/** Applies the (x, y, w, h)-values to the rects in the SVG group **/\nexport const setRectSize = (g, x, y, w, h) => {\n  const inner = g.querySelector('.a9s-inner');\n  const outer = g.querySelector('.a9s-outer');\n\n  if (outer.nodeName === 'rect') {\n    setXYWH(inner, x, y, w, h);\n    setXYWH(outer, x, y, w, h);  \n  } else {\n    setPointXY(inner, x, y);\n    setPointXY(outer, x, y);\n  }\n}\n\n/** \n * Shorthand to get the area (rectangle w x h) from the \n * annotation's fragment selector. \n */\nexport const rectArea = (annotation, image) => {\n  const { w, h } = parseRectFragment(annotation, image);\n  return w * h;\n}\n\n","import { toRectFragment } from '@recogito/annotorious/src/selectors/RectFragment';\n\nexport const isPoint = annotation =>\n  annotation.target.renderedVia?.name === 'point';\n\nexport const toFragment = (x, y, image, fragmentUnit) => ({\n  ...toRectFragment(x, y, 0, 0, image, fragmentUnit),\n  renderedVia: {\n    name: 'point'\n  }\n});","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { parseRectFragment } from '@recogito/annotorious/src/selectors/RectFragment';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { toFragment } from './Point';\n\nexport default class EditablePoint extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    const { x, y } = parseRectFragment(annotation, env.image);\n\n    this.container = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n\n    this.point = this.drawHandle(x, y);\n    this.point.addEventListener('mousedown', this.onGrab);\n    \n    this.elementGroup.appendChild(this.point);\n\n    this.container.appendChild(this.elementGroup);\n    g.appendChild(this.container);\n\n    // true if te mouse has grabbed the point\n    this.isGrabbed = false;\n  }\n\n  onScaleChanged = () => \n    this.scaleHandle(this.point);\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  onGrab = () => {\n    this.isGrabbed = true;\n  }\n\n  onMouseMove = evt => {\n    if (evt.button !== 0) return;  // left click\n\n    if (this.isGrabbed) {\n      const {x, y} = this.getSVGPoint(evt);\n\n      this.setHandleXY(this.point, x, y);\n\n      const target = toFragment(x, y, this.env.image, this.config.fragmentUnit);\n      this.emit('update', target);\n    }\n  }\n\n  onMouseUp = () => {\n    this.isGrabbed = false;\n  }\n\n  updateState = annotation => {\n    const { x, y } = parseRectFragment(annotation, this.env.image);\n    this.setHandleXY(this.point, x, y);\n  }\n\n  destroy() {\n    this.svg.removeEventListener('mousemove', this.onMouseMove);\n    this.svg.removeEventListener('mouseup', this.onMouseUp);\n\n    this.container.parentNode.removeChild(this.container);\n    super.destroy();\n  }\n\n}","import Tool, { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport EditablePoint from './EditablePoint';\nimport { toFragment, isPoint } from './Point';\n\nexport default class PointTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n  }\n\n  startDrawing = (x, y, _, evt) => {\n    // The top-most existing annotation at this position (if any) \n    const annotation = evt.target.closest('.a9s-annotation')?.annotation;\n\n    // The point drawing tool will ALWAYS create a point annotation,\n    // regardless of whether there's already an annotation underneath.\n    // UNLESS the annotation underneath is itself a point!\n    if (!annotation || !isPoint(annotation)) {\n      const element = this.drawHandle(x, y);\n      this.scaleHandle(element);\n\n      this.g.appendChild(element);\n\n      element.annotation = new Selection(toFragment(x, y, this.env.image, this.config.fragmentUnit));\n\n      this.emit('complete', element);\n    } else {\n      this.emit('cancel')\n    }\n  }\n\n  stop = () => {\n    // Nothing to do\n  }\n\n  get isDrawing() {\n    // Point selection is an instant action - the\n    // tool is never an 'drawing' state\n    return false;\n  }\n  \n  createEditableShape = annotation =>\n    new EditablePoint(annotation, this.g, this.config, this.env);\n\n}\n\nPointTool.identifier = 'point';\n\nPointTool.supports = annotation => {\n  // Not needed, since the target.renderedVia property will be evaluated first\n  return false;\n}","import { SVG_NAMESPACE } from '../util/SVG';\nimport { polygonArea, polygonInPolygon, svgPathToPolygons } from '../util/Geom2D';\n\n/** Helper that forces an un-namespaced node to SVG **/\nconst insertSVGNamespace = originalDoc => {\n  // Serialize and parse for the namespace to take effect on every node\n  const serializer = new XMLSerializer();\n  const str = serializer.serializeToString(originalDoc.documentElement);\n\n  // Doesn't seem that there's a clean cross-browser way for this...\n  const namespaced = str.replace('<svg>', `<svg xmlns=\"${SVG_NAMESPACE}\">`);\n\n  const parser = new DOMParser();\n  const namespacedDoc = parser.parseFromString(namespaced, \"image/svg+xml\");\n  return namespacedDoc.documentElement;\n}\n\nconst sanitize = doc => {\n  // Cf. https://github.com/mattkrick/sanitize-svg#readme  \n  // for the basic approach\n  const cleanEl = el => {\n    Array.from(el.attributes).forEach(attr => {\n      if (attr.name.startsWith('on'))\n        el.removeAttribute(attr.name)\n    });\n  }\n\n  // Remove script tags\n  const scripts = doc.getElementsByTagName('script');\n  Array.from(scripts).reverse().forEach(el =>\n    el.parentNode.removeChild(el));\n\n  // Remove on... attributes\n  cleanEl(doc);\n  Array.from(doc.querySelectorAll('*')).forEach(cleanEl);\n\n  return doc;\n}\n\nexport const svgFragmentToShape = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector) {\n    const parser = new DOMParser();\n\n    // Parse the XML document, assuming SVG\n    const { value } = selector;\n    const doc = parser.parseFromString(value, \"image/svg+xml\");\n\n    // SVG needs a namespace declaration - check if it's set or insert if not\n    const isPrefixDeclared = doc.lookupPrefix(SVG_NAMESPACE); // SVG declared via prefix\n    const isDefaultNamespaceSVG = doc.lookupNamespaceURI(null); // SVG declared as default namespace\n\n    if (isPrefixDeclared || isDefaultNamespaceSVG) {\n      return sanitize(doc).firstChild;\n    } else {\n      return sanitize(insertSVGNamespace(doc)).firstChild;\n    }\n  }\n}\n\nexport const drawEmbeddedSVG = annotation => {\n  const shape = svgFragmentToShape(annotation);\n\n  // Because we're nitpicky, we don't just draw the shape,\n  // but duplicate it, so we can have inner and an outer lines\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n\n  const inner = shape.cloneNode(true);\n  inner.setAttribute('class', 'a9s-inner');\n\n  const outer = shape.cloneNode(true);\n  outer.setAttribute('class', 'a9s-outer');\n\n  g.appendChild(outer);\n  g.appendChild(inner);\n\n  return g;\n}\n\nexport const toSVGTarget = (shape, image) => {\n  const inner = shape.querySelector('.a9s-inner').cloneNode(true);\n  inner.removeAttribute('class');\n  inner.removeAttribute('xmlns');\n\n  let serialized = inner.outerHTML || new XMLSerializer().serializeToString(inner);\n  serialized = serialized.replace(` xmlns=\"${SVG_NAMESPACE}\"`, '');\n\n  return {\n    source: image?.src,\n    selector: {\n      type: \"SvgSelector\",\n      value: `<svg>${serialized}</svg>`\n    }\n  }\n}\n\nexport const svgArea = annotation => {\n  const shape = svgFragmentToShape(annotation);\n  const nodeName = shape.nodeName.toLowerCase();\n\n  if (nodeName === 'polygon') \n    return svgPolygonArea(shape);\n  else if (nodeName === 'circle')\n    return svgCircleArea(shape);\n  else if (nodeName === 'ellipse')\n    return svgEllipseArea(shape);\n  else if (nodeName == 'path')\n    return svgPathArea(shape);\n  else if (nodeName == 'line')\n    return 0;\n  else\n    throw `Unsupported SVG shape type: ${nodeName}`;\n}\n\nconst svgPolygonArea = polygon => {\n  const points = polygon.getAttribute('points')\n    .trim()\n    .split(' ') // Split x/y tuples\n    .map(xy => xy.split(',').map(str => parseFloat(str.trim())));\n\n  return polygonArea(points)\n}\n\nconst svgCircleArea = circle => {\n  const r = circle.getAttribute('r');\n  return r * r * Math.PI;\n}\n\nconst svgEllipseArea = ellipse => {\n  const rx = ellipse.getAttribute('rx');\n  const ry = ellipse.getAttribute('ry');\n  return rx * ry * Math.PI;\n}\n\nconst svgPathArea = path => {\n  const polygons = svgPathToPolygons(path);\n\n  if (polygons.length == 1) {\n    return polygonArea(polygons[0]);\n  } else {\n    // Helper to check if a polygon is a hole\n    const isHole = p => polygons.find(other => {\n      if (p !== other)\n        return polygonInPolygon(p, other); \n    })\n\n    let area = 0\n\n    for (let poly of polygons) {\n      if (isHole(poly))\n        area -= polygonArea(poly);\n      else \n        area += polygonArea(poly);\n    }\n\n    return area;\n  }\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n\n/** Shorthand to apply the given (x, y, r) to the SVG shape **/\nconst setXYR = (shape, x, y, r) => {  \n  shape.setAttribute('cx', x);\n  shape.setAttribute('cy', y);\n  shape.setAttribute('r', r);\n}\n\n/** \n * Draws an SVG circle, either from an annotation, or an\n * (cx, cy, r)-tuple.\n */\nexport const drawCircle = (cx, cy, r) => {\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n  const outerCircle  = document.createElementNS(SVG_NAMESPACE, 'circle');\n  const innerCircle  = document.createElementNS(SVG_NAMESPACE, 'circle');\n\n  innerCircle.setAttribute('class', 'a9s-inner');\n  setXYR(innerCircle, cx, cy, r);\n\n  outerCircle.setAttribute('class', 'a9s-outer');\n  setXYR(outerCircle, cx, cy, r);\n\n  g.appendChild(outerCircle);\n  g.appendChild(innerCircle);\n\n  return g;\n}\n\nexport const setCircleSize = (g, cx, cy, r) => {\n  const innerCircle = g.querySelector('.a9s-inner');\n  const outerCircle = g.querySelector('.a9s-outer');\n  \n  setXYR(innerCircle, cx, cy, r);\n  setXYR(outerCircle, cx, cy, r);\n}\n\nexport const getCircleSize = g => {\n  const outerCircle = g.querySelector('.a9s-outer');\n\n  const cx = parseFloat(outerCircle.getAttribute('cx'));\n  const cy = parseFloat(outerCircle.getAttribute('cy'));\n  const r = parseFloat(outerCircle.getAttribute('r'));\n  \n  return { cx, cy, r };\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { getCircleSize } from './Circle';\n\nexport default class CircleMask {\n\n  constructor(imageDimensions, circle) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.circle = circle;\n\n    const { cx, cy, r } = getCircleSize(this.circle);\n    const tx = ((cx + r) > this.w) ? this.w - r : cx;\n    const ty = ((cy + r) > this.h) ? this.h - r : cy + r;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');    \n    this.mask.setAttribute('class', 'a9s-selection-mask');\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${tx} ${ty} a ${r} ${r} 0 1 1 1 0`);\n  }\n\n  redraw = () => {\n    const { cx, cy, r } = getCircleSize(this.circle);\n\n    const tx = ((cx + r) > this.w) ? this.w - r : cx;\n    const ty = ((cy + r) > this.h) ? this.h - r : cy + r;\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${tx} ${ty} a ${r} ${r} 0 1 1 1 0`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { drawCircle, setCircleSize } from './Circle';\nimport Mask from './CircleMask';\n\n/**\n * A 'rubberband' selection tool for creating a circle by\n * clicking and dragging.\n */\nexport default class RubberbandCircle {\n\n  constructor(anchorX, anchorY, g, env) {\n    this.anchor = [ anchorX, anchorY ];\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.circle = drawCircle(anchorX, anchorY, 2);\n    this.circle.setAttribute('class', 'a9s-selection');\n\n    this.mask = new Mask(env.image, this.circle);\n\n    // We make the selection transparent to \n    // pointer events because it would interfere with the \n    // rendered annotations' mouseleave/enter events\n    this.group.style.pointerEvents = 'none';\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.circle);\n\n    g.appendChild(this.group);\n  }\n\n  get element() {\n    return this.circle;\n  }\n\n  dragTo = (oppositeX, oppositeY) => {\n    const { naturalWidth, naturalHeight } = this.env.image;\n\n    // Make visible\n    this.group.style.display = null;\n\n    const w = oppositeX - this.anchor[0];\n    const h = oppositeY - this.anchor[1];\n    const r = Math.max(1, Math.pow(w ** 2 + h ** 2, 0.5) / 2);\n\n    const cx = this.anchor[0] + w / 2;\n    const cy = this.anchor[1] + h / 2;\n\n    if ((cx-r < 0 || cx + r > naturalWidth) || (cy-r < 0 || cy + r > naturalHeight)) return;\n    \n    setCircleSize(this.circle, cx, cy, r);\n    this.mask.redraw();\n  }\n\n  getBoundingClientRect = () => \n    this.circle.getBoundingClientRect();\n\n  toSelection = () => {\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n\n    this.mask = null;\n    this.circle = null;\n    this.group = null;\n  }\n\n}","import { addClass, SVG_NAMESPACE } from './SVG';\n\nconst isFirefox = /firefox/i.test(navigator.userAgent);\n\nconst formatSvgEl = (svgEl, x, y, w, h) => {\n  svgEl.setAttribute('width', w);\n  svgEl.setAttribute('height', h);\n\n  // Argh - Firefox produces broken SVG bounds for nested SVG\n  if (isFirefox) {\n    svgEl.setAttribute('x', 0);\n    svgEl.setAttribute('y', 0);\n    svgEl.setAttribute('transform', `translate(${x}, ${y})`);  \n  } else {\n    svgEl.setAttribute('x', x);\n    svgEl.setAttribute('y', y);\n  }\n}\n\nconst appendFormatterEl = (formatterEl, shape) => {\n  const { x, y, width, height } = shape.getBBox();\n\n  const svgEl = document.createElementNS(SVG_NAMESPACE, 'svg');\n  svgEl.setAttribute('class', 'a9s-formatter-el');\n\n  formatSvgEl(svgEl, x, y, width, height);\n\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n  g.appendChild(formatterEl);y\n\n  svgEl.appendChild(g);\n  \n  shape.append(svgEl);\n}\n\n/**\n * A formatter is a user-defined function that takes an annotation as input,\n * and returns either a string, or an object. If a string is returned, this\n * will be appended to the annotation element CSS class list. Otherwise, the\n * object can have the following properties: \n * \n * - 'className' added to the CSS class list\n * - 'data-*' added as data attributes\n * - 'style' a list of CSS styles (in the form of a string) \n */\nexport const format = (shape, annotation, formatters) => {\n  // The formatter can be undefined\n  if (!formatters)\n    return shape;\n\n  // Merge outputs from all formatter functions into one object\n  const format = formatters.reduce((merged, fn) => {\n    const format = fn(annotation);\n\n    if (!format)\n      return merged;\n\n    if (typeof format === 'string' || format instanceof String) {\n      merged.className = merged.className ? `${merged.className} ${format}` : format; \n    } else if (format.nodeType === Node.ELEMENT_NODE) {\n      merged.elements = merged.elements ? [...merged.elements, format] : [format];\n    } else {\n      const { className, style, element } = format;\n\n      if (className)\n        merged.className = merged.className ? `${merged.className} ${className}` : className;\n\n      if (style)\n        merged.style = merged.style ? `${merged.style} ${style}` : style;\n\n      if (element)\n        merged.elements = merged.elements ? [...merged.elements, element] : [element];\n    }\n\n    // Copy data attributes\n    for (const key in format) {\n      if (format.hasOwnProperty(key) && key.startsWith('data-')) {\n        merged[key] = format[key];\n      }\n    }\n\n    return merged;\n  }, {});\n\n  const { className, style, elements } = format;\n\n  if (className)\n    addClass(shape, className);\n\n  if (style) {\n    const outer = shape.querySelector('.a9s-outer');\n    const inner = shape.querySelector('.a9s-inner');\n\n    if (outer && inner) {\n      outer.setAttribute('style', 'display:none');\n      inner.setAttribute('style', style);\n    } else {\n      shape.setAttribute('style', style);\n    }\n  }\n\n  if (elements)\n    elements.forEach(el => appendFormatterEl(el, shape));\n\n  for (const key in format) {\n    if (format.hasOwnProperty(key) && key.startsWith('data-')) {\n      shape.setAttribute(key, format[key]);\n    }\n  }\n}\n\nexport const setFormatterElSize = (group, x, y, w, h) => {\n  const formatterEl = group.querySelector('.a9s-formatter-el');\n  if (formatterEl)\n    formatSvgEl(formatterEl, x, y, w, h);\n}","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { drawEmbeddedSVG, svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\nimport { getCircleSize, setCircleSize } from './Circle';\nimport Mask from './CircleMask';\n\n/**\n * An editable circle shape.\n */\nexport default class EditableCircle extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    // \n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <circle class=\"a9s-outer\" ... />\n    //     <circle class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //   </g> \n    // </g>\n\n    // 'g' for the editable circle compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.circle = drawEmbeddedSVG(annotation);\n    this.circle.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.circle));\n\n    this.mask = new Mask(env.image, this.circle);\n\n    this.containerGroup.appendChild(this.mask.element);\n\n    // The 'element' = circle + handles\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.circle);    \n\n    const { cx, cy, r } = getCircleSize(this.circle);\n\n    this.handles = [\n      [ cx, cy - r ],\n      [ cx + r, cy ],\n      [ cx, cy + r ],\n      [ cx - r, cy ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.circle, annotation, config.formatter);\n\n    // The grabbed element (handle or entire group), if any\n    this.grabbedElem = null; \n\n    // Mouse xy offset inside the shape, if mouse pressed\n    this.grabbedAt = null;\n  }\n\n  setSize = (cx, cy, r) => {\n    setCircleSize(this.circle, cx, cy, r);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, r, r);\n\n    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n    this.setHandleXY(topleft, cx, cy - r);\n    this.setHandleXY(topright, cx + r, cy);\n    this.setHandleXY(bottomright, cx, cy + r);\n    this.setHandleXY(bottomleft, cx - r, cy);\n  }\n\n  stretchCorners = (draggedHandleIdx, anchorHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n\n    var mouseX = mousePos.x;\n    var mouseY = mousePos.y;\n    var width = 0;\n    var height = 0;\n    var r;\n    if (draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      mouseX = anchor.x;\n      height = mouseY - anchor.y;\n      r = Math.abs(height) / 2;\n    } else {\n      mouseY = anchor.y;\n      width = mouseX - anchor.x;\n      r = Math.abs(width) / 2;\n    }\n\n    const x = width > 0 ? anchor.x : mouseX;\n    const y = height > 0 ? anchor.y : mouseY;\n    const w = Math.abs(width);\n    const h = Math.abs(height);\n    const cx = x + w/2;\n    const cy = y + h/2;\n\n    setCircleSize(this.circle, cx, cy, r);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, r, r);\n\n    if (draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      var idx0 = 0;\n      var idx2 = 2;\n      if(draggedHandleIdx == 0 && height > 0 || draggedHandleIdx == 2 && height < 0) {\n        idx0 = 2;\n        idx2 = 0;\n      }\n      this.setHandleXY(this.handles[idx0], cx, cy - r);\n      this.setHandleXY(this.handles[idx2], cx, cy + r);\n      this.setHandleXY(this.handles[1], cx + r, cy);\n      this.setHandleXY(this.handles[3], cx - r, cy);\n    } else {\n      var idx3 = 3;\n      var idx1 = 1;\n      if (draggedHandleIdx == 1 && width > 0 || draggedHandleIdx == 3 && width < 0) {\n        idx3 = 1;\n        idx1 = 3;\n      }\n      this.setHandleXY(this.handles[idx3], cx + r, cy);\n      this.setHandleXY(this.handles[idx1], cx - r, cy);\n      this.setHandleXY(this.handles[0], cx, cy - r);\n      this.setHandleXY(this.handles[2], cx, cy + r);\n    }\n  }\n\n  onGrab = grabbedElem => evt => {\n    this.grabbedElem = grabbedElem; \n    \n    const pos = this.getSVGPoint(evt);\n    const { cx, cy } = getCircleSize(this.circle);\n    \n    this.grabbedAt = { x: pos.x - cx, y: pos.y - cy };\n  }\n\n  onMouseMove = evt => {\n    const constrain = (coord, max) =>\n      coord < 0 ? 0 : ( coord > max ? max : coord);\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      if (this.grabbedElem === this.circle) {\n        const { r } = getCircleSize(this.circle);\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const cx = Math.max(constrain(pos.x - this.grabbedAt.x, naturalWidth - r), r);\n        const cy = Math.max(constrain(pos.y - this.grabbedAt.y, naturalHeight - r), r);\n\n        this.setSize(cx, cy, r); \n        this.emit('update', toSVGTarget(this.circle, this.env.image)); \n      } else {\n        // Mouse position replaces one of the corner coords, depending\n        // on which handle is the grabbed element\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n\n        this.stretchCorners(handleIdx, oppositeHandle, pos);\n        this.emit('update', toSVGTarget(this.circle, this.env.image));\n      }\n    }\n  }\n\n  onMouseUp = () => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = scale =>\n    this.handles.map(this.scaleHandle);\n\n  get element() { \n    return this.elementGroup; \n  }\n\n  updateState = annotation => {\n    const shape = svgFragmentToShape(annotation);\n\n    const cx = parseFloat(shape.getAttribute('cx'));\n    const cy = parseFloat(shape.getAttribute('cy'));\n    const r =  parseFloat(shape.getAttribute('r'));\n\n    this.setSize(cx, cy, r);\n  }\n\n  destroy() {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandCircle from './RubberbandCircle';\nimport EditableCircle from './EditableCircle';\n\n/**\n * A rubberband selector for circle selections.\n */\nexport default class RubberbandCircleTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this.rubberband = null;\n  }\n\n  startDrawing = (x, y) => {\n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp\n    });\n\n    this.rubberband = new RubberbandCircle(x, y, this.g, this.env);\n  }\n\n  stop = () => {\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo(x, y);\n  \n  onMouseUp = () => {\n    this.detachListeners();\n    this.started = false;\n\n    const { width, height } = this.rubberband.getBoundingClientRect();\n\n    const minWidth = this.config.minSelectionWidth || 4;\n    const minHeight = this.config.minSelectionHeight || 4;\n\n    if (width >= minWidth && height >= minHeight) {\n      // Emit the SVG shape with selection attached    \n      const { element } = this.rubberband;\n      element.annotation = this.rubberband.toSelection();\n\n      // Emit the completed shape...\n      this.emit('complete', element);\n    } else {\n      this.emit('cancel');\n    }\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this.rubberband != null;\n  }\n  \n  createEditableShape = annotation =>\n    new EditableCircle(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandCircleTool.identifier = 'circle';\n\nRubberbandCircleTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<circle/g);\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n\n/** Shorthand to apply the given (x, y, rx, ry) to the SVG shape **/\nconst setXYR = (shape, x, y, rx, ry) => {  \n  shape.setAttribute('cx', x);\n  shape.setAttribute('cy', y);\n  shape.setAttribute('rx', rx);\n  shape.setAttribute('ry', ry);\n}\n\n/** \n * Draws an SVG ellipse, either from an annotation, or an\n * (cx, cy, rx, ry)-tuple.\n */\nexport const drawEllipse = (cx, cy, rx, ry) => {\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n  const innerEllipse  = document.createElementNS(SVG_NAMESPACE, 'ellipse');\n  const outerEllipse  = document.createElementNS(SVG_NAMESPACE, 'ellipse');\n\n  innerEllipse.setAttribute('class', 'a9s-inner');\n  setXYR(innerEllipse, cx, cy, rx, ry);\n\n  outerEllipse.setAttribute('class', 'a9s-outer');\n  setXYR(outerEllipse, cx, cy, rx, ry);\n\n  g.appendChild(outerEllipse);\n  g.appendChild(innerEllipse);\n\n  return g;\n}\n\nexport const setEllipseSize = (g, cx, cy, rx, ry) => {\n  const innerEllipse = g.querySelector('.a9s-inner');\n  const outerEllipse = g.querySelector('.a9s-outer');\n\n  setXYR(innerEllipse, cx, cy, rx, ry);\n  setXYR(outerEllipse, cx, cy, rx, ry);\n}\n\nexport const getEllipseSize = g => {\n  const outerEllipse = g.querySelector('.a9s-outer');\n\n  const cx = parseFloat(outerEllipse.getAttribute('cx'));\n  const cy = parseFloat(outerEllipse.getAttribute('cy'));\n  const rx = parseFloat(outerEllipse.getAttribute('rx'));\n  const ry = parseFloat(outerEllipse.getAttribute('ry'));\n  \n  return { cx, cy, rx, ry };\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { getEllipseSize } from './Ellipse';\n\nexport default class EllipseMask {\n\n  constructor(imageDimensions, ellipse) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.ellipse = ellipse;\n\n    const { cx, cy, rx, ry } = getEllipseSize(this.ellipse);\n\n    const ty = cy + ry;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');    \n    this.mask.setAttribute('class', 'a9s-selection-mask');\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${cx} ${ty} a ${rx} ${ry} 0 1 1 1 0`);\n  }\n\n  redraw = () => {\n    const { cx, cy, rx, ry } = getEllipseSize(this.ellipse);\n\n    const ty = cy + ry;\n\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${cx} ${ty} a ${rx} ${ry} 0 1 1 1 0`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { drawEllipse, setEllipseSize } from './Ellipse';\nimport Mask from './EllipseMask';\n\n/**\n * A 'rubberband' selection tool for creating a ellipse by\n * clicking and dragging.\n */\nexport default class RubberbandEllipse {\n\n  constructor(anchorX, anchorY, g, env) {\n    this.anchor = [ anchorX, anchorY ];\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.ellipse = drawEllipse(anchorX, anchorY, 2, 2);\n    this.ellipse.setAttribute('class', 'a9s-selection');\n\n    this.mask = new Mask(env.image, this.ellipse);\n\n    // We make the selection transparent to \n    // pointer events because it would interfere with the \n    // rendered annotations' mouseleave/enter events\n    this.group.style.pointerEvents = 'none';\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.ellipse);\n\n    g.appendChild(this.group);\n  }\n\n  get element() {\n    return this.ellipse;\n  }\n\n  dragTo = (oppositeX, oppositeY) => {\n    // Make visible\n    this.group.style.display = null;\n\n    const w = oppositeX - this.anchor[0];\n    const h = oppositeY - this.anchor[1];\n\n    const cx = w > 0 ? this.anchor[0] + w / 2 : oppositeX + w / 2;\n    const cy = h > 0 ? this.anchor[1] + h / 2 : oppositeY + h / 2;\n\n    const rx = Math.abs(w / 2);\n    const ry = Math.abs(h / 2);\n\n    setEllipseSize(this.ellipse, cx, cy, rx, ry);\n    this.mask.redraw();\n  }\n\n  getBoundingClientRect = () => \n    this.ellipse.getBoundingClientRect();\n\n  toSelection = () => {\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n\n    this.mask = null;\n    this.ellipse = null;\n    this.group = null;\n  }\n\n}","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { drawEmbeddedSVG, svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\nimport { getEllipseSize, setEllipseSize } from './Ellipse';\nimport Mask from './EllipseMask';\n\n/**\n * An editable ellipse shape.\n */\nexport default class EditableEllipse extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    // \n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <ellipse class=\"a9s-outer\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //   </g> \n    // </g>\n\n    // 'g' for the editable ellipse compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.ellipse = drawEmbeddedSVG(annotation);\n    this.ellipse.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.ellipse));\n\n    this.mask = new Mask(env.image, this.ellipse);\n\n    this.containerGroup.appendChild(this.mask.element);\n\n    // The 'element' = ellipse + handles\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.ellipse);    \n\n    const { cx, cy, rx, ry } = getEllipseSize(this.ellipse);\n\n    this.handles = [\n      [ cx, cy - ry ],\n      [ cx + rx, cy ],\n      [ cx, cy + ry ],\n      [ cx - rx, cy ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.ellipse, annotation, config.formatter);\n\n    // The grabbed element (handle or entire group), if any\n    this.grabbedElem = null; \n\n    // Mouse xy offset inside the shape, if mouse pressed\n    this.grabbedAt = null;\n  }\n\n  setSize = (cx, cy, rx, ry) => {\n    setEllipseSize(this.ellipse, cx, cy, rx, ry);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, rx, ry);\n\n    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n    this.setHandleXY(topleft, cx, cy - ry);\n    this.setHandleXY(topright, cx + rx, cy);\n    this.setHandleXY(bottomright, cx, cy + ry);\n    this.setHandleXY(bottomleft, cx - rx, cy);\n  }\n\n  stretchCorners = (draggedHandleIdx, anchorHandle, leftHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n    const anchorLeft = this.getHandleXY(leftHandle);\n\n    var mouseX = mousePos.x;\n    var mouseY = mousePos.y;\n    var rx = 0;\n    var ry = 0;\n    if(draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      mouseX = anchor.x;\n    } else {\n      mouseY = anchor.y;\n    }\n\n    const width = mouseX - anchor.x;\n    const height = mouseY - anchor.y;\n    const x = width > 0 ? anchor.x : mouseX;\n    const y = height > 0 ? anchor.y : mouseY;\n    const w = Math.abs(width);\n    const h = Math.abs(height);\n    const cx = x + w/2;\n    const cy = y + h/2;\n    var rx = w/2;\n    var ry = h/2;\n    if(draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      rx = Math.abs(anchor.x - anchorLeft.x);\n    } else {\n      ry = Math.abs(anchor.y - anchorLeft.y);\n    }\n\n    setEllipseSize(this.ellipse, cx, cy, rx, ry);\n    this.mask.redraw();\n    setFormatterElSize(this.elementGroup, cx, cy, rx, ry);\n\n    if (draggedHandleIdx == 0 || draggedHandleIdx == 2) {\n      var idx0 = 0;\n      var idx2 = 2;\n      if(draggedHandleIdx == 0 && height > 0 || draggedHandleIdx == 2 && height < 0) {\n        idx0 = 2;\n        idx2 = 0;\n      }\n      this.setHandleXY(this.handles[idx0], cx, cy - ry);\n      this.setHandleXY(this.handles[idx2], cx, cy + ry);\n      this.setHandleXY(this.handles[1], cx + rx, cy);\n      this.setHandleXY(this.handles[3], cx - rx, cy);\n    } else {\n      var idx3 = 3;\n      var idx1 = 1;\n      if (draggedHandleIdx == 1 && width > 0 || draggedHandleIdx == 3 && width < 0) {\n        idx3 = 1;\n        idx1 = 3;\n      }\n      this.setHandleXY(this.handles[idx3], cx + rx, cy);\n      this.setHandleXY(this.handles[idx1], cx - rx, cy);\n      this.setHandleXY(this.handles[0], cx, cy - ry);\n      this.setHandleXY(this.handles[2], cx, cy + ry);\n    }\n  }\n\n  onGrab = grabbedElem => evt => {\n    this.grabbedElem = grabbedElem; \n\n    const pos = this.getSVGPoint(evt);\n    const { cx, cy } = getEllipseSize(this.ellipse);\n\n    this.grabbedAt = { x: pos.x - cx, y: pos.y - cy };\n  }\n\n  onMouseMove = evt => {\n    const constrain = (coord, max) =>\n      coord < 0 ? 0 : ( coord > max ? max : coord);\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      if (this.grabbedElem === this.ellipse) {\n        const { rx, ry } = getEllipseSize(this.ellipse);\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const cx = constrain(pos.x - this.grabbedAt.x, naturalWidth - rx);\n        const cy = constrain(pos.y - this.grabbedAt.y, naturalHeight - ry);\n\n        this.setSize(cx, cy, rx, ry); \n        this.emit('update', toSVGTarget(this.ellipse, this.env.image));\n      } else {\n        // Mouse position replaces one of the corner coords, depending\n        // on which handle is the grabbed element\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n        const leftHandle = this.handles[(handleIdx + 3) % 4];\n\n        this.stretchCorners(handleIdx, oppositeHandle, leftHandle, pos);\n        this.emit('update', toSVGTarget(this.ellipse, this.env.image));\n      }\n    }\n  }\n\n  onMouseUp = () => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = scale =>\n    this.handles.map(this.scaleHandle);\n\n  get element() { \n    return this.elementGroup; \n  }\n\n  updateState = annotation => {\n    const shape = svgFragmentToShape(annotation);\n\n    const cx = parseFloat(shape.getAttribute('cx'));\n    const cy = parseFloat(shape.getAttribute('cy'));\n    const rx = parseFloat(shape.getAttribute('rx'));\n    const ry = parseFloat(shape.getAttribute('ry'));\n    \n    this.setSize(cx, cy, rx, ry);\n  }\n\n  destroy() {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandEllipse from './RubberbandEllipse';\nimport EditableEllipse from './EditableEllipse';\n\n/**\n * A rubberband selector for ellipse selections.\n */\nexport default class RubberbandEllipseTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this.rubberband = null;\n  }\n\n  startDrawing = (x, y) => {\n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp\n    });\n\n    this.rubberband = new RubberbandEllipse(x, y, this.g, this.env);\n  }\n\n  stop = () => {\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo(x, y);\n  \n  onMouseUp = () => {\n    this.detachListeners();\n    this.started = false;\n\n    const { width, height } = this.rubberband.getBoundingClientRect();\n\n    const minWidth = this.config.minSelectionWidth || 4;\n    const minHeight = this.config.minSelectionHeight || 4;\n\n    if (width >= minWidth && height >= minHeight) {\n      // Emit the SVG shape with selection attached    \n      const { element } = this.rubberband;\n      element.annotation = this.rubberband.toSelection();\n\n      // Emit the completed shape...\n      this.emit('complete', element);\n    } else {\n      this.emit('cancel');\n    }\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this.rubberband != null;\n  }\n  \n  createEditableShape = annotation =>\n    new EditableEllipse(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandEllipseTool.identifier = 'ellipse';\n\nRubberbandEllipseTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<ellipse/g);\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n// TODO optional: mask to dim the outside area\n//import Mask from './FreehandMask';\n\n/**\n * A 'rubberband' selection tool for creating freehand drawing by\n * clicking and dragging.\n */\nexport default class RubberbandFreehand {\n\n  constructor(anchor, g, env) {\n    this.points = [ anchor ];\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.freehand = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.freehand.setAttribute('class', 'a9s-selection');\n\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.outer.setAttribute('class', 'a9s-outer');\n\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.inner.setAttribute('class', 'a9s-inner');\n\n    this.setPoints(this.points);\n\n   // TODO optional: mask to dim the outside area\n   // this.mask = new Mask(env.image, this.inner);\n\n    this.freehand.appendChild(this.outer);\n    this.freehand.appendChild(this.inner);\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n   // TODO optional: mask to dim the outside area\n   // this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.freehand);\n\n    g.appendChild(this.group);\n  }\n\n  setPoints = points => {\n    var str = points.map(pt => `L${pt[0]} ${pt[1]}`).join(' ');\n    str = 'M' + str.substring(1);\n    this.outer.setAttribute('d', str);\n    this.inner.setAttribute('d', str);\n  }\n\n  getBoundingClientRect = () =>\n    this.outer.getBoundingClientRect();\n\n  dragTo = xy => {\n    // Make visible\n    this.group.style.display = null;\n\n    //TODO optional: edge smoothing\n\n    this.addPoint(xy);\n\n   // TODO optional: mask to dim the outside area\n   // this.mask.redraw();\n  }\n\n  addPoint = xy => {\n    this.points = [ ...this.points, xy ];\n    this.setPoints(this.points);   \n   // TODO optional: mask to dim the outside area\n   // this.mask.redraw();\n  }\n\n  get element() {\n    return this.freehand;\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n    this.freehand = null;    \n    this.group = null;\n  }\n\n  toSelection = () => {\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n}\n","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { drawEmbeddedSVG, svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\n// TODO optional: mask to dim the outside area\n//import Mask from './FreehandMask';\n\nconst getPoints = shape => {\n  const pointList = shape.getAttribute('d').split('L');\n  const points = [];\n  if(pointList.length > 0) {\n    var point = pointList[0].substring(1).trim().split(' ');\n    points.push({ x: parseFloat(point[0]), y: parseFloat(point[1]) });\n\n    for (let i = 1; i < pointList.length; i++) {\n      var point = pointList[i].trim().split(' ');\n      points.push({ x: parseFloat(point[0]), y: parseFloat(point[1]) });\n    }\n  }\n\n  return points;\n}\n\nconst getBBox = shape => {\n  return shape.querySelector('.a9s-inner').getBBox();\n}\n\n/**\n * An editable freehand drawing.\n */\nexport default class EditableFreehand extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    // \n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <polygon class=\"a9s-outer\" ... />\n    //     <polygon class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     ...\n    //   </g> \n    // </g>\n\n    // 'g' for the editable free drawing compound shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.shape = drawEmbeddedSVG(annotation);\n\n   // TODO optional: mask to dim the outside area\n   // this.mask = new Mask(env.image, this.shape.querySelector('.a9s-inner'));\n    \n   // this.containerGroup.appendChild(this.mask.element);\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.shape);\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.shape, annotation, config.formatter);\n\n    this.shape.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    const { x, y, width, height } = getBBox(this.shape);\n\n    // TODO optional: handles to stretch the shape\n/*    this.handles = [\n      [ x, y ], \n      [ x + width, y ], \n      [ x + width, y + height ], \n      [ x, y + height ]\n    ].map(t => { \n      const [ x, y ] = t;\n      const handle = this.drawHandle(x, y);\n\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n\n      return handle;\n    });*/\n\n    // The grabbed element (handle or entire shape), if any\n    this.grabbedElem = null;\n\n    // Mouse grab point\n    this.grabbedAt = null;\n  }\n\n  setPoints = (points) => {\n    // Not using .toFixed(1) because that will ALWAYS\n    // return one decimal, e.g. \"15.0\" (when we want \"15\")\n    const round = num => Math.round(10 * num) / 10;\n\n    var str = points.map(pt => `L${round(pt.x)} ${round(pt.y)}`).join(' ');\n    str = 'M' + str.substring(1);\n\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('d', str);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('d', str);\n\n    const { x, y, width, height } = outer.getBBox();\n\n    // TODO optional: mask to dim the outside area\n    // this.mask.redraw();\n\n    // TODO optional: handles to stretch the shape\n/*    const [ topleft, topright, bottomright, bottomleft] = this.handles;\n\n    this.setHandleXY(topleft, x, y);\n    this.setHandleXY(topright, x + width, y);\n    this.setHandleXY(bottomright, x + width, y + height);\n    this.setHandleXY(bottomleft, x, y + height);*/\n\n    setFormatterElSize(this.elementGroup, x, y, width, height);\n  }\n\n    // TODO optional: handles to stretch the shape\n/*  stretchCorners = (draggedHandleIdx, anchorHandle, mousePos) => {\n    const anchor = this.getHandleXY(anchorHandle);\n  }*/\n\n  onGrab = grabbedElem => evt => {\n    this.grabbedElem = grabbedElem;\n    const pos = this.getSVGPoint(evt);\n    this.grabbedAt = { x: pos.x, y: pos.y };\n  }\n\n  onMouseMove = evt => {\n    const constrain = (coord, delta, max) =>\n      coord + delta < 0 ? -coord : (coord + delta > max ? max - coord : delta);\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n\n      const { x, y, width, height } = getBBox(this.shape);\n\n      if (this.grabbedElem === this.shape) {\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const dx = constrain(x, pos.x - this.grabbedAt.x, naturalWidth - width);\n        const dy = constrain(y, pos.y - this.grabbedAt.y, naturalHeight - height);\n\n        const inner = this.shape.querySelector('.a9s-inner');\n        const updatedPoints = getPoints(inner).map(pt => ({ x: pt.x + dx, y: pt.y + dy }));\n\n        this.grabbedAt = pos;\n\n        this.setPoints(updatedPoints);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }\n      // TODO optional: handles to stretch the shape\n      /* else {\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n        const oppositeHandle = handleIdx < 2 ? \n          this.handles[handleIdx + 2] : this.handles[handleIdx - 2];\n\n        this.stretchCorners(handleIdx, oppositeHandle, pos);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }*/\n    }\n  }\n\n  onMouseUp = evt => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  updateState = annotation => {\n    const points = getPoints(svgFragmentToShape(annotation));\n    this.setPoints(points);\n  }\n\n  destroy = () => {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandFreehand from './RubberbandFreehand';\nimport EditableFreehand from './EditableFreehand';\n\n/**\n * A rubberband selector for freehand fragments.\n */\nexport default class RubberbandFreehandTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this._isDrawing = false;\n  }\n\n  startDrawing = (x, y) => {\n    this._isDrawing = true;\n    \n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp,\n      dblClick: this.onDblClick\n    });\n    \n    this.rubberband = new RubberbandFreehand([ x, y ], this.g, this.env);\n  }\n\n  stop = () => {\n    this.detachListeners();\n    \n    this._isDrawing = false;\n\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo([ x, y ]);\n\n  onMouseUp = (x, y) => {\n    this.onDblClick(x, y);\n  }\n\n  onDblClick = (x, y) => {\n    this._isDrawing = false;\n\n    this.rubberband.addPoint([ x, y ]);\n\n    this.detachListeners();\n\n    const { width, height } = this.rubberband.getBoundingClientRect();\n\n    const minWidth = this.config.minSelectionWidth || 4;\n    const minHeight = this.config.minSelectionHeight || 4;\n\n    if (width >= minWidth || height >= minHeight) {\n\n      const shape = this.rubberband.element;\n      shape.annotation = this.rubberband.toSelection();\n\n      this.emit('complete', shape);\n    } else {\n      this.emit('cancel');\n    }\n\n    this.stop();\n  }\n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  createEditableShape = annotation =>\n    new EditableFreehand(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandFreehandTool.identifier = 'freehand';\n\nRubberbandFreehandTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return (selector.value.match(/^<svg.*<path*/g) && !selector.value.toUpperCase().includes('Z'));\n}","import { Selection, ToolLike } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n//import Mask from './MultipolygonMask';\n// TODO optional: mask to dim the outside area\n//import Mask from './multipolygonMask';\n\n/**\n * A 'rubberband' selection tool for creating multipolygon drawing by\n * clicking and dragging.\n */\nexport default class RubberbandMultipolygon extends ToolLike  {\n\n  constructor(anchor, g, config, env) {\n    super(g, config, env);\n    //super(g, config, env);\n    this.points = [];\n    this.points.push([ anchor, anchor ])\n    this.mousepos = anchor;\n\n    this.env = env;\n    this.scale = 1;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.multipolygon = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.multipolygon.setAttribute('class', 'a9s-selection a9s-multipolygon improved-polygon');\n\n    this.rubberband = document.createElementNS(SVG_NAMESPACE, 'polygon');\n    this.rubberband.setAttribute('class', 'a9s-rubberband');\n\n    this.closeHandle = this.drawHandle(anchor[0], anchor[1]);\n    this.closeHandle.style.display = 'none';\n\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.outer.setAttribute('class', 'a9s-outer');\n\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.inner.setAttribute('class', 'a9s-inner');\n\n    this.setPoints(this.points);\n    //this.mask = new Mask(env.image, this.inner);\n\n   // TODO optional: mask to dim the outside area\n   // this.mask = new Mask(env.image, this.inner);\n\n    this.multipolygon.appendChild(this.rubberband)\n    this.multipolygon.appendChild(this.outer);\n    this.multipolygon.appendChild(this.inner);\n    this.multipolygon.appendChild(this.closeHandle);\n\n    // Additionally, selection remains hidden until\n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    // TODO optional: mask to dim the outside area\n    // this.group.appendChild(this.mask.element);\n    //this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.multipolygon);\n\n    g.appendChild(this.group);\n  }\n\n  setPoints = points => {\n    var attr =\"\";\n    for (var ps of points){\n      var attr2=\"\"\n      if (ps.length>0){\n        for (var p of ps) {\n          if (p){\n            if (attr2===\"\"){\n              attr2  +=`M${p[0]},${p[1]}`;\n            }\n            else{\n              attr2  +=` L${p[0]},${p[1]}`;\n            }\n          }\n        };\n         attr+=attr2\n      }\n    }\n    attr+=\" Z\"\n    this.outer.setAttribute('d', attr);\n    this.inner.setAttribute('d', attr);\n  }\n  close = () => {\n    const multipolygon = new multipolygon(toSVGTarget(this.points, this.env.image));\n    this.emit('close', { shape: this.multipolygon, multipolygon });\n  }\n\n  getBoundingClientRect = () => {\n     return this.outer.getBoundingClientRect();\n  }\n\n  dragTo = xy => {\n    // Make visible\n    this.group.style.display = null;\n    this.mousepos = xy;\n    const head = this.points[this.points.length - 1].slice(0, this.points[this.points.length - 1].length - 1);\n    var headRest=this.points.slice(0,-1)\n    const rubberband = [ ...head, xy, head[0] ];\n    headRest.push(rubberband)\n    this.setPoints(headRest);\n    //this.mask.redraw();\n  }\n  onScaleChanged = scale => {\n    this.scale = scale;\n\n    const inner = this.closeHandle.querySelector('.a9s-handle-inner');\n    const outer = this.closeHandle.querySelector('.a9s-handle-outer');\n\n    const radius = scale * (this.config.handleRadius || 6);\n\n    inner.setAttribute('r', radius);\n    outer.setAttribute('r', radius);\n  }\n\n  addPoint = xy => {\n    // Don't add a new point if distance < 2 pixels\n    if (this.points[this.points.length - 1].length>0){\n      const head = this.points[this.points.length - 1].slice(0, this.points[this.points.length - 1].length - 1);\n      const lastCorner = head[head.length - 1];\n      const dist = Math.pow(xy[0] - lastCorner[0], 2) + Math.pow(xy[1] - lastCorner[1], 2);\n      if (dist > 4) {\n        this.points[this.points.length - 1] = [ ...head, xy, head[0] ];\n        this.setPoints(this.points);\n        //this.mask.redraw();\n      }\n    } else{\n      this.points[this.points.length - 1] = [xy,xy];\n      this.setPoints(this.points);\n    }\n  }\n  undo = () => {\n    this.pop()\n  }\n\n  isClosable = () => {\n    const d = this.getDistanceToStart();\n    return d < 6 * this.scale;\n  }\n  /** Removes last corner **/\n  pop = () => {\n    if (this.points[this.points.length - 1].length>2){\n      this.points[this.points.length - 1].pop();\n    } else {\n      if (this.points.length>1){\n        this.points.pop()\n      }\n    }\n    this.setPoints(this.points);\n    // this.mask.redraw();\n  }\n\n  newPart = () => {\n    this.points.push([]);\n  }\n\n  get element() {\n    return this.multipolygon;\n  }\n  getDistanceToStart = () => {\n    if (this.points[this.points.length-1].length < 3)\n      return Infinity; // Just return if not at least 3 points\n\n    const dx = Math.abs(this.mousepos[0] - this.points[this.points.length-1][0][0]);\n    const dy = Math.abs(this.mousepos[1] - this.points[this.points.length-1][0][1]);\n\n    return Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2)) / this.scale;\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n    this.multipolygon = null;\n    this.group = null;\n  }\n  toSelection = () => {\n    console.log(\"toSVGTarget(this.group, this.env.image)\", toSVGTarget(this.group, this.env.image));\n    return new Selection(toSVGTarget(this.group, this.env.image));\n  }\n\n}\n","/**\n * Computes the area of the polygon defined by\n * the given conrner points.\n * @param {Array} points \n * @returns {number} the area\n */\nexport const polygonArea = points => {\n  let area = 0;\n  let j = points.length - 1;\n\n  for (let i=0; i < points.length; i++) {\n    area += (points[j][0] + points[i][0]) * (points[j][1] - points[i][1]);\n    j = i;\n  }\n\n  return Math.abs(0.5 * area);\n}\n\n/**\n * Hit test: checks if this point is inside the circle.\n * @param {Array} point the point [x, y]\n * @param {number} cx circle center x\n * @param {number} cy circle center y\n * @param {number} r circle radius\n * @returns {boolean} \n */\nexport const pointInCircle = (point, cx, cy, r) => {\n  const dx = point[0] - cx;\n  const dy = point[1] - cy;\n\n  const d = Math.sqrt(dx * dx + dy * dy);\n  return d <= r;\n}\n\n/**\n * Hit test: checks if this point is inside the ellipse.\n * Cf. https://github.com/w8r/point-in-ellipse\n * @param {Array} point the point [x, y] \n * @param {number} cx ellipse center x \n * @param {number} cy ellipse center y\n * @param {number} rx ellipse x radius\n * @param {number} ry ellipse y radius\n * @param {number=} rotation ellipse rotation \n * @returns {boolean}\n */\nexport const pointInEllipse = (point, cx, cy, rx, ry, rotation) => {\n  const rot = rotation || 0;\n\n  const cos = Math.cos(rot);\n  const sin = Math.sin(rot);\n\n  const dx  = point[0] - cx;\n  const dy  = point[1] - cy;\n\n  const tdx = cos * dx + sin * dy;\n  const tdy = sin * dx - cos * dy;\n\n  return (tdx * tdx) / (rx * rx) + (tdy * tdy) / (ry * ry) <= 1;\n}\n\n/**\n * Hit test: checks if this point is inside the polygon.\n * @param {Array} xy the point [x, y]\n * @param {Array<number>} points polygon corner points \n * @returns {boolean}\n */\nexport const pointInPolygon = (xy, points) => {\n  // Algorithm checks, if xy is in Polygon\n  // algorithm based on\n  // https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html/pnpoly.html\n  const x = xy[0];\n  const y = xy[1];\n  \n  let inside = false;\n\n  for (let i=0, j=points.length-1; i < points.length; j=i++) {\n    const xi = points[i][0], yi = points[i][1];\n    const xj = points[j][0], yj = points[j][1];\n    \n    const intersect = ((yi > y) != (yj > y))\n      && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);\n    \n      if (intersect)\n        inside = !inside;\n  }\n  \n  return inside;\n}\n\n/**\n * Checks if polygon A is contained fully inside polygon B.\n * @param {Array<Array<number>>} polygonA array of points [x, y] \n * @param {Array<Array<number>>} polygonB array of points [x, y]\n * @returns {boolean}\n */\nexport const polygonInPolygon = (polygonA, polygonB) => {\n  for (let point of polygonA) {\n    if (!pointInPolygon(point, polygonB)) \n      return false\n  }\n\n  return true;\n}\n\n/** \n * Hit test: checks if this point is inside the line.\n * @param {Array} xy the point [x, y]\n * @param number x1 line start x\n * @param number y1 line start y\n * @param number x2 line end x\n * @param number y2 line end y\n * @param number buffer around the line\n * @returns {boolean}\n */\nexport const pointInLine = (xy, x1, y1, x2, y2, buffer) => {\n  const x = xy[0];\n  const y = xy[1];\n\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const d = Math.sqrt(dx * dx + dy * dy);\n  const cross = Math.abs((x - x1) * dy - (y - y1) * dx);\n  const dist = cross / d;\n\n  return dist <= buffer;\n}\n\n/**\n * A utility helper that parses an SVG path into \n * a list of polygons.\n * @param {SVGElement} path the SVG path\n * @returns {Array<Array<Array<number>>>} list of polygons \n */\nexport const svgPathToPolygons = path => {\n  const commands = path.getAttribute('d')\n    .split(/(?=M|m|L|l|H|h|V|v|Z|z)/g)\n    .map(str => str.trim());\n\n  const polygons = [];\n\n  let points = [];\n\n  for (let cmd of commands) {\n    const op = cmd.substring(0, 1);\n\n    if (op.toLowerCase() === 'z') {\n      polygons.push([...points]);\n      points = [];\n    } else {\n      const xy = cmd.substring(1).split(' ')\n        .map(str => parseFloat(str.trim()));\n  \n      // Uppercase ops are absolute coords -> transform\n      const isUppercase = op === op.toUpperCase();\n\n      const x = isUppercase ? xy[0] : xy[0] + points[points.length - 1][0];\n      const y = isUppercase ? xy[1] : xy[1] + points[points.length - 1][1];\n\n      points.push([x, y]);\n    }\n  }\n\n  if (points.length > 0) // Unclosed path - close for area computation\n    polygons.push([...points]); \n\n  return polygons;\n}","import api from \"!../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../node_modules/css-loader/dist/cjs.js!../node_modules/sass-loader/dist/cjs.js!./index.scss\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { SVG_NAMESPACE, addClass, hasClass, removeClass } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\nimport { svgFragmentToShape } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { pointInPolygon } from '@recogito/annotorious/src/util/Geom2D';\nimport RubberbandMultipolygon from './RubberbandMultipolygon';\nimport '../index.scss';\nimport { toSVGTarget, getPath } from './RubberbandMultipolygonTool';\n\nconst getPointsFromPathValue = polygon => {\n  console.log(\"polygon\", polygon);\n  var results =polygon.split('M');\n  var allcoords = []\n  results.forEach(function (result, index) {\n    if (result.length>0){\n      let coords = []\n      result=result.replace(/ Z/g,\"Z\")\n      result=result.replace(/Z /g,\"Z\")\n      result=result.replace(/Z/g,\"\")\n      result=result.replace(/L /g,\"L\")\n      result=result.replace(/ L/g,\"L\")\n      var coordsString = result.split(\"L\")\n      coordsString.forEach(function(coord, index){\n        coords.push([parseFloat(coord.split(\",\")[0]).toFixed(2).toString(),parseFloat(coord.split(\",\")[1]).toFixed(2).toString()]);\n      });\n      if (coords[0][0] !== coords[coords.length - 1][0] && coords[0][1] !== coords[coords.length - 1][1]){\n        coords.push(coords[0])\n      }\n      allcoords.push(coords)\n    }\n  });\n  console.log(\"allcoords\", allcoords);\n  return allcoords\n}\n\n\nconst getPoints = (shape) => {\n  // Could just be Array.from(shape.querySelector('.inner').points) but...\n  // IE11 :-(\n  const pointLists = getPointsFromPathValue(shape.querySelector('.a9s-inner').attributes.d.nodeValue)\n  const pointArray = [];\n  for (let pointList of pointLists) {\n    let points = []\n    for (let point of pointList) {\n      let p = {\n        x:parseFloat(point[0]),\n        y:parseFloat(point[1])\n      }\n      points.push(p);\n    }\n    pointArray.push(points)\n  }\n  return pointArray;\n}\n\nconst getBBox = shape => {\n  return shape.querySelector('.a9s-inner').getBBox();\n}\nexport const svgFragmentToPoints = annotation => {\n  const svgShape = svgFragmentToShape(annotation);\n  var polygon = svgShape.getAttribute('d')\n  var allcoords =  getPointsFromPathValue(polygon)\n  return allcoords\n}\n\nconst drawEmbeddedSVG = annotation => {\n  const shape = svgFragmentToShape(annotation);\n  // Hack\n  svgFragmentToPoints(annotation);\n\n  // Because we're nitpicky, we don't just draw the shape,\n  // but duplicate it, so we can have inner and an outer lines\n  const g = document.createElementNS(SVG_NAMESPACE, 'g');\n\n  const inner = shape.cloneNode(true);\n  inner.setAttribute('class', 'a9s-inner');\n\n  const outer = shape.cloneNode(true);\n  outer.setAttribute('class', 'a9s-outer');\n\n  g.appendChild(outer);\n  g.appendChild(inner);\n  return g;\n}\n\nexport default class EditableMultipolygon extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n    // This part is added to track time of annotation process. It is not confirm with W3C-Annotations\n    document.body.addEventListener('keydown', this.onKeyDown);\n\n    // Container wraps the mask + editable shape\n    this.container = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    // The editable shape group\n    this.shape = drawEmbeddedSVG(annotation);\n    this.shape.setAttribute('class', 'a9s-annotation editable selected improved-polygon');\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.appendChild(this.shape);\n    let cornerList = getPoints(this.shape);\n    this.cornerHandles = []\n    this.midpoints = []\n    for (let corners of cornerList){\n      let midpoints = []\n      this.cornerHandles.push(corners.map((pt, idx) => {\n        midpoints.push(this.createMidpoint(corners, idx));\n        const handle = this.createCornerHandle(pt);\n        return handle;\n      }))\n      this.midpoints.push(midpoints);\n    }\n    this.container.appendChild(this.elementGroup)\n    g.appendChild(this.container);\n    // Format needs to go after everything is added to the DOM\n    format(this.shape, annotation, config.formatter);\n    this.shape.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    // Grabbed element and grab offset\n    this.grabbedElement = null;\n    this.grabbedAt = null;\n\n    // Selected corners\n    this.selected = [];\n\n    this.lastMouseDown = null;\n  }\n\n  createCornerHandle = pt => {\n    const handle = this.drawHandle(pt.x, pt.y);\n    handle.addEventListener('mousedown', this.onGrab(handle));\n    handle.addEventListener('click', this.onSelectCorner(handle));\n    this.scaleHandle(handle);\n\n    this.elementGroup.appendChild(handle);\n    return handle;\n  }\n\n  createMidpoint = (corners, idx) => {\n    // Create point between this and previous corner\n    const thisCorner = corners[idx];\n    const nextCorner = idx === corners.length - 1 ? corners[0] : corners[idx + 1];\n    const x = (thisCorner.x + nextCorner.x) / 2;\n    const y = (thisCorner.y + nextCorner.y) / 2;\n    const handle = this.drawMidpoint(x, y);\n    handle.addEventListener('mousedown', this.onGrab(handle));\n\n    this.shape.appendChild(handle);\n    return handle;\n  }\n\n  deleteSelected = () => {\n    console.log(\"delete selected\");\n    const points = getPoints(this.shape);\n\n    if (this.selected.length > 0 ) {\n      let cornerhandlesIDX = -1\n      let updatedPoints = []\n      // Update midpoints\n      let newMidpoints = []\n      for (let midpointList of this.midpoints){\n        let updatedMidpointlist = midpointList.filter((object, i) => {\n          return this.selected.map(object => (object[0] === cornerhandlesIDX && object[1] === i)).indexOf(true) === -1\n        });\n        let midpointsToDelete = midpointList.filter((object, i) => {\n          return this.selected.map(object => (object[0] === cornerhandlesIDX && object[1] === i)).indexOf(true) > -1\n        });\n        midpointsToDelete.forEach(h => h.parentNode.removeChild(h));\n        if (updatedMidpointlist.length > 2){\n          newMidpoints.push(updatedMidpointlist)\n        }\n      }\n      for (let pointList of points){\n        cornerhandlesIDX += 1\n        let updatedPointlist = pointList.filter((object, i) => {\n          return this.selected.map(object => (object[0] === cornerhandlesIDX && object[1] === i)).indexOf(true) === -1\n        });\n        if (updatedPointlist.length > 2){\n          updatedPoints.push(updatedPointlist)\n        }\n      }\n      cornerhandlesIDX = -1\n      let updatedHandles = []\n      for (let handlesList of this.cornerHandles){\n        cornerhandlesIDX += 1\n        let handlesToDelete = handlesList.filter((object, i) => {\n          if (this.selected.map(object => (object[0] === cornerhandlesIDX && object[1] === i)).indexOf(true) !== -1){\n            return true\n          } else {\n            return false\n          }\n        });\n        let handlesToStay = handlesList.filter((object, i) => {\n          return this.selected.map(object => (object[0] === cornerhandlesIDX && object[1] === i)).indexOf(true) === -1\n        });\n        if (handlesToStay.length > 2){\n          updatedHandles.push(handlesToStay)\n        }\n        handlesToDelete.forEach(h => h.parentNode.removeChild(h));\n      }\n      this.midpoints = newMidpoints\n      // Update corner handles\n\n      this.cornerHandles = updatedHandles\n      this.selected = []\n\n      this.setPoints(updatedPoints);\n      // this.emit('update', toSVGTarget(updatedPoints, this.env.image));\n    }\n  }\n\n  deselectCorners = () =>\n    this.cornerHandles.forEach(h => removeClass(h, 'selected'));\n\n  destroy = () => {\n    this.container.parentNode.removeChild(this.container);\n\n    this.svg.removeEventListener('mousemove', this.onMouseMove);\n    this.svg.removeEventListener('mouseup', this.onMouseUp);\n\n    document.body.removeEventListener('keydown', this.onKeyDown);\n\n    super.destroy();\n  }\n\n  drawMidpoint = (x, y) => {\n    const handle = document.createElementNS(SVG_NAMESPACE, 'circle');\n    handle.setAttribute('class', 'a9s-midpoint');\n\n    handle.setAttribute('cx', x);\n    handle.setAttribute('cy', y);\n    handle.setAttribute('r', 5 * this.scale);\n\n    return handle;\n  }\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  onAddPoint = pos => {\n    const corners = getPoints(this.shape);\n    let idx = -1\n    let midpointsIDX = -1\n    for (let midpointList of this.midpoints){\n      midpointsIDX += 1\n      idx = midpointList.indexOf(this.grabbedElement);\n      if (idx > -1){\n        break;\n      }\n    }\n    // Updated polygon points\n    let updatedCorners = []\n    let updatedcornerListIdx = -1\n    let midBefore = null\n    let midAfter = null\n    for (let cornerList of corners){\n      updatedcornerListIdx +=1\n      if (updatedcornerListIdx === midpointsIDX){\n        let updatedCornersList = []\n        let updatedcornerIdx = -1\n        for (let corner of cornerList){\n          updatedcornerIdx += 1\n          updatedCornersList.push(corner)\n          if (updatedcornerIdx === idx){\n            updatedCornersList.push(pos)\n            midBefore = this.createMidpoint(cornerList, updatedcornerIdx -1);\n            midAfter = this.createMidpoint(cornerList, updatedcornerIdx);\n          }\n        }\n        updatedCorners.push(updatedCornersList)\n      } else {\n        updatedCorners.push(cornerList)\n      }\n\n    }\n\n    // New corner handle\n    const cornerHandle = this.createCornerHandle(pos);\n    this.cornerHandles[midpointsIDX] = [\n      ...this.cornerHandles[midpointsIDX].slice(0, idx+1),\n      cornerHandle,\n      ...this.cornerHandles[midpointsIDX].slice(idx+1)\n    ];\n    this.midpoints[midpointsIDX] = [\n      ...this.midpoints[midpointsIDX].slice(0, idx),\n      midBefore,\n      midAfter,\n      ...this.midpoints[midpointsIDX].slice(idx + 1)\n    ];\n    // Delete old midpoint\n    this.grabbedElement.parentNode.removeChild(this.grabbedElement);\n\n    // Make the newly created corner dragged element + selection\n    this.grabbedElement = cornerHandle;\n    //this.onSelectCorner(cornerHandle)();\n\n    // Update shape\n    this.setPoints(updatedCorners);\n  }\n\n  onGrab = element => evt => {\n    if (evt.button !== 0) return;  // left click\n    evt.stopPropagation();\n\n    this.grabbedElement = element;\n    this.grabbedAt = this.getSVGPoint(evt);\n    this.lastMouseDown = new Date().getTime();\n  }\n\n  onKeyDown = ({ which }) => {\n    if (which === 46) {\n      this.deleteSelected();\n    }\n  }\n\n  onMoveShape = pos => {\n    const constrain = (coord, delta, max) =>\n      coord + delta < 0 ? -coord : (coord + delta > max ? max - coord : delta);\n    const { x, y, width, height } = getBBox(this.shape);\n    const { naturalWidth, naturalHeight } = this.env.image;\n\n    const dx = constrain(x, pos.x - this.grabbedAt.x, naturalWidth - width);\n    const dy = constrain(y, pos.y - this.grabbedAt.y, naturalHeight - height);\n    let updatedPoints = []\n    for (let pointlist of getPoints(this.shape)){\n      let newPointList = pointlist.map(pt => ([ pt.x , pt.y ]))\n      if (pointInPolygon([this.grabbedAt.x,this.grabbedAt.y], newPointList)){\n        updatedPoints.push(pointlist.map(pt =>\n          ({ x: pt.x + dx, y: pt.y + dy })))\n      } else {\n        updatedPoints.push(pointlist)\n      }\n    }\n    this.grabbedAt = pos;\n\n    // Update shape\n    this.setPoints(updatedPoints);\n  }\n\n  onMoveCornerHandle = (pos, evt) => {\n    let handleIdx = -1\n    let cornerHandleIdx = 0\n    for (let cornerHandle of this.cornerHandles){\n      handleIdx = cornerHandle.indexOf(this.grabbedElement);\n      if (handleIdx > -1){\n        break\n      } else {\n        cornerHandleIdx += 1\n      }\n    }\n\n    // Update selection\n    if (evt.ctrlKey) {\n      this.selected = Array.from(new Set([...this.selected, handleIdx]));\n    } else if (!this.selected.includes(handleIdx)) {\n      this.selected = [ handleIdx ];\n    }\n\n    // Compute offsets between selected points from current selected\n    const points = getPoints(this.shape);\n\n    const distances = this.selected.map(idx => {\n      const handleXY = points[cornerHandleIdx][handleIdx];\n      const thisXY = points[cornerHandleIdx][idx];\n\n      return {\n        index: idx,\n        dx: thisXY.x - handleXY.x,\n        dy: thisXY.y - handleXY.y\n      }\n    });\n    let cornerHandleIdxUpdate = 0\n    let updatedPoints = []\n    for (let points of getPoints(this.shape)){\n      if (cornerHandleIdxUpdate === cornerHandleIdx){\n        let updatedPointList = points.map((pt, idx) => {\n          if (idx === handleIdx) {\n            // The dragged point\n            return pos;\n          } else if (this.selected.includes(idx)) {\n            const { dx, dy } = distances.find(d => d.index === idx);\n            return {\n              x: pos.x + dx,\n              y: pos.y + dy\n            }\n          } else {\n            // Unchanged\n            return pt;\n          }\n        });\n        updatedPoints.push(updatedPointList);\n      } else {\n        updatedPoints.push(points)\n      }\n      cornerHandleIdxUpdate += 1\n    }\n    this.setPoints(updatedPoints);\n  }\n\n  onMouseMove = evt => {\n    if (this.grabbedElement) {\n      const pos = this.getSVGPoint(evt);\n      if (this.grabbedElement === this.shape) {\n        this.onMoveShape(pos);\n      } else if (hasClass(this.grabbedElement, 'a9s-handle')) {\n        this.onMoveCornerHandle(pos, evt);\n      } else if (hasClass(this.grabbedElement, 'a9s-midpoint')) {\n        this.onAddPoint(pos);\n      }\n\n      this.emit('update', toSVGTarget(getPoints(this.shape), this.env.image));\n    }\n  }\n\n  onMouseUp = evt => {\n    this.grabbedElement = null;\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = scale => {\n    for (let cornerHandle of this.cornerHandles){\n      cornerHandle.map(this.scaleHandle);\n    }\n    for (let midpoints of this.midpoints){\n      midpoints.map(midpoint => {\n        midpoint.setAttribute('r', 5 * this.scale);\n      });\n    }\n  }\n\n  onSelectCorner = handle => evt => {\n    const isDrag = new Date().getTime() - this.lastMouseDown > 250;\n\n    if (!isDrag) {\n      let cornerhandlesIDX = -1\n      let idx = -1\n      for (let corners of this.cornerHandles){\n        cornerhandlesIDX += 1\n        idx = corners.indexOf(handle);\n        if (idx > 0) break\n      }\n\n      if (evt?.ctrlKey) {\n        // Toggle\n        if ( this.selected.map(object => (object[0] === cornerhandlesIDX && object[1] === idx)).indexOf(true) > -1) {\n          this.selected = this.selected.filter(i => {\n            return !(i[1] === idx && i[0] === cornerhandlesIDX)\n          });\n        } else\n          this.selected = [...this.selected, [cornerhandlesIDX, idx]];\n      } else {\n        if (this.selected.length === 1 && (this.selected[0][1] === idx && this.selected[0][0] === cornerhandlesIDX)) {\n          this.selected = [];\n        } else {\n          this.selected = [[cornerhandlesIDX, idx ]];\n        }\n      }\n\n      this.setPoints(getPoints(this.shape));\n    }\n  }\n\n  setPoints = points => {\n    // Not using .toFixed(1) because that will ALWAYS\n    // Set polygon points\n    const str = getPath(points);\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('d', str);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('d', str);\n\n    // Corner handles\n    let cornerIdx = 0\n    for (let pointList of points){\n      console.log(\"pointList of points\", pointList, points);\n      pointList.forEach((pt, idx) => {\n        this.setHandleXY(this.cornerHandles[cornerIdx][idx], pt.x, pt.y)\n      });\n    // Midpoints\n      for (let idx=0; idx<pointList.length; idx++) {\n        const thisCorner = pointList[idx];\n        const nextCorner = idx === pointList.length - 1 ? pointList[0] : pointList[idx + 1];\n        const x = (thisCorner.x + nextCorner.x) / 2;\n        const y = (thisCorner.y + nextCorner.y) / 2;\n\n        const handle = this.midpoints[cornerIdx][idx];\n        handle.setAttribute('cx', x);\n        handle.setAttribute('cy', y);\n      }\n        cornerIdx +=1\n    }\n    let cornerHandleIdx = -1\n    for (let corners of this.cornerHandles){\n      cornerHandleIdx += 1\n\n      corners.forEach((handle, i) => {\n\n        const isSelected = this.selected.map(object => (object[0] === cornerHandleIdx && object[1] === i)).indexOf(true) > -1;\n        if (isSelected && !hasClass(handle, 'selectedCorner')) {\n          addClass(handle, 'selectedCorner');\n        } else if (!isSelected && hasClass(handle, 'selectedCorner')) {\n          removeClass(handle, 'selectedCorner');\n        }\n      });\n    }\n\n    // Resize formatter elements\n    const { x, y, width, height } = outer.getBBox();\n    setFormatterElSize(this.shape, x, y, width, height);\n  }\n\n  updateState = annotation => {\n    const shape = drawEmbeddedSVG(annotation);\n    const points = getPoints(shape);\n    this.setPoints(points);\n  }\n\n}","import RBush from 'rbush';\nimport Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandMultipolygon from './RubberbandMultipolygon';\nimport EditableMultipolygon from './EditableMultipolygon';\nimport { isTouchDevice } from '@recogito/annotorious/src/util/Touch';\n\n/**\n * A rubberband selector for Multipolygon fragments.\n */\nclass MyRBush extends RBush {\n  toBBox([x, y]) { return {minX: x, minY: y, maxX: x, maxY: y}; }\n  compareMinX(a, b) { return a.x - b.x; }\n  compareMinY(a, b) { return a.y - b.y; }\n}\n\nconst isTouch = isTouchDevice();\nexport const getPath = (points) => {\n  const round = num => Math.round(10 * num) / 10;\n  let path = \"\"\n  for (let pointList of points){\n    path += \"M\"\n    let first = true\n    for (let point of pointList){\n      if (first){\n        first = false\n        path += round(point.x).toString() + \",\" + round(point.y).toString()\n      } else {\n        path += \" L\" + round(point.x).toString() + \",\" + round(point.y).toString()\n      }\n    }\n    path += \" Z\"\n  }\n  return path\n}\nexport const toSVGTarget = (points, image) => ({\n  source: image?.src,\n  selector: {\n    type: \"SvgSelector\",\n    value: `<svg><path d=\"${getPath(points)}\" /></svg>`\n  }\n});\n\nexport default class RubberbandMultipolygonTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n    this._isDrawing = false;\n    this.startTime = -1\n    this.contourPointsFunc = null\n    this.contourPoints = []\n    this.contourPointsRBush = new MyRBush()\n    this.viewer = null\n    window.addEventListener('keydown', evt => {\n      if (evt.key === \"z\" && evt.ctrlKey) {\n        this.undo();\n      } else if (evt.key === 'n' || evt.key === 'p') {\n        this.newPart();\n      }\n    },true);\n    this._startOnSingleClick = false;\n  }\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  startDrawing = (x, y, startOnSingleClick, evt, contourPoints) => {\n    this._isDrawing = true\n    console.log(\"start drawing. startTime:\", Date.now());\n    this.startTime = Date.now()\n    this.contourPoints = contourPoints;\n    if (!startOnSingleClick){\n      this._startOnSingleClick = false\n    } else {\n      this._startOnSingleClick = startOnSingleClick;\n    }\n    // this.svg.addEventListener('mousedown', this.onMouseDown);\n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp,\n      dblClick: this.onDblClick\n    });\n\n    this.rubberband = new RubberbandMultipolygon([ x, y ], this.g, this.config, this.env);\n    this.rubberband.on('close', ({ shape, selection }) => {\n      shape.annotation = selection;\n      this.emit('complete', shape);\n      this.stop();\n    });\n  }\n\n  stop = () => {\n    this.detachListeners();\n\n    this._isDrawing = false;\n\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n  undo = () =>{\n    if (this.rubberband){\n      this.rubberband.undo();\n\n    }\n  }\n\n\n  newPart = () =>{\n    if (this.rubberband){\n      this.rubberband.newPart();\n\n    }\n  }\n\n  onMouseMove = (x, y, evt) => {\n    this.rubberband.dragTo([ x, y ]);\n    if (false){\n      if (this.contourPoints){\n        if (this.contourPoints.length !== 0){\n          if (this.contourPoints.length > 0){\n            const closest = this.contourPointsRBush.search({\n              minX: (x - 10),\n              minY: (y - 10),\n              maxX: (x + 10),\n              maxY: (y + 10)\n            })\n            let closestPoint = {\n              \"point\": [0,0],\n              \"dist\": 100\n            }\n            for (const closePoint of closest){\n              const dist = Math.hypot(x-closePoint[0], y-closePoint[1])\n\n              if (dist < closestPoint.dist){\n                closestPoint.point = closePoint\n                closestPoint.dist = dist\n              }\n            }\n            if (closestPoint.dist < 5){\n              this.rubberband.addPoint([ x, y ]);\n            }\n\n          }\n        } else {\n        }\n      }\n    }\n  }\n  setContourPoints(contourPoints, viewer){\n    this.contourPointsFunc = contourPoints\n    this.viewer = viewer\n  }\n\n  onMouseUp = (x, y, evt) => {\n    if (evt.altKey){\n      this.onDblClickOld(x,y);\n    } else if (evt.ctrlKey) {\n      this.rubberband.undo();\n    } else if (evt.shiftKey && this.rubberband.points.length>2) {\n      this.newPart();\n    } else{\n      const { width, height } = this.rubberband.getBoundingClientRect();\n\n      const minWidth = this.config.minSelectionWidth || 4;\n      const minHeight = this.config.minSelectionHeight || 4;\n      if (width >= minWidth || height >= minHeight) {\n        this.rubberband.addPoint([ x, y ]);\n      } else {\n        this.emit('cancel');\n        this.stop();\n      }\n    }\n  }\n  onScaleChanged = scale => {\n\n    if (this.rubberband)\n      this.rubberband.onScaleChanged(scale);\n  }\n  onDblClickOld = (x, y) => {\n    console.log(\"ondoubleclick\", x,y);\n    this._isDrawing = false;\n    this.rubberband.addPoint([ x, y ]);\n\n    const shape = this.rubberband.element;\n    console.log(\"this.rubberband.toSelection();\", this.rubberband.toSelection());\n    shape.annotation = this.rubberband.toSelection();\n    console.log(\"shape\", shape.annotation.underlying.target.selector.value);\n    this.emit('complete', shape);\n\n    this.stop();\n  }\n\n  onDblClick = (x, y) => {\n  }\n\n  createEditableShape = annotation =>\n    new EditableMultipolygon(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandMultipolygonTool.identifier = 'multipolygon';\n\nRubberbandMultipolygonTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<path d=/g);\n}","import { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\n\nexport default class LineMask {\n\n  constructor(imageDimensions, line) {\n    this.w = imageDimensions.naturalWidth;\n    this.h = imageDimensions.naturalHeight;\n\n    this.line = line;\n\n    this.mask = document.createElementNS(SVG_NAMESPACE, 'path');\n    this.mask.setAttribute('fill-rule', 'evenodd');\n    this.mask.setAttribute('class', 'a9s-selection-mask');\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${this.line.getAttribute('x1')} ${this.line.getAttribute('y1')} z`);\n  }\n\n  redraw = () => {\n    this.mask.setAttribute('d', `M0 0 h${this.w} v${this.h} h-${this.w} z M${this.line.getAttribute('x1')} ${this.line.getAttribute('y1')} ${this.line.getAttribute('x2')} ${this.line.getAttribute('y2')}z`);\n  }\n\n  get element() {\n    return this.mask;\n  }\n\n  destroy = () =>\n    this.mask.parentNode.removeChild(this.mask)\n\n}","import { Selection } from '@recogito/annotorious/src/tools/Tool';\nimport { toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport Mask from './LineMask';\n\n\n/**\n * A 'rubberband' selection tool for creating Line drawing by\n * clicking and dragging.\n */\nexport default class RubberbandLine {\n\n  constructor(anchor, g, env) {\n    this.points =  anchor\n    //this.points.push([ anchor, anchor ])\n\n    this.env = env;\n\n    this.group = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.Line = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.Line.setAttribute('class', 'a9s-selection');\n\n    this.outer = document.createElementNS(SVG_NAMESPACE, 'line');\n    this.outer.setAttribute('class', 'a9s-outer');\n\n    this.inner = document.createElementNS(SVG_NAMESPACE, 'line');\n    this.inner.setAttribute('class', 'a9s-inner');\n\n    this.setPoints(this.points);\n    this.mask = new Mask(env.image, this.inner);\n\n    // TODO optional: mask to dim the outside area\n    // this.mask = new Mask(env.image, this.inner);\n\n    this.Line.appendChild(this.outer);\n    this.Line.appendChild(this.inner);\n\n    // Additionally, selection remains hidden until \n    // the user actually moves the mouse\n    this.group.style.display = 'none';\n\n    // TODO optional: mask to dim the outside area\n    // this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.mask.element);\n    this.group.appendChild(this.Line);\n\n    g.appendChild(this.group);\n  }\n\n  setPoints = points => {\n    const attr = points;\n    // set attribute for line svg element for outer and inner\n    // example: <line x1=\"0\" y1=\"80\" x2=\"100\" y2=\"20\" stroke=\"black\" />\n    this.outer.setAttribute('x1', attr[0]);\n    this.inner.setAttribute('x1', attr[0]);\n    this.outer.setAttribute('y1', attr[1]);\n    this.inner.setAttribute('y1', attr[1]);\n    if(attr.length > 2) {\n    this.outer.setAttribute('x2', attr[2]);\n    this.inner.setAttribute('x2', attr[2]);\n    this.outer.setAttribute('y2', attr[3]);\n    this.inner.setAttribute('y2', attr[3]);\n    }\n  }\n\n  getBoundingClientRect = () =>\n    this.outer.getBoundingClientRect();\n\n  dragTo = xy => {\n    // Make visible\n    this.group.style.display = null;\n\n    this.mousepos = xy;\n    //console.log(xy);\n    const rubberband = [ ...this.points, xy[0], xy[1] ];\n    \n    this.setPoints(rubberband);\n    this.mask.redraw();\n  }\n  \n  addPoint = xy => {\n    // Don't add a new point if distance < 2 pixels\n    if (this.points.length <= 2) {\n      this.points[2] = xy[0];\n      this.points[3] = xy[1];\n      this.setPoints(this.points);\n    }\n  }\n\n  undo = () => {\n    if (this.points[this.points.length - 1].length>2){\n      this.points[this.points.length - 1].pop();\n    } else {\n      if (this.points.length>1){\n        this.points.pop()\n      }\n    }\n  }\n\n  newPart = () => {\n    this.points.push([]);\n  }\n \n  get element() {\n    return this.Line;\n  }\n\n  destroy = () => {\n    this.group.parentNode.removeChild(this.group);\n    this.Line = null;    \n    this.group = null;\n  }\n\n  toSelection = () =>\n    new Selection({\n      ...toSVGTarget(this.group, this.env.image),\n      renderedVia: {\n        name: 'line'\n      }\n    });\n\n}\n","import EditableShape from '@recogito/annotorious/src/tools/EditableShape';\nimport { drawEmbeddedSVG, svgFragmentToShape, toSVGTarget } from '@recogito/annotorious/src/selectors/EmbeddedSVG';\nimport { SVG_NAMESPACE } from '@recogito/annotorious/src/util/SVG';\nimport { format, setFormatterElSize } from '@recogito/annotorious/src/util/Formatting';\nimport Mask from './LineMask';\n\nconst getPoints = shape => {\n  // Could just be Array.from(shape.querySelector('.inner').points) but...\n  // IE11 :-(\n  const innerElement = shape.querySelector('.a9s-inner');\n  const points = [\n    [innerElement.x1.baseVal, innerElement.y1.baseVal],\n    [innerElement.x2.baseVal, innerElement.y2.baseVal]\n  ];\n\n  return points;\n}\n\nconst getBBox = shape =>\n  shape.querySelector('.a9s-inner').getBBox();\n\n/**\n * An editable line shape.\n */\nexport default class EditableLine extends EditableShape {\n\n  constructor(annotation, g, config, env) {\n    super(annotation, g, config, env);\n\n    this.svg.addEventListener('mousemove', this.onMouseMove);\n    this.svg.addEventListener('mouseup', this.onMouseUp);\n\n    // SVG markup for this class looks like this:\n    //\n    // <g>\n    //   <path class=\"a9s-selection mask\"... />\n    //   <g> <-- return this node as .element\n    //     <line class=\"a9s-outer\" ... />\n    //     <line class=\"a9s-inner\" ... />\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     <g class=\"a9s-handle\" ...> ... </g>\n    //     ...\n    //   </g>\n    // </g>\n\n    // 'g' for the editable line shape\n    this.containerGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n\n    this.shape = drawEmbeddedSVG(annotation);\n    this.shape.querySelector('.a9s-inner')\n      .addEventListener('mousedown', this.onGrab(this.shape));\n\n    this.mask = new Mask(env.image, this.shape.querySelector('.a9s-inner'));\n\n    this.containerGroup.appendChild(this.mask.element);\n\n    this.elementGroup = document.createElementNS(SVG_NAMESPACE, 'g');\n    this.elementGroup.setAttribute('class', 'a9s-annotation editable selected');\n    this.elementGroup.setAttribute('data-id', annotation.id);\n    this.elementGroup.appendChild(this.shape);\n\n    this.handles = getPoints(this.shape).map(pt => {\n      const handle = this.drawHandle(pt[0].value, pt[1].value);\n      handle.addEventListener('mousedown', this.onGrab(handle));\n      this.elementGroup.appendChild(handle);\n      return handle;\n    });\n\n    this.containerGroup.appendChild(this.elementGroup);\n    g.appendChild(this.containerGroup);\n\n    format(this.shape, annotation, config.formatters);\n\n    // The grabbed element (handle or entire shape), if any\n    this.grabbedElem = null;\n\n    // Mouse grab point\n    this.grabbedAt = null;\n  }\n\n  onScaleChanged = () => \n    this.handles.map(this.scaleHandle);\n\n  setPoints = (points) => {\n    // Not using .toFixed(1) because that will ALWAYS\n    // return one decimal, e.g. \"15.0\" (when we want \"15\")\n    const round = num =>\n      Math.round(10 * num) / 10;\n\n    var x1 = points[0].x;\n    var y1 = points[0].y;\n    var x2 = points[1].x;\n    var y2 = points[1].y;\n    const inner = this.shape.querySelector('.a9s-inner');\n    inner.setAttribute('x1', x1);\n    inner.setAttribute('y1', y1);\n    inner.setAttribute('x2', x2);\n    inner.setAttribute('y2', y2);\n\n    const outer = this.shape.querySelector('.a9s-outer');\n    outer.setAttribute('x1', x1);\n    outer.setAttribute('y1', y1);\n    outer.setAttribute('x2', x2);\n    outer.setAttribute('y2', y2);\n\n    this.mask.redraw();\n\n    const { x, y, width, height } = outer.getBBox();\n    setFormatterElSize(this.elementGroup, x, y, width, height);\n  }\n\n  onGrab = grabbedElem => evt => {\n    if (evt.button !== 0) return;  // left click\n    this.grabbedElem = grabbedElem;\n    this.grabbedAt = this.getSVGPoint(evt);\n  }\n\n  onMouseMove = evt => {\n    const constrain = (coord, delta, max) =>\n      coord + delta < 0 ? -coord : (coord + delta > max ? max - coord : delta);\n\n    if (this.grabbedElem) {\n      const pos = this.getSVGPoint(evt);\n      if (this.grabbedElem === this.shape) {\n        const { x, y, width, height } = getBBox(this.shape);\n\n        const { naturalWidth, naturalHeight } = this.env.image;\n\n        const dx = constrain(x, pos.x - this.grabbedAt.x, naturalWidth - width);\n        const dy = constrain(y, pos.y - this.grabbedAt.y, naturalHeight - height);\n\n        const updatedPoints = getPoints(this.shape).map(pt =>\n          ({ x: pt[0].value + dx, y: pt[1].value + dy }));\n\n        this.grabbedAt = pos;\n\n        this.setPoints(updatedPoints);\n        updatedPoints.forEach((pt, idx) => this.setHandleXY(this.handles[idx], pt.x, pt.y));\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      } else {\n        const handleIdx = this.handles.indexOf(this.grabbedElem);\n\n        const updatedPoints = getPoints(this.shape).map((pt, idx) =>\n          (idx === handleIdx) ? pos : {'x':pt[0].value, 'y':pt[1].value});\n\n        this.setPoints(updatedPoints);\n        this.setHandleXY(this.handles[handleIdx], pos.x, pos.y);\n\n        this.emit('update', toSVGTarget(this.shape, this.env.image));\n      }\n    }\n  }\n\n  onMouseUp = evt => {\n    this.grabbedElem = null;\n    this.grabbedAt = null;\n  }\n\n  get element() {\n    return this.elementGroup;\n  }\n\n  // TODO: update this for line svg Attributes, currently not being used\n  updateState = annotation => {\n    const points = svgFragmentToShape(annotation)\n      .getAttribute('points')\n      .split(' ') // Split x/y tuples\n      .map(xy => { \n        const [ x, y ] = xy.split(',').map(str => parseFloat(str.trim()));\n        return { x, y };\n      });\n    \n    this.setPoints(points);\n    points.forEach((pt, idx) => this.setHandleXY(this.handles[idx], pt.x, pt.y));\n  }\n\n  destroy = () => {\n    this.containerGroup.parentNode.removeChild(this.containerGroup);\n    super.destroy();\n  }\n\n}\n","import Tool from '@recogito/annotorious/src/tools/Tool';\nimport RubberbandLine from './RubberbandLine';\nimport EditableLine from './EditableLine';\n\n/**\n * A rubberband selector for Line fragments.\n */\nexport default class RubberbandLineTool extends Tool {\n\n  constructor(g, config, env) {\n    super(g, config, env);\n\n    this._isDrawing = false;\n    \n    document.addEventListener('keydown', evt => {\n      if (evt.key == \"z\" && evt.ctrlKey) {\n        this.undo();\n      }\n      \n      if (evt.key == 'n') {\n        this.newPart();\n      }\n    });  \n  }\n\n  startDrawing = (x, y) => {\n    this._isDrawing = true;\n    \n    this.attachListeners({\n      mouseMove: this.onMouseMove,\n      mouseUp: this.onMouseUp,\n    });\n    \n    this.rubberband = new RubberbandLine([ x, y ], this.g, this.env);\n  }\n\n  stop = () => {\n    this.detachListeners();\n    \n    this._isDrawing = false;\n\n    if (this.rubberband) {\n      this.rubberband.destroy();\n      this.rubberband = null;\n    }\n  }\n  undo = () =>{\n    if (this.rubberband){\n      this.rubberband.undo();\n\n    }\n  }\n  newPart = () =>{\n    if (this.rubberband){\n      this.rubberband.newPart();\n\n    }\n  }\n\n  onMouseMove = (x, y) =>\n    this.rubberband.dragTo([ x, y ]);\n\n  onMouseUp = (x, y, evt) => {\n    if (evt.altKey){\n      this.onDblClick(evt);\n    } else if (evt.ctrlKey) {\n      this.rubberband.undo();\n    } else{\n      // TODO: see when this is useful\n      // const { width, height } = this.rubberband.getBoundingClientRect();\n\n      // const minWidth = this.config.minSelectionWidth || 4;\n      // const minHeight = this.config.minSelectionHeight || 4;\n      \n      if (this.rubberband.points.length == 2) {\n        this.rubberband.addPoint([ x, y ]); \n        // check if both coordinates are same\n        if (this.rubberband.points[0] == this.rubberband.points[2] && this.rubberband.points[1] == this.rubberband.points[3]) {\n          this.emit('cancel');\n          this.stop();\n        }\n        else{\n          this._isDrawing = false;\n          const shape = this.rubberband.element;\n          shape.annotation = this.rubberband.toSelection();\n          this.emit('complete', shape);\n          this.stop();\n        }\n      }\n    }\n  }\n  \n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  get isDrawing() {\n    return this._isDrawing;\n  }\n\n  createEditableShape = annotation => \n    new EditableLine(annotation, this.g, this.config, this.env);\n\n}\n\nRubberbandLineTool.identifier = 'line';\n\nRubberbandLineTool.supports = annotation => {\n  const selector = annotation.selector('SvgSelector');\n  if (selector)\n    return selector.value?.match(/^<svg.*<line/g);\n}","import PointTool from './point/PointTool';\nimport RubberbandCircleTool from './circle/RubberbandCircleTool';\nimport RubberbandEllipseTool from './ellipse/RubberbandEllipseTool';\nimport RubberbandFreehandTool from './freehand/RubberbandFreehandTool';\nimport RubberbandMultipolygonTool from './multipolygon/RubberbandMultipolygonTool';\nimport RubberbandLineTool from './line/RubberbandLineTool';\n\nconst ALL_TOOLS = new Set([\n  'point',\n  'circle',\n  'ellipse',\n  'freehand',\n  'line',\n  'multipolygon' // exclude from defaults for now\n]);\n\nconst SelectorPack = (anno, config) => {\n\n  // Add configured tools, or all\n  const tools = config?.tools ?\n    config.tools.map(t => t.toLowerCase()) : ALL_TOOLS;\n\n  tools.forEach(tool => {\n    if (tool === 'point')\n      anno.addDrawingTool(PointTool);\n\n    if (tool === 'circle')\n      anno.addDrawingTool(RubberbandCircleTool);\n\n    if (tool === 'ellipse')\n      anno.addDrawingTool(RubberbandEllipseTool);\n\n    if (tool === 'freehand')\n      anno.addDrawingTool(RubberbandFreehandTool);\n\n    if (tool === 'multipolygon')\n      anno.addDrawingTool(RubberbandMultipolygonTool);\n\n    if (tool === 'line')\n      anno.addDrawingTool(RubberbandLineTool);\n  });\n\n}\n\nexport default SelectorPack;\n"],"names":["root","factory","exports","module","define","amd","self","cssWithMappingToString","list","toString","this","map","item","content","concat","join","i","modules","mediaQuery","dedupe","alreadyImportedModules","length","id","_i","push","_arrayLikeToArray","arr","len","arr2","Array","_item","isArray","_arrayWithHoles","Symbol","iterator","_s","_e","_arr","_n","_d","call","next","done","value","err","_iterableToArrayLimit","o","minLen","n","Object","prototype","slice","constructor","name","from","test","_unsupportedIterableToArray","TypeError","_nonIterableRest","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","sourceURLs","sources","source","sourceRoot","t","r","e","a","h","s","l","Math","log","f","exp","u","sqrt","max","floor","min","p","d","x","_maxEntries","_minEntries","ceil","clear","indexOf","children","minX","minY","maxX","maxY","leaf","m","c","height","pop","all","_all","search","toBBox","collides","load","insert","_build","_splitRoot","_insert","remove","splice","_condense","compareMinX","compareMinY","toJSON","fromJSON","apply","pow","_chooseSubtree","_split","_adjustParentBBoxes","_chooseSplitAxis","_chooseSplitIndex","v","M","_allDistMargin","sort","_typeof","obj","equal","b","keys","RegExp","flags","valueOf","hasOwnProperty","key","E","on","callback","ctx","fn","once","listener","off","arguments","_","emit","evtArr","evts","liveEvents","TinyEmitter","___CSS_LOADER_EXPORT___","memo","getTarget","target","styleTarget","document","querySelector","window","HTMLIFrameElement","contentDocument","head","stylesInDom","getIndexByIdentifier","identifier","result","modulesToDom","options","idCountMap","identifiers","base","count","index","css","media","sourceMap","references","updater","addStyle","insertStyleElement","style","createElement","attributes","nonce","forEach","setAttribute","Error","appendChild","textStore","replaceText","replacement","filter","Boolean","applyToSingletonTag","styleSheet","cssText","cssNode","createTextNode","childNodes","removeChild","insertBefore","applyToTag","removeAttribute","firstChild","singleton","singletonCounter","update","styleIndex","bind","parentNode","removeStyleElement","newObj","atob","lastIdentifiers","newList","newLastIdentifiers","_index","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","__esModule","definition","defineProperty","enumerable","get","prop","nc","getRandomValues","isTouchDevice","navigator","maxTouchPoints","msMaxTouchPoints","SVG_NAMESPACE","getClassNames","el","attr","getAttribute","Set","split","addClass","className","classNames","add","removeClass","size","hasClass","has","rnds8","Uint8Array","rng","crypto","msCrypto","uuid","REGEX","byteToHex","substr","buf","offset","rnds","random","toLowerCase","validate","WebAnnotation","annotation","opts","_this","_classCallCheck","_defineProperty","opt_props","opt_opts","_objectSpread","underlying","type","selector","find","other","equals","_this$opts","readOnly","motivation","body","set","bodies","_this$selector","exact","_this$selector2","start","_this$selector3","end","args","stub","Selection","cloned","parse","assign","IMPLEMENTATION_MISSING","isTouch","ToolLike","_EventEmitter","_inherits","_super","_createSuper","g","config","env","_assertThisInitialized","ResizeObserver","resizeObserver","svgBounds","svg","getBoundingClientRect","_this$svg$viewBox$bas","viewBox","baseVal","width","scale","onScaleChanged","observe","evt","pt","createSVGPoint","bbox","clientX","y","clientY","_this$svg$getBounding","left","top","matrixTransform","getScreenCTM","inverse","offsetX","offsetY","getCTM","containerGroup","createElementNS","group","drawCircle","radius","handleRadius","inner","outer","handle","parseFloat","closest","image","Element","HTMLDocument","enableResponsive","_createClass","disconnect","EventEmitter","Tool","_ToolLike","_super2","_this2","_ref","mouseMove","mouseUp","dblClick","_this2$getSVGPoint","getSVGPoint","started","addEventListener","button","_this2$getSVGPoint2","_this2$getSVGPoint3","removeEventListener","startOnSingleClick","_this2$getSVGPoint4","_this2$env$image","naturalWidth","naturalHeight","startX","startY","startDrawing","formatters","supports","EditableShape","parseRectFragment","conformsTo","startsWith","format","includes","substring","_coords$split$map2","_slicedToArray","w","isPoint","_annotation$target$re","renderedVia","toFragment","fragmentUnit","px","py","pw","ph","src","toPercentRectFragment","toPixelRectFragment","toRectFragment","EditablePoint","_EditableShape","scaleHandle","point","isGrabbed","_this$getSVGPoint","setHandleXY","_parseRectFragment","onMouseMove","onMouseUp","_parseRectFragment2","container","elementGroup","drawHandle","onGrab","_get","_getPrototypeOf","PointTool","_Tool","_evt$target$closest","element","sanitize","doc","cleanEl","scripts","getElementsByTagName","reverse","querySelectorAll","svgFragmentToShape","originalDoc","namespaced","parser","DOMParser","parseFromString","isPrefixDeclared","lookupPrefix","isDefaultNamespaceSVG","lookupNamespaceURI","XMLSerializer","serializeToString","documentElement","replace","drawEmbeddedSVG","shape","cloneNode","toSVGTarget","serialized","outerHTML","setXYR","cx","cy","outerCircle","innerCircle","setCircleSize","getCircleSize","CircleMask","imageDimensions","circle","_getCircleSize","tx","ty","mask","_getCircleSize2","RubberbandCircle","anchorX","anchorY","oppositeX","oppositeY","_this$env$image","display","anchor","redraw","Mask","pointerEvents","isFirefox","userAgent","formatSvgEl","svgEl","reduce","merged","String","nodeType","Node","ELEMENT_NODE","elements","_toConsumableArray","formatterEl","_shape$getBBox","getBBox","append","appendFormatterEl","setFormatterElSize","EditableCircle","_this$handles","handles","topleft","topright","bottomright","bottomleft","draggedHandleIdx","anchorHandle","mousePos","getHandleXY","mouseX","mouseY","abs","idx0","idx2","idx3","idx1","grabbedElem","pos","grabbedAt","constrain","coord","setSize","handleIdx","oppositeHandle","stretchCorners","_getCircleSize3","_t","formatter","RubberbandCircleTool","attachListeners","rubberband","destroy","dragTo","detachListeners","_this$rubberband$getB","minWidth","minSelectionWidth","minHeight","minSelectionHeight","toSelection","stop","_selector$value","match","rx","ry","drawEllipse","innerEllipse","outerEllipse","setEllipseSize","getEllipseSize","EllipseMask","ellipse","_getEllipseSize","_getEllipseSize2","RubberbandEllipse","EditableEllipse","leftHandle","anchorLeft","_getEllipseSize3","RubberbandEllipseTool","RubberbandFreehand","points","str","xy","addPoint","setPoints","freehand","getPoints","pointList","trim","EditableFreehand","_thisSuper","round","num","_outer$getBBox","delta","_getBBox","dx","dy","updatedPoints","_getBBox2","RubberbandFreehandTool","_isDrawing","onDblClick","toUpperCase","RubberbandMultipolygon","_step","_iterator","_createForOfIteratorHelper","ps","attr2","_step2","_iterator2","multipolygon","mousepos","headRest","closeHandle","lastCorner","getDistanceToStart","Infinity","console","pointInPolygon","inside","j","xi","yi","xj","yj","getPointsFromPathValue","polygon","results","allcoords","coords","toFixed","pointArray","nodeValue","svgFragmentToPoints","EditableMultipolygon","onSelectCorner","corners","idx","thisCorner","nextCorner","drawMidpoint","selected","_step3","cornerhandlesIDX","newMidpoints","_iterator3","midpoints","midpointList","updatedMidpointlist","object","midpointsToDelete","_step4","_iterator4","updatedPointlist","_step5","updatedHandles","_iterator5","cornerHandles","handlesList","handlesToDelete","handlesToStay","onKeyDown","_step6","midpointsIDX","_iterator6","grabbedElement","_step7","updatedCorners","updatedcornerListIdx","midBefore","midAfter","_iterator7","cornerList","_step8","updatedCornersList","updatedcornerIdx","_iterator8","corner","createMidpoint","cornerHandle","createCornerHandle","stopPropagation","lastMouseDown","Date","getTime","which","deleteSelected","_step9","_iterator9","pointlist","newPointList","_step10","cornerHandleIdx","_iterator10","ctrlKey","_step11","distances","handleXY","thisXY","cornerHandleIdxUpdate","_iterator11","updatedPointList","_distances$find","onMoveShape","onMoveCornerHandle","onAddPoint","_step12","_iterator12","_step13","_iterator13","midpoint","_step14","_iterator14","getPath","_step15","cornerIdx","_iterator15","_step16","_iterator16","isSelected","_step17","_iterator17","_loop","MyRBush","_RBush","_ref2","RBush","path","first","RubberbandMultipolygonTool","contourPoints","now","startTime","_startOnSingleClick","_ref3","selection","undo","newPart","altKey","onDblClickOld","shiftKey","contourPointsFunc","contourPointsRBush","viewer","LineMask","line","RubberbandLine","Line","innerElement","x1","y1","x2","y2","EditableLine","_xy$split$map2","RubberbandLineTool","ALL_TOOLS","anno","tools","tool","addDrawingTool"],"sourceRoot":""}