/*! For license information please see annotorious-selector-pack.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Annotorious=t():(e.Annotorious=e.Annotorious||{},e.Annotorious.SelectorPack=t())}(self,(()=>(()=>{var e={922:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,r){"string"==typeof e&&(e=[[null,e,""]]);var o={};if(r)for(var i=0;i<this.length;i++){var a=this[i][0];null!=a&&(o[a]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);r&&o[c[0]]||(n&&(c[2]?c[2]="".concat(n," and ").concat(c[2]):c[2]=n),t.push(c))}},t}},162:e=>{"use strict";function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.exports=function(e){var n,r,o=(r=4,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(n,r)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=o[1],a=o[3];if(!a)return i;if("function"==typeof btoa){var u=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(u),l="/*# ".concat(c," */"),s=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[i].concat(s).concat([l]).join("\n")}return[i].join("\n")}},72:function(e,t,n){var r,o,i;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}i=function(){"use strict";function e(e,r,o,i,a){!function e(n,r,o,i,a){for(;i>o;){if(i-o>600){var u=i-o+1,c=r-o+1,l=Math.log(u),s=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*s*(u-s)/u)*(c-u/2<0?-1:1);e(n,r,Math.max(o,Math.floor(r-c*s/u+f)),Math.min(i,Math.floor(r+(u-c)*s/u+f)),a)}var p=n[r],d=o,y=i;for(t(n,o,r),a(n[i],p)>0&&t(n,o,i);d<y;){for(t(n,d,y),d++,y--;a(n[d],p)<0;)d++;for(;a(n[y],p)>0;)y--}0===a(n[o],p)?t(n,o,y):t(n,++y,i),y<=r&&(o=y+1),r<=y&&(i=y-1)}}(e,r,o||0,i||e.length-1,a||n)}function t(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function n(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(e,t,n){if(!n)return t.indexOf(e);for(var r=0;r<t.length;r++)if(n(e,t[r]))return r;return-1}function i(e,t){a(e,0,e.children.length,t,e)}function a(e,t,n,r,o){o||(o=y(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=t;i<n;i++){var a=e.children[i];u(o,e.leaf?r(a):a)}return o}function u(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function s(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function f(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function d(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function y(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function h(t,n,r,o,i){for(var a=[n,r];a.length;)if(!((r=a.pop())-(n=a.pop())<=o)){var u=n+Math.ceil((r-n)/o/2)*o;e(t,u,n,r,i),a.push(n,u,u,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,n=[];if(!d(e,t))return n;for(var r=this.toBBox,o=[];t;){for(var i=0;i<t.children.length;i++){var a=t.children[i],u=t.leaf?r(a):a;d(e,u)&&(t.leaf?n.push(a):p(e,u)?this._all(a,n):o.push(a))}t=o.pop()}return n},r.prototype.collides=function(e){var t=this.data;if(!d(e,t))return!1;for(var n=[];t;){for(var r=0;r<t.children.length;r++){var o=t.children[r],i=t.leaf?this.toBBox(o):o;if(d(e,i)){if(t.leaf||p(e,i))return!0;n.push(o)}}t=n.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=y([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var n,r,i,a=this.data,u=this.toBBox(e),c=[],l=[];a||c.length;){if(a||(a=c.pop(),r=c[c.length-1],n=l.pop(),i=!0),a.leaf){var s=o(e,a.children,t);if(-1!==s)return a.children.splice(s,1),c.push(a),this._condense(c),this}i||a.leaf||!p(a,u)?r?(n++,a=r.children[n],i=!1):a=null:(c.push(a),l.push(n),n=0,r=a,a=a.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var n=[];e;)e.leaf?t.push.apply(t,e.children):n.push.apply(n,e.children),e=n.pop();return t},r.prototype._build=function(e,t,n,r){var o,a=n-t+1,u=this._maxEntries;if(a<=u)return i(o=y(e.slice(t,n+1)),this.toBBox),o;r||(r=Math.ceil(Math.log(a)/Math.log(u)),u=Math.ceil(a/Math.pow(u,r-1))),(o=y([])).leaf=!1,o.height=r;var c=Math.ceil(a/u),l=c*Math.ceil(Math.sqrt(u));h(e,t,n,l,this.compareMinX);for(var s=t;s<=n;s+=l){var f=Math.min(s+l-1,n);h(e,s,f,c,this.compareMinY);for(var p=s;p<=f;p+=c){var d=Math.min(p+c-1,f);o.children.push(this._build(e,p,d,r-1))}}return i(o,this.toBBox),o},r.prototype._chooseSubtree=function(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){for(var o=1/0,i=1/0,a=void 0,u=0;u<t.children.length;u++){var c=t.children[u],l=s(c),f=(p=e,d=c,(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY))-l);f<i?(i=f,o=l<o?l:o,a=c):f===i&&l<o&&(o=l,a=c)}t=a||t.children[0]}var p,d;return t},r.prototype._insert=function(e,t,n){var r=n?e:this.toBBox(e),o=[],i=this._chooseSubtree(r,this.data,t,o);for(i.children.push(e),u(i,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)},r.prototype._split=function(e,t){var n=e[t],r=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,r);var a=this._chooseSplitIndex(n,o,r),u=y(n.children.splice(a,n.children.length-a));u.height=n.height,u.leaf=n.leaf,i(n,this.toBBox),i(u,this.toBBox),t?e[t-1].children.push(u):this._splitRoot(n,u)},r.prototype._splitRoot=function(e,t){this.data=y([e,t]),this.data.height=e.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,n){for(var r,o,i,u,c,l,f,p=1/0,d=1/0,y=t;y<=n-t;y++){var h=a(e,0,y,this.toBBox),b=a(e,y,n,this.toBBox),m=(o=h,i=b,u=Math.max(o.minX,i.minX),c=Math.max(o.minY,i.minY),l=Math.min(o.maxX,i.maxX),f=Math.min(o.maxY,i.maxY),Math.max(0,l-u)*Math.max(0,f-c)),v=s(h)+s(b);m<p?(p=m,r=y,d=v<d?v:d):m===p&&v<d&&(d=v,r=y)}return r||n-t},r.prototype._chooseSplitAxis=function(e,t,n){var r=e.leaf?this.compareMinX:c,o=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,o)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,n,r){e.children.sort(r);for(var o=this.toBBox,i=a(e,0,t,o),c=a(e,n-t,n,o),l=f(i)+f(c),s=t;s<n-t;s++){var p=e.children[s];u(i,e.leaf?o(p):p),l+=f(i)}for(var d=n-t-1;d>=t;d--){var y=e.children[d];u(c,e.leaf?o(y):y),l+=f(c)}return l},r.prototype._adjustParentBBoxes=function(e,t,n){for(var r=n;r>=0;r--)u(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,n=void 0;t>=0;t--)0===e[t].children.length?t>0?(n=e[t-1].children).splice(n.indexOf(e[t]),1):this.clear():i(e[t],this.toBBox)},r},"object"==a(t)?e.exports=i():void 0===(o="function"==typeof(r=i)?r.call(t,n,t,e):r)||(e.exports=o)},703:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}e.exports=function e(n,r){if(n===r)return!0;if(n&&r&&"object"==t(n)&&"object"==t(r)){if(n.constructor!==r.constructor)return!1;var o,i,a;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!e(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(a=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,a[i]))return!1;for(i=o;0!=i--;){var u=a[i];if(!e(n[u],r[u]))return!1}return!0}return n!=n&&r!=r}},902:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,a=r.length;i<a;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t},800:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(162),o=n.n(r),i=n(922),a=n.n(i)()(o());a.push([e.id,".a9s-selection.improved-polygon .a9s-rubberband{fill:rgba(255,255,255,.15);stroke-width:1px;stroke:rgba(0,0,0,.3)}.a9s-selection.improved-polygon .a9s-inner,.a9s-annotation.improved-polygon.editable .a9s-inner{stroke-width:2px;stroke:#fff;stroke-dasharray:5 3}.a9s-annotation.improved-polygon.editable .a9s-inner:hover{fill:transparent}.a9s-selection.improved-polygon .a9s-outer,.a9s-annotation.improved-polygon.editable .a9s-outer{stroke-width:4px;stroke:rgba(0,0,0,.35)}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-outer,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-outer{stroke-width:1;stroke:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner{stroke-width:2;stroke:#fff;fill:#000;color:green}.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner:hover,.a9s-annotation.improved-polygon.editable .a9s-handle.selected .a9s-handle-inner,.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner:hover{fill:#fff;color:green}.selectedCorner{fill:#fff !important}.selectedCorner .a9s-handle-inner{fill:#fff !important;color:green}.a9s-annotation.improved-polygon.editable .a9s-midpoint{display:none;fill:rgba(255,255,255,.65);stroke-width:1;stroke:rgba(0,0,0,.65)}.a9s-annotation.improved-polygon.editable:hover .a9s-midpoint{display:block}.a9s-annotation.improved-polygon.editable .a9s-midpoint:hover{fill:#fff}","",{version:3,sources:["webpack://./src/index.scss"],names:[],mappings:"AACA,gDACE,0BAAA,CACA,gBAAA,CACA,qBAAA,CAIF,gGAEE,gBAAA,CACA,WAAA,CACA,oBAAA,CAGF,2DACE,gBAAA,CAGF,gGAEE,gBAAA,CACA,sBAAA,CAIF,sIAEE,cAAA,CACA,WAAA,CACA,WAAA,CAGF,sIAEE,cAAA,CACA,WAAA,CACA,SAAA,CACA,WAAA,CAGF,mOAGE,SAAA,CACA,WAAA,CAEF,gBACE,oBAAA,CAEF,kCACE,oBAAA,CACA,WAAA,CAGF,wDACE,YAAA,CACA,0BAAA,CACA,cAAA,CACA,sBAAA,CAGF,8DACE,aAAA,CAGF,8DACE,SAAA",sourcesContent:["/** Rubberband **/\n.a9s-selection.improved-polygon .a9s-rubberband {\n  fill:rgba(255,255,255,0.15);\n  stroke-width:1px;\n  stroke:rgba(0, 0, 0, 0.3);\n}\n\n/** Polygon **/\n.a9s-selection.improved-polygon .a9s-inner,\n.a9s-annotation.improved-polygon.editable .a9s-inner {\n  stroke-width:2px;\n  stroke:#fff;\n  stroke-dasharray:5 3;\n}\n\n.a9s-annotation.improved-polygon.editable .a9s-inner:hover {\n  fill:transparent;\n}\n\n.a9s-selection.improved-polygon .a9s-outer,\n.a9s-annotation.improved-polygon.editable .a9s-outer {\n  stroke-width:4px;\n  stroke:rgba(0, 0, 0, 0.35);\n}\n\n/** Corner handles **/\n.a9s-selection.improved-polygon .a9s-handle .a9s-handle-outer,\n.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-outer {\n  stroke-width:1;\n  stroke:#000;\n  color:green;\n}\n\n.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner,\n.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner {\n  stroke-width:2;\n  stroke:#fff;\n  fill:#000;\n  color:green;\n}\n\n.a9s-selection.improved-polygon .a9s-handle .a9s-handle-inner:hover,\n.a9s-annotation.improved-polygon.editable .a9s-handle.selected .a9s-handle-inner,\n.a9s-annotation.improved-polygon.editable .a9s-handle .a9s-handle-inner:hover {\n  fill:#fff;\n  color:green;\n}\n.selectedCorner {\n  fill: white!important;\n}\n.selectedCorner .a9s-handle-inner{\n  fill: white!important;\n  color:green;\n}\n/** Midpoints **/\n.a9s-annotation.improved-polygon.editable .a9s-midpoint {\n  display:none;\n  fill:rgba(255,255,255,0.65);\n  stroke-width:1;\n  stroke:rgba(0,0,0,0.65);\n}\n\n.a9s-annotation.improved-polygon.editable:hover .a9s-midpoint {\n  display:block;\n}\n\n.a9s-annotation.improved-polygon.editable .a9s-midpoint:hover {\n  fill:#fff;\n}\n"],sourceRoot:""}]);const u=a},379:(e,t,n)=>{"use strict";var r,o=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),i=[];function a(e){for(var t=-1,n=0;n<i.length;n++)if(i[n].identifier===e){t=n;break}return t}function u(e,t){for(var n={},r=[],o=0;o<e.length;o++){var u=e[o],c=t.base?u[0]+t.base:u[0],l=n[c]||0,s="".concat(c," ").concat(l);n[c]=l+1;var f=a(s),p={css:u[1],media:u[2],sourceMap:u[3]};-1!==f?(i[f].references++,i[f].updater(p)):i.push({identifier:s,updater:h(p,t),references:1}),r.push(s)}return r}function c(e){var t=document.createElement("style"),r=e.attributes||{};if(void 0===r.nonce){var i=n.nc;i&&(r.nonce=i)}if(Object.keys(r).forEach((function(e){t.setAttribute(e,r[e])})),"function"==typeof e.insert)e.insert(t);else{var a=o(e.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(t)}return t}var l,s=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function f(e,t,n,r){var o=n?"":r.media?"@media ".concat(r.media," {").concat(r.css,"}"):r.css;if(e.styleSheet)e.styleSheet.cssText=s(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function p(e,t,n){var r=n.css,o=n.media,i=n.sourceMap;if(o?e.setAttribute("media",o):e.removeAttribute("media"),i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var d=null,y=0;function h(e,t){var n,r,o;if(t.singleton){var i=y++;n=d||(d=c(t)),r=f.bind(null,n,i,!1),o=f.bind(null,n,i,!0)}else n=c(t),r=p.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=(void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r));var n=u(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var r=0;r<n.length;r++){var o=a(n[r]);i[o].references--}for(var c=u(e,t),l=0;l<n.length;l++){var s=a(n[l]);0===i[s].references&&(i[s].updater(),i.splice(s,1))}n=c}}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={id:r,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;var r={};return(()=>{"use strict";n.d(r,{default:()=>Ar});var e,t=n(902),o=n.n(t),i=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},a="http://www.w3.org/2000/svg",u=function(e){var t=e.getAttribute("class");return t?new Set(t.split(" ")):new Set},c=function(e,t){var n=u(e);n.add(t),e.setAttribute("class",Array.from(n).join(" "))},l=function(e,t){var n=u(e);n.delete(t),0===n.size?e.removeAttribute("class"):e.setAttribute("class",Array.from(n).join(" "))},s=function(e,t){return u(e).has(t)},f=new Uint8Array(16);function p(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(f)}const d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,y=function(e){return"string"==typeof e&&d.test(e)};for(var h=[],b=0;b<256;++b)h.push((b+256).toString(16).substr(1));const m=function(e,t,n){var r=(e=e||{}).random||(e.rng||p)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase();if(!y(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var v=n(703),g=n.n(v);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var x=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),O(this,"clone",(function(t,n){return new e(A(A({},r.underlying),t),A(A({},r.opts),n))})),O(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),this.underlying=t,this.opts=n}var t,n;return t=e,(n=[{key:"isEqual",value:function(e){return"Annotation"===(null==e?void 0:e.type)&&(this.underlying===e.underlying||!(!this.underlying.id||!e.underlying.id)&&g()(this.underlying,e.underlying))}},{key:"readOnly",get:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(e){this.underlying.body=e}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){var e;return null===(e=this.selector("TextQuoteSelector"))||void 0===e?void 0:e.exact}},{key:"start",get:function(){var e;return null===(e=this.selector("TextPositionSelector"))||void 0===e?void 0:e.start}},{key:"end",get:function(){var e;return null===(e=this.selector("TextPositionSelector"))||void 0===e?void 0:e.end}}])&&S(t.prototype,n),e}();function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}O(x,"create",(function(e){var t={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(m()),body:[]};return new x(A(A({},t),e))}));var M=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,"clone",(function(t){var n=new e;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),t&&(n.underlying=j(j({},n.underlying),t)),n})),P(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),P(this,"toAnnotation",(function(){var e=Object.assign({},r.underlying,{type:"Annotation",id:"#".concat(m())});return new x(e)})),this.underlying={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Selection",body:n||[],target:t}}var t,n;return t=e,(n=[{key:"context",get:function(){return this.underlying["@context"]}},{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(e){return!!e&&g()(this.underlying,e.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){var e;return null===(e=this.selector("TextQuoteSelector"))||void 0===e?void 0:e.exact}},{key:"isSelection",get:function(){return!0}}])&&C(t.prototype,n),e}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function R(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function T(e,t,n){return t&&R(e.prototype,t),n&&R(e,n),e}function B(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}function G(e,t){return G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},G(e,t)}function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=N(e);if(t){var o=N(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return H(e)}(this,n)}}function H(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},N(e)}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X="An implementation is missing",Y=i(),U=function(e){B(n,e);var t=D(n);function n(e,r,o){var i;_(this,n),L(H(i=t.call(this)),"enableResponsive",(function(){window.ResizeObserver&&(i.resizeObserver=new ResizeObserver((function(){var e=i.svg.getBoundingClientRect(),t=i.svg.viewBox.baseVal,n=t.width,r=t.height;i.scale=Math.max(n/e.width,r/e.height),i.onScaleChanged&&i.onScaleChanged(i.scale)})),i.resizeObserver.observe(i.svg.parentNode))})),L(H(i),"getSVGPoint",(function(e){var t=i.svg.createSVGPoint();if(Y){var n=i.svg.getBoundingClientRect(),r=e.clientX-n.x,o=e.clientY-n.y,a=i.svg.getBoundingClientRect(),u=a.left,c=a.top;return t.x=r+u,t.y=o+c,t.matrixTransform(i.g.getScreenCTM().inverse())}return t.x=e.offsetX,t.y=e.offsetY,t.matrixTransform(i.g.getCTM().inverse())})),L(H(i),"drawHandle",(function(e,t){var n=document.createElementNS(a,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(a,"g"),o=function(n){var r=document.createElementNS(a,"circle");return r.setAttribute("cx",e),r.setAttribute("cy",t),r.setAttribute("r",n),r.setAttribute("transform-origin","".concat(e," ").concat(t)),r},u=i.config.handleRadius||6,c=o(u);c.setAttribute("class","a9s-handle-inner");var l=o(u+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),L(H(i),"setHandleXY",(function(e,t,n){var r=e.querySelector(".a9s-handle-inner");r.setAttribute("cx",t),r.setAttribute("cy",n),r.setAttribute("transform-origin","".concat(t," ").concat(n));var o=e.querySelector(".a9s-handle-outer");o.setAttribute("cx",t),o.setAttribute("cy",n),o.setAttribute("transform-origin","".concat(t," ").concat(n))})),L(H(i),"getHandleXY",(function(e){var t=e.querySelector(".a9s-handle-outer");return{x:parseFloat(t.getAttribute("cx")),y:parseFloat(t.getAttribute("cy"))}})),L(H(i),"scaleHandle",(function(e){var t=e.querySelector(".a9s-handle-inner"),n=e.querySelector(".a9s-handle-outer"),r=i.scale*(i.config.handleRadius||6);t.setAttribute("r",r),n.setAttribute("r",r)})),i.svg=e.closest("svg"),i.g=e,i.config=r,i.env=o,i.scale=1;var u=o.image;return(u instanceof Element||u instanceof HTMLDocument)&&i.enableResponsive(),i}return T(n,[{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}]),n}(o()),I=function(e){B(n,e);var t=D(n);function n(e,r,o){var i;return _(this,n),L(H(i=t.call(this,e,r,o)),"attachListeners",(function(e){var t=e.mouseMove,n=e.mouseUp,r=e.dblClick;t&&(i.mouseMove=function(e){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.started||(i.emit("startSelection",{x:r,y:o}),i.started=!0),t(r,o,e)},i.svg.addEventListener("mousemove",i.mouseMove)),n&&(i.mouseUp=function(e){if(0===e.button){var t=i.getSVGPoint(e),r=t.x,o=t.y;n(r,o,e)}},document.addEventListener("mouseup",i.mouseUp)),r&&(i.dblClick=function(e){var t=i.getSVGPoint(e),n=t.x,o=t.y;r(n,o,e)},document.addEventListener("dblclick",i.dblClick))})),L(H(i),"detachListeners",(function(){i.mouseMove&&i.svg.removeEventListener("mousemove",i.mouseMove),i.mouseUp&&document.removeEventListener("mouseup",i.mouseUp),i.dblClick&&document.removeEventListener("dblclick",i.dblClick)})),L(H(i),"start",(function(e,t){var n=i.getSVGPoint(e),r=n.x,o=n.y,a=i.env.image,u=a.naturalWidth,c=a.naturalHeight,l=r<0?0:r>u?u:r,s=o<0?0:o>c?c:o;i.startDrawing(l,s,t,e)})),L(H(i),"startDrawing",(function(e){throw new Error(X)})),L(H(i),"createEditableShape",(function(e,t){throw new Error(X)})),i.started=!1,i}return T(n,[{key:"isDrawing",get:function(){throw new Error(X)}}]),n}(U);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function V(e,t){return V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},V(e,t)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}I.supports=function(e){throw new Error(X)};var K="An implementation is missing",$=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=z(r);if(o){var n=z(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return W(e)}(this,e)});function a(e,t,n,r){var o,u,c,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),l=function(e){throw new Error(K)},(c="updateState")in(u=W(o=i.call(this,t,n,r)))?Object.defineProperty(u,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[c]=l,o.annotation=e,o}return t=a,(n=[{key:"element",get:function(){throw new Error(K)}}])&&q(t.prototype,n),a}(U);function Z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var J=function(e,t){var n=e.selector("FragmentSelector");if(null!=n&&n.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){var r=n.value,o=r.includes(":")?r.substring(r.indexOf("=")+1,r.indexOf(":")):"pixel",i=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Z(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((r.includes(":")?r.substring(r.indexOf(":")+1):r.substring(r.indexOf("=")+1)).split(",").map(parseFloat),4),a=i[0],u=i[1],c=i[2],l=i[3];return"percent"===o.toLowerCase()&&(a=a*t.naturalWidth/100,u=u*t.naturalHeight/100,c=c*t.naturalWidth/100,l=l*t.naturalHeight/100),{x:a,y:u,w:c,h:l}}};function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ne=function(e){var t;return"point"===(null===(t=e.target.renderedVia)||void 0===t?void 0:t.name)},re=function(e,t,n,r){return ee(ee({},function(e,t,n,r,o,i){return"percent"===(null==i?void 0:i.toLowerCase())?function(e,t,n,r,o){var i=e/o.naturalWidth*100,a=t/o.naturalHeight*100,u=0/o.naturalWidth*100,c=0/o.naturalHeight*100;return{source:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=percent:".concat(i,",").concat(a,",").concat(u,",").concat(c)}}}(e,t,0,0,o):function(e,t,n,r,o){return{source:null==o?void 0:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(e,",").concat(t,",").concat(0,",").concat(0)}}}(e,t,0,0,o)}(e,t,0,0,n,r)),{},{renderedVia:{name:"point"}})};function oe(e){return oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(e)}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ae(e,t,n){return ae="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=le(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ae(e,t,n||e)}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e){return le=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},le(e)}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var fe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=le(r);if(o){var n=le(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===oe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ce(e)}(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),se(ce(o=i.call(this,e,t,n,r)),"onScaleChanged",(function(){return o.scaleHandle(o.point)})),se(ce(o),"onGrab",(function(){o.isGrabbed=!0})),se(ce(o),"onMouseMove",(function(e){if(0===e.button&&o.isGrabbed){var t=o.getSVGPoint(e),n=t.x,r=t.y;o.setHandleXY(o.point,n,r);var i=re(n,r,o.env.image,o.config.fragmentUnit);o.emit("update",i)}})),se(ce(o),"onMouseUp",(function(){o.isGrabbed=!1})),se(ce(o),"updateState",(function(e){var t=J(e,o.env.image),n=t.x,r=t.y;o.setHandleXY(o.point,n,r)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp);var c=J(e,r.image),l=c.x,s=c.y;return o.container=document.createElementNS(a,"g"),o.elementGroup=document.createElementNS(a,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.point=o.drawHandle(l,s),o.point.addEventListener("mousedown",o.onGrab),o.elementGroup.appendChild(o.point),o.container.appendChild(o.elementGroup),t.appendChild(o.container),o.isGrabbed=!1,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),ae(le(u.prototype),"destroy",this).call(this)}}])&&ie(t.prototype,n),u}($);function pe(e){return pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ye(e,t){return ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ye(e,t)}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function be(e){return be=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},be(e)}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=be(r);if(o){var n=be(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return he(e)}(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),me(he(r=i.call(this,e,t,n)),"startDrawing",(function(e,t,n,o){var i,a=null===(i=o.target.closest(".a9s-annotation"))||void 0===i?void 0:i.annotation;if(a&&ne(a))r.emit("cancel");else{var u=r.drawHandle(e,t);r.scaleHandle(u),r.g.appendChild(u),u.annotation=new M(re(e,t,r.env.image,r.config.fragmentUnit)),r.emit("complete",u)}})),me(he(r),"stop",(function(){})),me(he(r),"createEditableShape",(function(e){return new fe(e,r.g,r.config,r.env)})),r}return t=a,(n=[{key:"isDrawing",get:function(){return!1}}])&&de(t.prototype,n),a}(I);ve.identifier="point",ve.supports=function(e){return!1};var ge=function(e){var t=function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(e){return e.parentNode.removeChild(e)})),t(e),Array.from(e.querySelectorAll("*")).forEach(t),e},we=function(e){var t,n,r=e.selector("SvgSelector");if(r){var o=new DOMParser,i=r.value,u=o.parseFromString(i,"image/svg+xml"),c=u.lookupPrefix(a),l=u.lookupNamespaceURI(null);return c||l?ge(u).firstChild:ge((t=u,n=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",'<svg xmlns="'.concat(a,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},Ae=function(e){var t=we(e),n=document.createElementNS(a,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},Se=function(e,t){var n=e.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(a,'"'),""),{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}},Oe=function(e,t,n,r){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("r",r)},xe=function(e,t,n){var r=document.createElementNS(a,"g"),o=document.createElementNS(a,"circle"),i=document.createElementNS(a,"circle");return i.setAttribute("class","a9s-inner"),Oe(i,e,t,n),o.setAttribute("class","a9s-outer"),Oe(o,e,t,n),r.appendChild(o),r.appendChild(i),r},Ee=function(e,t,n,r){var o=e.querySelector(".a9s-inner"),i=e.querySelector(".a9s-outer");Oe(o,t,n,r),Oe(i,t,n,r)},je=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),r:parseFloat(t.getAttribute("r"))}};function Ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Me=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Pe(this,"redraw",(function(){var e=je(r.circle),t=e.cx,n=e.cy,o=e.r,i=t+o>r.w?r.w-o:t,a=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(a," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),Pe(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=n;var o=je(this.circle),i=o.cx,u=o.cy,c=o.r,l=i+c>this.w?this.w-c:i,s=u+c>this.h?this.h-c:u+c;this.mask=document.createElementNS(a,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&Ce(t.prototype,n),e}();function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Re=function(){function e(t,n,r,o){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_e(this,"dragTo",(function(e,t){var n=i.env.image,r=n.naturalWidth,o=n.naturalHeight;i.group.style.display=null;var a=e-i.anchor[0],u=t-i.anchor[1],c=Math.max(1,Math.pow(Math.pow(a,2)+Math.pow(u,2),.5)/2),l=i.anchor[0]+a/2,s=i.anchor[1]+u/2;l-c<0||l+c>r||s-c<0||s+c>o||(Ee(i.circle,l,s,c),i.mask.redraw())})),_e(this,"getBoundingClientRect",(function(){return i.circle.getBoundingClientRect()})),_e(this,"toSelection",(function(){return new M(Se(i.group,i.env.image))})),_e(this,"destroy",(function(){i.group.parentNode.removeChild(i.group),i.mask=null,i.circle=null,i.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(a,"g"),this.circle=xe(t,n,2),this.circle.setAttribute("class","a9s-selection"),this.mask=new Me(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.circle}}])&&ke(t.prototype,n),e}();function Te(e){return function(e){if(Array.isArray(e))return Be(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ge=/firefox/i.test(navigator.userAgent),De=function(e,t,n,r,o){e.setAttribute("width",r),e.setAttribute("height",o),Ge?(e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("transform","translate(".concat(t,", ").concat(n,")"))):(e.setAttribute("x",t),e.setAttribute("y",n))},He=function(e,t,n){if(!n)return e;var r=n.reduce((function(e,n){var r=n(t);if(!r)return e;if("string"==typeof r||r instanceof String)e.className=e.className?"".concat(e.className," ").concat(r):r;else if(r.nodeType===Node.ELEMENT_NODE)e.elements=e.elements?[].concat(Te(e.elements),[r]):[r];else{var o=r.className,i=r.style,a=r.element;o&&(e.className=e.className?"".concat(e.className," ").concat(o):o),i&&(e.style=e.style?"".concat(e.style," ").concat(i):i),a&&(e.elements=e.elements?[].concat(Te(e.elements),[a]):[a])}for(var u in r)r.hasOwnProperty(u)&&u.startsWith("data-")&&(e[u]=r[u]);return e}),{}),o=r.className,i=r.style,u=r.elements;if(o&&c(e,o),i){var l=e.querySelector(".a9s-outer"),s=e.querySelector(".a9s-inner");l&&s?(l.setAttribute("style","display:none"),s.setAttribute("style",i)):e.setAttribute("style",i)}for(var f in u&&u.forEach((function(t){return function(e,t){var n=t.getBBox(),r=n.x,o=n.y,i=n.width,u=n.height,c=document.createElementNS(a,"svg");c.setAttribute("class","a9s-formatter-el"),De(c,r,o,i,u);var l=document.createElementNS(a,"g");l.appendChild(e),c.appendChild(l),t.append(c)}(t,e)})),r)r.hasOwnProperty(f)&&f.startsWith("data-")&&e.setAttribute(f,r[f])},Ne=function(e,t,n,r,o){var i=e.querySelector(".a9s-formatter-el");i&&De(i,t,n,r,o)};function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Xe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ye(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ue(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ie(e,t,n){return Ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ve(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},Ie(e,t,n||e)}function Fe(e,t){return Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Fe(e,t)}function qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ve(e){return Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ve(e)}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ve(r);if(o){var n=Ve(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return qe(e)}(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),We(qe(o=i.call(this,e,t,n,r)),"setSize",(function(e,t,n){Ee(o.circle,e,t,n),o.mask.redraw(),Ne(o.elementGroup,e,t,n,n);var r=Xe(o.handles,4),i=r[0],a=r[1],u=r[2],c=r[3];o.setHandleXY(i,e,t-n),o.setHandleXY(a,e+n,t),o.setHandleXY(u,e,t+n),o.setHandleXY(c,e-n,t)})),We(qe(o),"stretchCorners",(function(e,t,n){var r,i=o.getHandleXY(t),a=n.x,u=n.y,c=0,l=0;0==e||2==e?(a=i.x,l=u-i.y,r=Math.abs(l)/2):(u=i.y,c=a-i.x,r=Math.abs(c)/2);var s=c>0?i.x:a,f=l>0?i.y:u,p=s+Math.abs(c)/2,d=f+Math.abs(l)/2;if(Ee(o.circle,p,d,r),o.mask.redraw(),Ne(o.elementGroup,p,d,r,r),0==e||2==e){var y=0,h=2;(0==e&&l>0||2==e&&l<0)&&(y=2,h=0),o.setHandleXY(o.handles[y],p,d-r),o.setHandleXY(o.handles[h],p,d+r),o.setHandleXY(o.handles[1],p+r,d),o.setHandleXY(o.handles[3],p-r,d)}else{var b=3,m=1;(1==e&&c>0||3==e&&c<0)&&(b=1,m=3),o.setHandleXY(o.handles[b],p+r,d),o.setHandleXY(o.handles[m],p-r,d),o.setHandleXY(o.handles[0],p,d-r),o.setHandleXY(o.handles[2],p,d+r)}})),We(qe(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=je(o.circle),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),We(qe(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.circle){var r=je(o.circle).r,i=o.env.image,a=i.naturalWidth,u=i.naturalHeight,c=Math.max(t(n.x-o.grabbedAt.x,a-r),r),l=Math.max(t(n.y-o.grabbedAt.y,u-r),r);o.setSize(c,l,r),o.emit("update",Se(o.circle,o.env.image))}else{var s=o.handles.indexOf(o.grabbedElem),f=s<2?o.handles[s+2]:o.handles[s-2];o.stretchCorners(s,f,n),o.emit("update",Se(o.circle,o.env.image))}}})),We(qe(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),We(qe(o),"onScaleChanged",(function(e){return o.handles.map(o.scaleHandle)})),We(qe(o),"updateState",(function(e){var t=we(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("r"));o.setSize(n,r,i)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(a,"g"),o.circle=Ae(e),o.circle.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.circle)),o.mask=new Me(r.image,o.circle),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(a,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.circle);var c=je(o.circle),l=c.cx,s=c.cy,f=c.r;return o.handles=[[l,s-f],[l+f,s],[l,s+f],[l-f,s]].map((function(e){var t=Xe(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),He(o.circle,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),Ie(Ve(u.prototype),"destroy",this).call(this)}}])&&Ue(t.prototype,n),u}($);function Ke(e){return Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ke(e)}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ze(e,t){return Ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ze(e,t)}function Je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qe(e){return Qe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Qe(e)}function et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ze(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qe(r);if(o){var n=Qe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Ke(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Je(e)}(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),et(Je(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Re(e,t,r.g,r.env)})),et(Je(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),et(Je(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),et(Je(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),et(Je(r),"createEditableShape",(function(e){return new ze(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&$e(t.prototype,n),a}(I);tt.identifier="circle",tt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<circle/g)};var nt=function(e,t,n,r,o){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("rx",r),e.setAttribute("ry",o)},rt=function(e,t,n,r){var o=document.createElementNS(a,"g"),i=document.createElementNS(a,"ellipse"),u=document.createElementNS(a,"ellipse");return i.setAttribute("class","a9s-inner"),nt(i,e,t,n,r),u.setAttribute("class","a9s-outer"),nt(u,e,t,n,r),o.appendChild(u),o.appendChild(i),o},ot=function(e,t,n,r,o){var i=e.querySelector(".a9s-inner"),a=e.querySelector(".a9s-outer");nt(i,t,n,r,o),nt(a,t,n,r,o)},it=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),rx:parseFloat(t.getAttribute("rx")),ry:parseFloat(t.getAttribute("ry"))}};function at(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ct=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),ut(this,"redraw",(function(){var e=it(r.ellipse),t=e.cx,n=e.cy,o=e.rx,i=e.ry,a=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(t," ").concat(a," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),ut(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=n;var o=it(this.ellipse),i=o.cx,u=o.cy,c=o.rx,l=o.ry,s=u+l;this.mask=document.createElementNS(a,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(i," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&at(t.prototype,n),e}();function lt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ft=function(){function e(t,n,r,o){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),st(this,"dragTo",(function(e,t){i.group.style.display=null;var n=e-i.anchor[0],r=t-i.anchor[1],o=n>0?i.anchor[0]+n/2:e+n/2,a=r>0?i.anchor[1]+r/2:t+r/2,u=Math.abs(n/2),c=Math.abs(r/2);ot(i.ellipse,o,a,u,c),i.mask.redraw()})),st(this,"getBoundingClientRect",(function(){return i.ellipse.getBoundingClientRect()})),st(this,"toSelection",(function(){return new M(Se(i.group,i.env.image))})),st(this,"destroy",(function(){i.group.parentNode.removeChild(i.group),i.mask=null,i.ellipse=null,i.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(a,"g"),this.ellipse=rt(t,n,2,2),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new ct(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.ellipse}}])&&lt(t.prototype,n),e}();function pt(e){return pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pt(e)}function dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bt(e,t,n){return bt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},bt(e,t,n||e)}function mt(e,t){return mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},mt(e,t)}function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gt(e){return gt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},gt(e)}function wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var At=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mt(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=gt(r);if(o){var n=gt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===pt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return vt(e)}(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),wt(vt(o=i.call(this,e,t,n,r)),"setSize",(function(e,t,n,r){ot(o.ellipse,e,t,n,r),o.mask.redraw(),Ne(o.elementGroup,e,t,n,r);var i=dt(o.handles,4),a=i[0],u=i[1],c=i[2],l=i[3];o.setHandleXY(a,e,t-r),o.setHandleXY(u,e+n,t),o.setHandleXY(c,e,t+r),o.setHandleXY(l,e-n,t)})),wt(vt(o),"stretchCorners",(function(e,t,n,r){var i=o.getHandleXY(t),a=o.getHandleXY(n),u=r.x,c=r.y,l=0,s=0;0==e||2==e?u=i.x:c=i.y;var f=u-i.x,p=c-i.y,d=f>0?i.x:u,y=p>0?i.y:c,h=Math.abs(f),b=Math.abs(p),m=d+h/2,v=y+b/2;if(l=h/2,s=b/2,0==e||2==e?l=Math.abs(i.x-a.x):s=Math.abs(i.y-a.y),ot(o.ellipse,m,v,l,s),o.mask.redraw(),Ne(o.elementGroup,m,v,l,s),0==e||2==e){var g=0,w=2;(0==e&&p>0||2==e&&p<0)&&(g=2,w=0),o.setHandleXY(o.handles[g],m,v-s),o.setHandleXY(o.handles[w],m,v+s),o.setHandleXY(o.handles[1],m+l,v),o.setHandleXY(o.handles[3],m-l,v)}else{var A=3,S=1;(1==e&&f>0||3==e&&f<0)&&(A=1,S=3),o.setHandleXY(o.handles[A],m+l,v),o.setHandleXY(o.handles[S],m-l,v),o.setHandleXY(o.handles[0],m,v-s),o.setHandleXY(o.handles[2],m,v+s)}})),wt(vt(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=it(o.ellipse),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),wt(vt(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.ellipse){var r=it(o.ellipse),i=r.rx,a=r.ry,u=o.env.image,c=u.naturalWidth,l=u.naturalHeight,s=t(n.x-o.grabbedAt.x,c-i),f=t(n.y-o.grabbedAt.y,l-a);o.setSize(s,f,i,a),o.emit("update",Se(o.ellipse,o.env.image))}else{var p=o.handles.indexOf(o.grabbedElem),d=p<2?o.handles[p+2]:o.handles[p-2],y=o.handles[(p+3)%4];o.stretchCorners(p,d,y,n),o.emit("update",Se(o.ellipse,o.env.image))}}})),wt(vt(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),wt(vt(o),"onScaleChanged",(function(e){return o.handles.map(o.scaleHandle)})),wt(vt(o),"updateState",(function(e){var t=we(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("rx")),a=parseFloat(t.getAttribute("ry"));o.setSize(n,r,i,a)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(a,"g"),o.ellipse=Ae(e),o.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.ellipse)),o.mask=new ct(r.image,o.ellipse),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(a,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.ellipse);var c=it(o.ellipse),l=c.cx,s=c.cy,f=c.rx,p=c.ry;return o.handles=[[l,s-p],[l+f,s],[l,s+p],[l-f,s]].map((function(e){var t=dt(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),He(o.ellipse,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),bt(gt(u.prototype),"destroy",this).call(this)}}])&&ht(t.prototype,n),u}($);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Ot(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xt(e,t){return xt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xt(e,t)}function Et(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jt(e){return jt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},jt(e)}function Ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=jt(r);if(o){var n=jt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===St(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Et(e)}(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Ct(Et(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new ft(e,t,r.g,r.env)})),Ct(Et(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Ct(Et(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),Ct(Et(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),Ct(Et(r),"createEditableShape",(function(e){return new At(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&Ot(t.prototype,n),a}(I);function Mt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Pt.identifier="ellipse",Pt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<ellipse/g)};var Rt=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),_t(this,"setPoints",(function(e){var t=e.map((function(e){return"L".concat(e[0]," ").concat(e[1])})).join(" ");t="M"+t.substring(1),o.outer.setAttribute("d",t),o.inner.setAttribute("d",t)})),_t(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),_t(this,"dragTo",(function(e){o.group.style.display=null,o.addPoint(e)})),_t(this,"addPoint",(function(e){var t;o.points=[].concat(function(e){if(Array.isArray(e))return Mt(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Mt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mt(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]),o.setPoints(o.points)})),_t(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),_t(this,"toSelection",(function(){return new M(Se(o.group,o.env.image))})),this.points=[t],this.env=r,this.group=document.createElementNS(a,"g"),this.freehand=document.createElementNS(a,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(a,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(a,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.freehand}}])&&kt(t.prototype,n),e}();function Tt(e){return Tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tt(e)}function Bt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e,t){return Gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Gt(e,t)}function Dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ht(e,t,n){return Ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Nt(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},Ht(e,t,n||e)}function Nt(e){return Nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Nt(e)}function Lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xt=function(e){var t=e.getAttribute("d").split("L"),n=[];if(t.length>0){var r=t[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<t.length;o++)r=t[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},Yt=function(e){return e.querySelector(".a9s-inner").getBBox()},Ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gt(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Nt(r);if(o){var n=Nt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Tt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Dt(e)}(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Lt(Dt(c=i.call(this,e,t,n,r)),"setPoints",(function(e){var t=function(e){return Math.round(10*e)/10},n=e.map((function(e){return"L".concat(t(e.x)," ").concat(t(e.y))})).join(" ");n="M"+n.substring(1),c.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=c.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,a=o.y,u=o.width,l=o.height;Ne(c.elementGroup,i,a,u,l)})),Lt(Dt(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),Lt(Dt(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e),r=Yt(c.shape),o=r.x,i=r.y,a=r.width,u=r.height;if(c.grabbedElem===c.shape){var l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-a),d=t(i,n.y-c.grabbedAt.y,f-u),y=c.shape.querySelector(".a9s-inner"),h=Xt(y).map((function(e){return{x:e.x+p,y:e.y+d}}));c.grabbedAt=n,c.setPoints(h),c.emit("update",Se(c.shape,c.env.image))}}})),Lt(Dt(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),Lt(Dt(c),"updateState",(function(e){var t=Xt(we(e));c.setPoints(t)})),Lt(Dt(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Ht((o=Dt(c),Nt(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(a,"g"),c.shape=Ae(e),c.elementGroup=document.createElementNS(a,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),He(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var l=Yt(c.shape);return l.x,l.y,l.width,l.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&Bt(t.prototype,n),u}($);function It(e){return It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},It(e)}function Ft(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qt(e,t){return qt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},qt(e,t)}function Vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(e){return Wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Wt(e)}function zt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Wt(r);if(o){var n=Wt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===It(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Vt(e)}(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),zt(Vt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new Rt([e,t],r.g,r.env)})),zt(Vt(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),zt(Vt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),zt(Vt(r),"onMouseUp",(function(e,t){r.onDblClick(e,t)})),zt(Vt(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]),r.detachListeners();var n=r.rubberband.getBoundingClientRect(),o=n.width,i=n.height,a=r.config.minSelectionWidth||4,u=r.config.minSelectionHeight||4;if(o>=a||i>=u){var c=r.rubberband.element;c.annotation=r.rubberband.toSelection(),r.emit("complete",c)}else r.emit("cancel");r.stop()})),zt(Vt(r),"createEditableShape",(function(e){return new Ut(e,r.g,r.config,r.env)})),r._isDrawing=!1,r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Ft(t.prototype,n),a}(I);Kt.identifier="freehand",Kt.supports=function(e){var t=e.selector("SvgSelector");if(t)return t.value.match(/^<svg.*<path*/g)&&!t.value.toUpperCase().includes("Z")};var $t=n(72),Zt=n.n($t);function Jt(e){return Jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Jt(e)}function Qt(e){return function(e){if(Array.isArray(e))return nn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||tn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function en(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=tn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function tn(e,t){if(e){if("string"==typeof e)return nn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nn(e,t):void 0}}function nn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function on(e,t){return on=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},on(e,t)}function an(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function un(e){return un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},un(e)}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ln=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&on(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=un(r);if(o){var n=un(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===Jt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return an(e)}(this,e)});function u(e,t,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),cn(an(o=i.call(this,t,n,r)),"setPoints",(function(e){var t,n="",r=en(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a="";if(i.length>0){var u,c=en(i);try{for(c.s();!(u=c.n()).done;){var l=u.value;l&&(a+=""===a?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(e){c.e(e)}finally{c.f()}n+=a}}}catch(e){r.e(e)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),cn(an(o),"close",(function(){var e=new e(Se(o.points,o.env.image));o.emit("close",{shape:o.multipolygon,multipolygon:e})})),cn(an(o),"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),cn(an(o),"dragTo",(function(e){o.group.style.display=null,o.mousepos=e;var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(Qt(t),[e,t[0]]);n.push(r),o.setPoints(n)})),cn(an(o),"onScaleChanged",(function(e){o.scale=e;var t=o.closeHandle.querySelector(".a9s-handle-inner"),n=o.closeHandle.querySelector(".a9s-handle-outer"),r=e*(o.config.handleRadius||6);t.setAttribute("r",r),n.setAttribute("r",r)})),cn(an(o),"addPoint",(function(e){if(o.points[o.points.length-1].length>0){var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=t[t.length-1];Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(Qt(t),[e,t[0]]),o.setPoints(o.points))}else o.points[o.points.length-1]=[e,e],o.setPoints(o.points)})),cn(an(o),"undo",(function(){o.pop()})),cn(an(o),"isClosable",(function(){return o.getDistanceToStart()<6*o.scale})),cn(an(o),"pop",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop(),o.setPoints(o.points)})),cn(an(o),"newPart",(function(){o.points.push([])})),cn(an(o),"getDistanceToStart",(function(){if(o.points[o.points.length-1].length<3)return 1/0;var e=Math.abs(o.mousepos[0]-o.points[o.points.length-1][0][0]),t=Math.abs(o.mousepos[1]-o.points[o.points.length-1][0][1]);return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))/o.scale})),cn(an(o),"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),cn(an(o),"toSelection",(function(){return console.log("toSVGTarget(this.group, this.env.image)",Se(o.group,o.env.image)),new M(Se(o.group,o.env.image))})),o.points=[],o.points.push([e,e]),o.mousepos=e,o.env=r,o.scale=1,o.group=document.createElementNS(a,"g"),o.multipolygon=document.createElementNS(a,"g"),o.multipolygon.setAttribute("class","a9s-selection a9s-multipolygon improved-polygon"),o.rubberband=document.createElementNS(a,"polygon"),o.rubberband.setAttribute("class","a9s-rubberband"),o.closeHandle=o.drawHandle(e[0],e[1]),o.closeHandle.style.display="none",o.outer=document.createElementNS(a,"path"),o.outer.setAttribute("class","a9s-outer"),o.inner=document.createElementNS(a,"path"),o.inner.setAttribute("class","a9s-inner"),o.setPoints(o.points),o.multipolygon.appendChild(o.rubberband),o.multipolygon.appendChild(o.outer),o.multipolygon.appendChild(o.inner),o.multipolygon.appendChild(o.closeHandle),o.group.style.display="none",o.group.appendChild(o.multipolygon),t.appendChild(o.group),o}return t=u,(n=[{key:"element",get:function(){return this.multipolygon}}])&&rn(t.prototype,n),u}(U),sn=function(e,t){for(var n=e[0],r=e[1],o=!1,i=0,a=t.length-1;i<t.length;a=i++){var u=t[i][0],c=t[i][1],l=t[a][0],s=t[a][1];c>r!=s>r&&n<(l-u)*(r-c)/(s-c)+u&&(o=!o)}return o},fn=n(379),pn=n.n(fn),dn=n(800);function yn(e){return yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yn(e)}function hn(e){return function(e){if(Array.isArray(e))return xn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||On(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mn(e,t){return mn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},mn(e,t)}function vn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gn(e,t,n){return gn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=wn(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},gn(e,t,n||e)}function wn(e){return wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wn(e)}function An(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=On(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function On(e,t){if(e){if("string"==typeof e)return xn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xn(e,t):void 0}}function xn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}pn()(dn.Z,{insert:"head",singleton:!1}),dn.Z.locals;var En=function(e){console.log("polygon",e);var t=e.split("M"),n=[];return t.forEach((function(e,t){if(e.length>0){var r=[];(e=(e=(e=(e=(e=e.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(e,t){r.push([parseFloat(e.split(",")[0]).toFixed(2).toString(),parseFloat(e.split(",")[1]).toFixed(2).toString()])})),r[0][0]!==r[r.length-1][0]&&r[0][1]!==r[r.length-1][1]&&r.push(r[0]),n.push(r)}})),console.log("allcoords",n),n},jn=function(e){var t,n=[],r=Sn(En(e.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(t=r.n()).done;){var o,i=t.value,a=[],u=Sn(i);try{for(u.s();!(o=u.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};a.push(l)}}catch(e){u.e(e)}finally{u.f()}n.push(a)}}catch(e){r.e(e)}finally{r.f()}return n},Cn=function(e){return e.querySelector(".a9s-inner").getBBox()},Pn=function(e){var t=we(e);!function(e){var t=we(e).getAttribute("d");En(t)}(e);var n=document.createElementNS(a,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},Mn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&mn(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=wn(r);if(o){var n=wn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===yn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return vn(e)}(this,e)});function u(e,t,n,r){var o,f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),An(vn(f=i.call(this,e,t,n,r)),"createCornerHandle",(function(e){var t=f.drawHandle(e.x,e.y);return t.addEventListener("mousedown",f.onGrab(t)),t.addEventListener("click",f.onSelectCorner(t)),f.scaleHandle(t),f.elementGroup.appendChild(t),t})),An(vn(f),"createMidpoint",(function(e,t){var n=e[t],r=t===e.length-1?e[0]:e[t+1],o=(n.x+r.x)/2,i=(n.y+r.y)/2,a=f.drawMidpoint(o,i);return a.addEventListener("mousedown",f.onGrab(a)),f.shape.appendChild(a),a})),An(vn(f),"deleteSelected",(function(){console.log("delete selected");var e=jn(f.shape);f.selected.length>0&&function(){var t,n=-1,r=[],o=[],i=Sn(f.midpoints);try{for(i.s();!(t=i.n()).done;){var a=t.value,u=a.filter((function(e,t){return-1===f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)})),c=a.filter((function(e,t){return f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)>-1}));c.forEach((function(e){return e.parentNode.removeChild(e)})),u.length>2&&o.push(u)}}catch(e){i.e(e)}finally{i.f()}var l,s=Sn(e);try{for(s.s();!(l=s.n()).done;){var p=l.value;n+=1;var d=p.filter((function(e,t){return-1===f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)}));d.length>2&&r.push(d)}}catch(e){s.e(e)}finally{s.f()}n=-1;var y,h=[],b=Sn(f.cornerHandles);try{for(b.s();!(y=b.n()).done;){var m=y.value;n+=1;var v=m.filter((function(e,t){return-1!==f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)})),g=m.filter((function(e,t){return-1===f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)}));g.length>2&&h.push(g),v.forEach((function(e){return e.parentNode.removeChild(e)}))}}catch(e){b.e(e)}finally{b.f()}f.midpoints=o,f.cornerHandles=h,f.selected=[],f.setPoints(r)}()})),An(vn(f),"deselectCorners",(function(){return f.cornerHandles.forEach((function(e){return l(e,"selected")}))})),An(vn(f),"destroy",(function(){f.container.parentNode.removeChild(f.container),f.svg.removeEventListener("mousemove",f.onMouseMove),f.svg.removeEventListener("mouseup",f.onMouseUp),document.body.removeEventListener("keydown",f.onKeyDown),gn((o=vn(f),wn(u.prototype)),"destroy",o).call(o)})),An(vn(f),"drawMidpoint",(function(e,t){var n=document.createElementNS(a,"circle");return n.setAttribute("class","a9s-midpoint"),n.setAttribute("cx",e),n.setAttribute("cy",t),n.setAttribute("r",5*f.scale),n})),An(vn(f),"onAddPoint",(function(e){var t,n=jn(f.shape),r=-1,o=-1,i=Sn(f.midpoints);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(o+=1,(r=a.indexOf(f.grabbedElement))>-1)break}}catch(e){i.e(e)}finally{i.f()}var u,c=[],l=-1,s=null,p=null,d=Sn(n);try{for(d.s();!(u=d.n()).done;){var y=u.value;if((l+=1)===o){var h,b=[],m=-1,v=Sn(y);try{for(v.s();!(h=v.n()).done;){var g=h.value;m+=1,b.push(g),m===r&&(b.push(e),s=f.createMidpoint(y,m-1),p=f.createMidpoint(y,m))}}catch(e){v.e(e)}finally{v.f()}c.push(b)}else c.push(y)}}catch(e){d.e(e)}finally{d.f()}var w=f.createCornerHandle(e);f.cornerHandles[o]=[].concat(hn(f.cornerHandles[o].slice(0,r+1)),[w],hn(f.cornerHandles[o].slice(r+1))),f.midpoints[o]=[].concat(hn(f.midpoints[o].slice(0,r)),[s,p],hn(f.midpoints[o].slice(r+1))),f.grabbedElement.parentNode.removeChild(f.grabbedElement),f.grabbedElement=w,f.setPoints(c)})),An(vn(f),"onGrab",(function(e){return function(t){0===t.button&&(t.stopPropagation(),f.grabbedElement=e,f.grabbedAt=f.getSVGPoint(t),f.lastMouseDown=(new Date).getTime())}})),An(vn(f),"onKeyDown",(function(e){46===e.which&&f.deleteSelected()})),An(vn(f),"onMoveShape",(function(e){var t,n=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t},r=Cn(f.shape),o=r.x,i=r.y,a=r.width,u=r.height,c=f.env.image,l=c.naturalWidth,s=c.naturalHeight,p=n(o,e.x-f.grabbedAt.x,l-a),d=n(i,e.y-f.grabbedAt.y,s-u),y=[],h=Sn(jn(f.shape));try{for(h.s();!(t=h.n()).done;){var b=t.value,m=b.map((function(e){return[e.x,e.y]}));sn([f.grabbedAt.x,f.grabbedAt.y],m)?y.push(b.map((function(e){return{x:e.x+p,y:e.y+d}}))):y.push(b)}}catch(e){h.e(e)}finally{h.f()}f.grabbedAt=e,f.setPoints(y)})),An(vn(f),"onMoveCornerHandle",(function(e,t){var n,r=-1,o=0,i=Sn(f.cornerHandles);try{for(i.s();!(n=i.n()).done;){var a=n.value;if((r=a.indexOf(f.grabbedElement))>-1)break;o+=1}}catch(e){i.e(e)}finally{i.f()}t.ctrlKey?f.selected=Array.from(new Set([].concat(hn(f.selected),[r]))):f.selected.includes(r)||(f.selected=[r]);var u,c=jn(f.shape),l=f.selected.map((function(e){var t=c[o][r],n=c[o][e];return{index:e,dx:n.x-t.x,dy:n.y-t.y}})),s=0,p=[],d=Sn(jn(f.shape));try{for(d.s();!(u=d.n()).done;){var y=u.value;if(s===o){var h=y.map((function(t,n){if(n===r)return e;if(f.selected.includes(n)){var o=l.find((function(e){return e.index===n})),i=o.dx,a=o.dy;return{x:e.x+i,y:e.y+a}}return t}));p.push(h)}else p.push(y);s+=1}}catch(e){d.e(e)}finally{d.f()}f.setPoints(p)})),An(vn(f),"onMouseMove",(function(e){if(f.grabbedElement){var t=f.getSVGPoint(e);f.grabbedElement===f.shape?f.onMoveShape(t):s(f.grabbedElement,"a9s-handle")?f.onMoveCornerHandle(t,e):s(f.grabbedElement,"a9s-midpoint")&&f.onAddPoint(t),f.emit("update",qn(jn(f.shape),f.env.image))}})),An(vn(f),"onMouseUp",(function(e){f.grabbedElement=null,f.grabbedAt=null})),An(vn(f),"onScaleChanged",(function(e){var t,n=Sn(f.cornerHandles);try{for(n.s();!(t=n.n()).done;)t.value.map(f.scaleHandle)}catch(e){n.e(e)}finally{n.f()}var r,o=Sn(f.midpoints);try{for(o.s();!(r=o.n()).done;)r.value.map((function(e){e.setAttribute("r",5*f.scale)}))}catch(e){o.e(e)}finally{o.f()}})),An(vn(f),"onSelectCorner",(function(e){return function(t){if(!((new Date).getTime()-f.lastMouseDown>250)){var n,r=-1,o=-1,i=Sn(f.cornerHandles);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(r+=1,(o=a.indexOf(e))>0)break}}catch(e){i.e(e)}finally{i.f()}null!=t&&t.ctrlKey?f.selected.map((function(e){return e[0]===r&&e[1]===o})).indexOf(!0)>-1?f.selected=f.selected.filter((function(e){return!(e[1]===o&&e[0]===r)})):f.selected=[].concat(hn(f.selected),[[r,o]]):1===f.selected.length&&f.selected[0][1]===o&&f.selected[0][0]===r?f.selected=[]:f.selected=[[r,o]],f.setPoints(jn(f.shape))}}})),An(vn(f),"setPoints",(function(e){var t=Fn(e);f.shape.querySelector(".a9s-inner").setAttribute("d",t);var n=f.shape.querySelector(".a9s-outer");n.setAttribute("d",t);var r,o=0,i=Sn(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;console.log("pointList of points",a,e),a.forEach((function(e,t){f.setHandleXY(f.cornerHandles[o][t],e.x,e.y)}));for(var u=0;u<a.length;u++){var p=a[u],d=u===a.length-1?a[0]:a[u+1],y=(p.x+d.x)/2,h=(p.y+d.y)/2,b=f.midpoints[o][u];b.setAttribute("cx",y),b.setAttribute("cy",h)}o+=1}}catch(e){i.e(e)}finally{i.f()}var m,v=-1,g=Sn(f.cornerHandles);try{for(g.s();!(m=g.n()).done;){var w=m.value;v+=1,w.forEach((function(e,t){var n=f.selected.map((function(e){return e[0]===v&&e[1]===t})).indexOf(!0)>-1;n&&!s(e,"selectedCorner")?c(e,"selectedCorner"):!n&&s(e,"selectedCorner")&&l(e,"selectedCorner")}))}}catch(e){g.e(e)}finally{g.f()}var A=n.getBBox(),S=A.x,O=A.y,x=A.width,E=A.height;Ne(f.shape,S,O,x,E)})),An(vn(f),"updateState",(function(e){var t=Pn(e),n=jn(t);f.setPoints(n)})),f.svg.addEventListener("mousemove",f.onMouseMove),f.svg.addEventListener("mouseup",f.onMouseUp),document.body.addEventListener("keydown",f.onKeyDown),f.container=document.createElementNS(a,"g"),f.shape=Pn(e),f.shape.setAttribute("class","a9s-annotation editable selected improved-polygon"),f.elementGroup=document.createElementNS(a,"g"),f.elementGroup.setAttribute("class","a9s-annotation editable selected"),f.elementGroup.appendChild(f.shape);var p=jn(f.shape);f.cornerHandles=[],f.midpoints=[];var d,y=Sn(p);try{var h=function(){var e=d.value,t=[];f.cornerHandles.push(e.map((function(n,r){return t.push(f.createMidpoint(e,r)),f.createCornerHandle(n)}))),f.midpoints.push(t)};for(y.s();!(d=y.n()).done;)h()}catch(e){y.e(e)}finally{y.f()}return f.container.appendChild(f.elementGroup),t.appendChild(f.container),He(f.shape,e,n.formatter),f.shape.querySelector(".a9s-inner").addEventListener("mousedown",f.onGrab(f.shape)),f.grabbedElement=null,f.grabbedAt=null,f.selected=[],f.lastMouseDown=null,f}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&bn(t.prototype,n),u}($);function kn(e){return kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(e)}function _n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Tn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Tn(e,t){if(e){if("string"==typeof e)return Bn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bn(e,t):void 0}}function Bn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Hn(e,t,n){return t&&Dn(e.prototype,t),n&&Dn(e,n),e}function Nn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ln(e,t)}function Ln(e,t){return Ln=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Ln(e,t)}function Xn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Un(e);if(t){var o=Un(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"===kn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Yn(e)}(this,n)}}function Yn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Un(e){return Un=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Un(e)}var In=function(e){Nn(n,e);var t=Xn(n);function n(){return Gn(this,n),t.apply(this,arguments)}return Hn(n,[{key:"toBBox",value:function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||Tn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e,2),n=t[0],r=t[1];return{minX:n,minY:r,maxX:n,maxY:r}}},{key:"compareMinX",value:function(e,t){return e.x-t.x}},{key:"compareMinY",value:function(e,t){return e.y-t.y}}]),n}(Zt()),Fn=(i(),function(e){var t,n=function(e){return Math.round(10*e)/10},r="",o=Rn(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r+="M";var a,u=!0,c=Rn(i);try{for(c.s();!(a=c.n()).done;){var l=a.value;u?(u=!1,r+=n(l.x).toString()+","+n(l.y).toString()):r+=" L"+n(l.x).toString()+","+n(l.y).toString()}}catch(e){c.e(e)}finally{c.f()}r+=" Z"}}catch(e){o.e(e)}finally{o.f()}return r}),qn=function(e,t){return{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:'<svg><path d="'.concat(Fn(e),'" /></svg>')}}},Vn=function(e){Nn(n,e);var t=Xn(n);function n(e,r,o){var i;return Gn(this,n),_n(Yn(i=t.call(this,e,r,o)),"startDrawing",(function(e,t,n,r,o){i._isDrawing=!0,console.log("start drawing. startTime:",Date.now()),i.startTime=Date.now(),i.contourPoints=o,i._startOnSingleClick=n||!1,i.attachListeners({mouseMove:i.onMouseMove,mouseUp:i.onMouseUp,dblClick:i.onDblClick}),i.rubberband=new ln([e,t],i.g,i.config,i.env),i.rubberband.on("close",(function(e){var t=e.shape,n=e.selection;t.annotation=n,i.emit("complete",t),i.stop()}))})),_n(Yn(i),"stop",(function(){i.detachListeners(),i._isDrawing=!1,i.rubberband&&(i.rubberband.destroy(),i.rubberband=null)})),_n(Yn(i),"undo",(function(){i.rubberband&&i.rubberband.undo()})),_n(Yn(i),"newPart",(function(){i.rubberband&&i.rubberband.newPart()})),_n(Yn(i),"onMouseMove",(function(e,t,n){i.rubberband.dragTo([e,t])})),_n(Yn(i),"onMouseUp",(function(e,t,n){if(n.altKey)i.onDblClickOld(e,t);else if(n.ctrlKey)i.rubberband.undo();else if(n.shiftKey&&i.rubberband.points.length>2)i.newPart();else{var r=i.rubberband.getBoundingClientRect(),o=r.width,a=r.height,u=i.config.minSelectionWidth||4,c=i.config.minSelectionHeight||4;o>=u||a>=c?i.rubberband.addPoint([e,t]):(i.emit("cancel"),i.stop())}})),_n(Yn(i),"onScaleChanged",(function(e){i.rubberband&&i.rubberband.onScaleChanged(e)})),_n(Yn(i),"onDblClickOld",(function(e,t){console.log("ondoubleclick",e,t),i._isDrawing=!1,i.rubberband.addPoint([e,t]);var n=i.rubberband.element;console.log("this.rubberband.toSelection();",i.rubberband.toSelection()),n.annotation=i.rubberband.toSelection(),console.log("shape",n.annotation.underlying.target.selector.value),i.emit("complete",n),i.stop()})),_n(Yn(i),"onDblClick",(function(e,t){})),_n(Yn(i),"createEditableShape",(function(e){return new Mn(e,i.g,i.config,i.env)})),i._isDrawing=!1,i.startTime=-1,i.contourPointsFunc=null,i.contourPoints=[],i.contourPointsRBush=new In,i.viewer=null,window.addEventListener("keydown",(function(e){"z"===e.key&&e.ctrlKey?i.undo():"n"!==e.key&&"p"!==e.key||i.newPart()}),!0),i._startOnSingleClick=!1,i}return Hn(n,[{key:"isDrawing",get:function(){return this._isDrawing}},{key:"setContourPoints",value:function(e,t){this.contourPointsFunc=e,this.viewer=t}}]),n}(I);function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Vn.identifier="multipolygon",Vn.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<path d=/g)};var Kn=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),zn(this,"redraw",(function(){r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(r.line.getAttribute("x1")," ").concat(r.line.getAttribute("y1")," ").concat(r.line.getAttribute("x2")," ").concat(r.line.getAttribute("y2"),"z"))})),zn(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.line=n,this.mask=document.createElementNS(a,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(this.line.getAttribute("x1")," ").concat(this.line.getAttribute("y1")," z"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&Wn(t.prototype,n),e}();function $n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$n(Object(n),!0).forEach((function(t){er(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$n(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function er(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tr=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),er(this,"setPoints",(function(e){var t=e;o.outer.setAttribute("x1",t[0]),o.inner.setAttribute("x1",t[0]),o.outer.setAttribute("y1",t[1]),o.inner.setAttribute("y1",t[1]),t.length>2&&(o.outer.setAttribute("x2",t[2]),o.inner.setAttribute("x2",t[2]),o.outer.setAttribute("y2",t[3]),o.inner.setAttribute("y2",t[3]))})),er(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),er(this,"dragTo",(function(e){o.group.style.display=null,o.mousepos=e;var t,n=[].concat(function(e){if(Array.isArray(e))return Jn(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Jn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Jn(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e[0],e[1]]);o.setPoints(n),o.mask.redraw()})),er(this,"addPoint",(function(e){o.points.length<=2&&(o.points[2]=e[0],o.points[3]=e[1],o.setPoints(o.points))})),er(this,"undo",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),er(this,"newPart",(function(){o.points.push([])})),er(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.Line=null,o.group=null})),er(this,"toSelection",(function(){return new M(Zn(Zn({},Se(o.group,o.env.image)),{},{renderedVia:{name:"line"}}))})),this.points=t,this.env=r,this.group=document.createElementNS(a,"g"),this.Line=document.createElementNS(a,"g"),this.Line.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(a,"line"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(a,"line"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.mask=new Kn(r.image,this.inner),this.Line.appendChild(this.outer),this.Line.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.Line),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.Line}}])&&Qn(t.prototype,n),e}();function nr(e){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nr(e)}function rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function or(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ir(e,t){return ir=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ir(e,t)}function ar(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ur(e,t,n){return ur="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cr(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}},ur(e,t,n||e)}function cr(e){return cr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},cr(e)}function lr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sr=function(e){var t=e.querySelector(".a9s-inner");return[[t.x1.baseVal,t.y1.baseVal],[t.x2.baseVal,t.y2.baseVal]]},fr=function(e){return e.querySelector(".a9s-inner").getBBox()},pr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ir(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=cr(r);if(o){var n=cr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===nr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ar(e)}(this,e)});function u(e,t,n,r){var o,c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),lr(ar(c=i.call(this,e,t,n,r)),"onScaleChanged",(function(){return c.handles.map(c.scaleHandle)})),lr(ar(c),"setPoints",(function(e){var t=e[0].x,n=e[0].y,r=e[1].x,o=e[1].y,i=c.shape.querySelector(".a9s-inner");i.setAttribute("x1",t),i.setAttribute("y1",n),i.setAttribute("x2",r),i.setAttribute("y2",o);var a=c.shape.querySelector(".a9s-outer");a.setAttribute("x1",t),a.setAttribute("y1",n),a.setAttribute("x2",r),a.setAttribute("y2",o),c.mask.redraw();var u=a.getBBox(),l=u.x,s=u.y,f=u.width,p=u.height;Ne(c.elementGroup,l,s,f,p)})),lr(ar(c),"onGrab",(function(e){return function(t){0===t.button&&(c.grabbedElem=e,c.grabbedAt=c.getSVGPoint(t))}})),lr(ar(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e);if(c.grabbedElem===c.shape){var r=fr(c.shape),o=r.x,i=r.y,a=r.width,u=r.height,l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-a),d=t(i,n.y-c.grabbedAt.y,f-u),y=sr(c.shape).map((function(e){return{x:e[0].value+p,y:e[1].value+d}}));c.grabbedAt=n,c.setPoints(y),y.forEach((function(e,t){return c.setHandleXY(c.handles[t],e.x,e.y)})),c.emit("update",Se(c.shape,c.env.image))}else{var h=c.handles.indexOf(c.grabbedElem),b=sr(c.shape).map((function(e,t){return t===h?n:{x:e[0].value,y:e[1].value}}));c.setPoints(b),c.setHandleXY(c.handles[h],n.x,n.y),c.emit("update",Se(c.shape,c.env.image))}}})),lr(ar(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),lr(ar(c),"updateState",(function(e){var t=we(e).getAttribute("points").split(" ").map((function(e){var t=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?rr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split(",").map((function(e){return parseFloat(e.trim())})),2);return{x:t[0],y:t[1]}}));c.setPoints(t),t.forEach((function(e,t){return c.setHandleXY(c.handles[t],e.x,e.y)}))})),lr(ar(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),ur((o=ar(c),cr(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(a,"g"),c.shape=Ae(e),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape)),c.mask=new Kn(r.image,c.shape.querySelector(".a9s-inner")),c.containerGroup.appendChild(c.mask.element),c.elementGroup=document.createElementNS(a,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.setAttribute("data-id",e.id),c.elementGroup.appendChild(c.shape),c.handles=sr(c.shape).map((function(e){var t=c.drawHandle(e[0].value,e[1].value);return t.addEventListener("mousedown",c.onGrab(t)),c.elementGroup.appendChild(t),t})),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),He(c.shape,e,n.formatters),c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&or(t.prototype,n),u}($);function dr(e){return dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dr(e)}function yr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function hr(e,t){return hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},hr(e,t)}function br(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function mr(e){return mr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},mr(e)}function vr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hr(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=mr(r);if(o){var n=mr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===dr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return br(e)}(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),vr(br(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new tr([e,t],r.g,r.env)})),vr(br(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),vr(br(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),vr(br(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),vr(br(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),vr(br(r),"onMouseUp",(function(e,t,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else if(2==r.rubberband.points.length)if(r.rubberband.addPoint([e,t]),r.rubberband.points[0]==r.rubberband.points[2]&&r.rubberband.points[1]==r.rubberband.points[3])r.emit("cancel"),r.stop();else{r._isDrawing=!1;var o=r.rubberband.element;o.annotation=r.rubberband.toSelection(),r.emit("complete",o),r.stop()}})),vr(br(r),"createEditableShape",(function(e){return new pr(e,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&r.undo(),"n"==e.key&&r.newPart()})),r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&yr(t.prototype,n),a}(I);gr.identifier="line",gr.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<line/g)};var wr=new Set(["point","circle","ellipse","freehand","line","multipolygon"]);const Ar=function(e,t){(null!=t&&t.tools?t.tools.map((function(e){return e.toLowerCase()})):wr).forEach((function(t){"point"===t&&e.addDrawingTool(ve),"circle"===t&&e.addDrawingTool(tt),"ellipse"===t&&e.addDrawingTool(Pt),"freehand"===t&&e.addDrawingTool(Kt),"multipolygon"===t&&e.addDrawingTool(Vn),"line"===t&&e.addDrawingTool(gr)}))}})(),r.default})()));
//# sourceMappingURL=annotorious-selector-pack.js.map