/*! For license information please see annotorious-selector-pack.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Annotorious=t():(e.Annotorious=e.Annotorious||{},e.Annotorious.SelectorPack=t())}(self,(function(){return(()=>{var e={902:e=>{function t(){}t.prototype={on:function(e,t,n){var r=this.e||(this.e={});return(r[e]||(r[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var r=this;function o(){r.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),r=0,o=n.length;r<o;r++)n[r].fn.apply(n[r].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),r=n[e],o=[];if(r&&t)for(var i=0,a=r.length;i<a;i++)r[i].fn!==t&&r[i].fn._!==t&&o.push(r[i]);return o.length?n[e]=o:delete n[e],this}},e.exports=t,e.exports.TinyEmitter=t},286:e=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}e.exports=function e(n,r){if(n===r)return!0;if(n&&r&&"object"==t(n)&&"object"==t(r)){if(n.constructor!==r.constructor)return!1;var o,i,a;if(Array.isArray(n)){if((o=n.length)!=r.length)return!1;for(i=o;0!=i--;)if(!e(n[i],r[i]))return!1;return!0}if(n.constructor===RegExp)return n.source===r.source&&n.flags===r.flags;if(n.valueOf!==Object.prototype.valueOf)return n.valueOf()===r.valueOf();if(n.toString!==Object.prototype.toString)return n.toString()===r.toString();if((o=(a=Object.keys(n)).length)!==Object.keys(r).length)return!1;for(i=o;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,a[i]))return!1;for(i=o;0!=i--;){var u=a[i];if(!e(n[u],r[u]))return!1}return!0}return n!=n&&r!=r}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};return(()=>{"use strict";n.d(r,{default:()=>Rr});var e,t=n(902),o=n.n(t),i=function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0},a="http://www.w3.org/2000/svg",u=function(e){var t=e.getAttribute("class");return t?new Set(t.split(" ")):new Set},c=function(e,t){var n=u(e);n.add(t),e.setAttribute("class",Array.from(n).join(" "))},l=function(e,t){var n=u(e);n.delete(t),0===n.size?e.removeAttribute("class"):e.setAttribute("class",Array.from(n).join(" "))},s=function(e,t){return u(e).has(t)},f=new Uint8Array(16);function p(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(f)}const d=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,y=function(e){return"string"==typeof e&&d.test(e)};for(var b=[],h=0;h<256;++h)b.push((h+256).toString(16).substr(1));const v=function(e,t,n){var r=(e=e||{}).random||(e.rng||p)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var o=0;o<16;++o)t[n+o]=r[o];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(b[e[t+0]]+b[e[t+1]]+b[e[t+2]]+b[e[t+3]]+"-"+b[e[t+4]]+b[e[t+5]]+"-"+b[e[t+6]]+b[e[t+7]]+"-"+b[e[t+8]]+b[e[t+9]]+"-"+b[e[t+10]]+b[e[t+11]]+b[e[t+12]]+b[e[t+13]]+b[e[t+14]]+b[e[t+15]]).toLowerCase();if(!y(n))throw TypeError("Stringified UUID is invalid");return n}(r)};var g=n(286),m=n.n(g);function w(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){A(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),A(this,"clone",(function(t,n){return new e(j(j({},r.underlying),t),j(j({},r.opts),n))})),A(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),this.underlying=t,this.opts=n}var t,n;return t=e,(n=[{key:"isEqual",value:function(e){return"Annotation"===(null==e?void 0:e.type)&&(this.underlying===e.underlying||!(!this.underlying.id||!e.underlying.id)&&m()(this.underlying,e.underlying))}},{key:"getStyle",value:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.style}},{key:"readOnly",get:function(){var e;return null===(e=this.opts)||void 0===e?void 0:e.readOnly}},{key:"id",get:function(){return this.underlying.id}},{key:"type",get:function(){return this.underlying.type}},{key:"motivation",get:function(){return this.underlying.motivation}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]},set:function(e){this.underlying.body=e}},{key:"setState",value:function(e){for(var t=0,n=Object.entries(e);t<n.length;t++){var r=w(n[t],2),o=r[0],i=r[1];this.opts[o]=i}}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"start",get:function(){return this.selector("TextPositionSelector").start}},{key:"end",get:function(){return this.selector("TextPositionSelector").end}}])&&P(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?x(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}A(E,"create",(function(e){var t={"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(v()),body:[]};return new E(j(j({},t),e))}));var _=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),R(this,"clone",(function(t){var n=new e;return n.underlying=JSON.parse(JSON.stringify(r.underlying)),t&&(n.underlying=C(C({},n.underlying),t)),n})),R(this,"selector",(function(e){var t=r.underlying.target;if(t.selector)return(Array.isArray(t.selector)?t.selector:[t.selector]).find((function(t){return t.type===e}))})),R(this,"toAnnotation",(function(){var e=Object.assign({},r.underlying,{"@context":"http://www.w3.org/ns/anno.jsonld",type:"Annotation",id:"#".concat(v())});return new E(e)})),this.underlying={type:"Selection",body:n||[],target:t}}var t,n;return t=e,(n=[{key:"type",get:function(){return this.underlying.type}},{key:"body",get:function(){return this.underlying.body}},{key:"target",get:function(){return this.underlying.target}},{key:"targets",get:function(){return Array.isArray(this.underlying.target)?this.underlying.target:[this.underlying.target]}},{key:"isEqual",value:function(e){return!!e&&m()(this.underlying,e.underlying)}},{key:"bodies",get:function(){return Array.isArray(this.underlying.body)?this.underlying.body:[this.underlying.body]}},{key:"quote",get:function(){return this.selector("TextQuoteSelector").exact}},{key:"isSelection",get:function(){return!0}}])&&M(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function D(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function H(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var o=I(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return B(this,n)}}function B(e,t){if(t&&("object"===k(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return U(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F="An implementation is missing",X=i(),Y=function(e){H(n,e);var t=L(n);function n(e,r,o){var i;T(this,n),console.log("constructing"),q(U(i=t.call(this)),"enableResponsive",(function(){window.ResizeObserver&&(i.resizeObserver=new ResizeObserver((function(){var e=i.svg.getBoundingClientRect(),t=i.svg.viewBox.baseVal,n=t.width,r=t.height;i.scale=Math.max(n/e.width,r/e.height),i.onScaleChanged&&i.onScaleChanged(i.scale)})),i.resizeObserver.observe(i.svg.parentNode))})),q(U(i),"getSVGPoint",(function(e){var t=i.svg.createSVGPoint();if(X){var n=i.svg.getBoundingClientRect(),r=e.clientX-n.x,o=e.clientY-n.y,a=i.svg.getBoundingClientRect(),u=a.left,c=a.top;return t.x=r+u,t.y=o+c,t.matrixTransform(i.g.getScreenCTM().inverse())}return t.x=e.offsetX,t.y=e.offsetY,t.matrixTransform(i.g.getCTM().inverse())})),q(U(i),"drawHandle",(function(e,t){var n=document.createElementNS(a,"g");n.setAttribute("class","a9s-handle");var r=document.createElementNS(a,"g"),o=function(n){var r=document.createElementNS(a,"circle");return r.setAttribute("cx",e),r.setAttribute("cy",t),r.setAttribute("r",n),r},u=i.config.handleRadius||6,c=o(u);c.setAttribute("class","a9s-handle-inner");var l=o(u+1);return l.setAttribute("class","a9s-handle-outer"),r.appendChild(l),r.appendChild(c),n.appendChild(r),n})),q(U(i),"setHandleXY",(function(e,t,n){var r=e.querySelector(".a9s-handle-inner");r.setAttribute("cx",t),r.setAttribute("cy",n);var o=e.querySelector(".a9s-handle-outer");o.setAttribute("cx",t),o.setAttribute("cy",n)})),q(U(i),"getHandleXY",(function(e){var t=e.querySelector(".a9s-handle-outer");return{x:parseFloat(t.getAttribute("cx")),y:parseFloat(t.getAttribute("cy"))}})),q(U(i),"scaleHandle",(function(e){var t=e.querySelector(".a9s-handle-inner"),n=e.querySelector(".a9s-handle-outer"),r=i.scale*(i.config.handleRadius||6);t.setAttribute("r",r),n.setAttribute("r",r)})),i.svg=e.closest("svg"),i.g=e,i.config=r,i.env=o,i.scale=1;var u=o.image;return(u instanceof Element||u instanceof HTMLDocument)&&i.enableResponsive(),i}return D(n,[{key:"destroy",value:function(){this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=null}}]),n}(o()),V=function(e){H(n,e);var t=L(n);function n(e,r,o){var i;return T(this,n),q(U(i=t.call(this,e,r,o)),"attachListeners",(function(e){var t=e.mouseMove,n=e.mouseUp,r=e.dblClick;t&&(i.mouseMove=function(e){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.started||(i.emit("startSelection",{x:r,y:o}),i.started=!0),t(r,o,e)},i.svg.addEventListener("mousemove",i.mouseMove)),n&&(i.mouseUp=function(e){if(0===e.button){var t=i.getSVGPoint(e),r=t.x,o=t.y;n(r,o,e)}},document.addEventListener("mouseup",i.mouseUp)),r&&(i.dblClick=function(e){var t=i.getSVGPoint(e),n=t.x,o=t.y;r(n,o,e)},document.addEventListener("dblclick",i.dblClick))})),q(U(i),"detachListeners",(function(){i.mouseMove&&i.svg.removeEventListener("mousemove",i.mouseMove),i.mouseUp&&document.removeEventListener("mouseup",i.mouseUp),i.dblClick&&document.removeEventListener("dblclick",i.dblClick)})),q(U(i),"start",(function(e,t){var n=i.getSVGPoint(e),r=n.x,o=n.y;i.startDrawing(r,o,t,e)})),q(U(i),"startDrawing",(function(e){throw new Error(F)})),q(U(i),"createEditableShape",(function(e,t){throw new Error(F)})),i.started=!1,i}return D(n,[{key:"isDrawing",get:function(){throw new Error(F)}}]),n}(Y);function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function W(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function $(e,t){if(t&&("object"===z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return K(e)}function K(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e){return J=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},J(e)}V.supports=function(e){throw new Error(F)};var Q="An implementation is missing",ee=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=J(r);if(o){var n=J(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return $(this,e)});function a(e,t,n,r){var o,u,c,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),console.log("constructing editable shape!"),l=function(e){throw new Error(Q)},(c="updateState")in(u=K(o=i.call(this,t,n,r)))?Object.defineProperty(u,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):u[c]=l,o.annotation=e,o}return t=a,(n=[{key:"element",get:function(){throw new Error(Q)}}])&&W(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(Y);function te(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ne=function(e,t){var n=e.selector("FragmentSelector");if(null!=n&&n.conformsTo.startsWith("http://www.w3.org/TR/media-frags")){var r=n.value,o=r.includes(":")?r.substring(r.indexOf("=")+1,r.indexOf(":")):"pixel",i=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?te(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((r.includes(":")?r.substring(r.indexOf(":")+1):r.substring(r.indexOf("=")+1)).split(",").map(parseFloat),4),a=i[0],u=i[1],c=i[2],l=i[3];return"percent"===o.toLowerCase()&&(a=a*t.naturalWidth/100,u=u*t.naturalHeight/100,c=c*t.naturalWidth/100,l=l*t.naturalHeight/100),{x:a,y:u,w:c,h:l}}};function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ae=function(e,t,n,r){return oe(oe({},function(e,t,n,r,o,i){return"percent"===(null==i?void 0:i.toLowerCase())?function(e,t,n,r,o){var i=e/o.naturalWidth*100,a=t/o.naturalHeight*100,u=0/o.naturalWidth*100,c=0/o.naturalHeight*100;return{source:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=percent:".concat(i,",").concat(a,",").concat(u,",").concat(c)}}}(e,t,0,0,o):function(e,t,n,r,o){return{source:null==o?void 0:o.src,selector:{type:"FragmentSelector",conformsTo:"http://www.w3.org/TR/media-frags/",value:"xywh=pixel:".concat(e,",").concat(t,",").concat(0,",").concat(0)}}}(e,t,0,0,o)}(e,t,0,0,n,r)),{},{renderedVia:{name:"point"}})};function ue(e){return ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ue(e)}function ce(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(){return le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=se(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},le.apply(this,arguments)}function se(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ye(e)););return e}function fe(e,t){return fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fe(e,t)}function pe(e,t){if(t&&("object"===ue(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return de(e)}function de(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ye(e){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ye(e)}function be(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var he=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fe(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ye(r);if(o){var n=ye(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return pe(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),be(de(o=i.call(this,e,t,n,r)),"onScaleChanged",(function(){return o.scaleHandle(o.point)})),be(de(o),"onGrab",(function(){o.isGrabbed=!0})),be(de(o),"onMouseMove",(function(e){if(0===e.button&&o.isGrabbed){var t=o.getSVGPoint(e),n=t.x,r=t.y;o.setHandleXY(o.point,n,r);var i=ae(n,r,o.env.image,o.config.fragmentUnit);o.emit("update",i)}})),be(de(o),"onMouseUp",(function(){o.isGrabbed=!1})),be(de(o),"updateState",(function(e){var t=ne(e,o.env.image),n=t.x,r=t.y;o.setHandleXY(o.point,n,r)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp);var c=ne(e,r.image),l=c.x,s=c.y;return o.container=document.createElementNS(a,"g"),o.elementGroup=document.createElementNS(a,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.point=o.drawHandle(l,s),o.point.addEventListener("mousedown",o.onGrab),o.elementGroup.appendChild(o.point),o.container.appendChild(o.elementGroup),t.appendChild(o.container),o.isGrabbed=!1,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.svg.removeEventListener("mousemove",this.onMouseMove),this.svg.removeEventListener("mouseup",this.onMouseUp),this.container.parentNode.removeChild(this.container),le(ye(u.prototype),"destroy",this).call(this)}}])&&ce(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(ee);function ve(e){return ve="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ve(e)}function ge(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function we(e,t){if(t&&("object"===ve(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Oe(e)}function Oe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Se(e){return Se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Se(e)}function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Pe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Se(r);if(o){var n=Se(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return we(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),je(Oe(r=i.call(this,e,t,n)),"startDrawing",(function(e,t,n,o){var i,a=null===(i=o.target.closest(".a9s-annotation"))||void 0===i?void 0:i.annotation;if(a&&function(e){var t;return"point"===(null===(t=e.target.renderedVia)||void 0===t?void 0:t.name)}(a))r.emit("cancel");else{var u=r.drawHandle(e,t);r.scaleHandle(u),r.g.appendChild(u),u.annotation=new _(ae(e,t,r.env.image,r.config.fragmentUnit)),r.emit("complete",u)}})),je(Oe(r),"stop",(function(){})),je(Oe(r),"createEditableShape",(function(e){return new he(e,r.g,r.config,r.env)})),r}return t=a,(n=[{key:"isDrawing",get:function(){return!1}}])&&ge(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(V);Pe.identifier="point",Pe.supports=function(e){return!1};var Ae=function(e){var t=function(e){Array.from(e.attributes).forEach((function(t){t.name.startsWith("on")&&e.removeAttribute(t.name)}))},n=e.getElementsByTagName("script");return Array.from(n).reverse().forEach((function(e){return e.parentNode.removeChild(e)})),t(e),Array.from(e.querySelectorAll("*")).forEach(t),e},Ee=function(e){var t,n,r=e.selector("SvgSelector");if(r){var o=new DOMParser,i=r.value,u=o.parseFromString(i,"image/svg+xml"),c=u.lookupPrefix(a),l=u.lookupNamespaceURI(null);return c||l?Ae(u).firstChild:Ae((t=u,n=(new XMLSerializer).serializeToString(t.documentElement).replace("<svg>",'<svg xmlns="'.concat(a,'">')),(new DOMParser).parseFromString(n,"image/svg+xml").documentElement)).firstChild}},xe=function(e){var t=Ee(e),n=document.createElementNS(a,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},Ce=function(e,t){var n=e.querySelector(".a9s-inner").cloneNode(!0);n.removeAttribute("class"),n.removeAttribute("xmlns");var r=n.outerHTML||(new XMLSerializer).serializeToString(n);return r=r.replace(' xmlns="'.concat(a,'"'),""),{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:"<svg>".concat(r,"</svg>")}}},Me=function(e,t,n,r){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("r",r)},Re=function(e,t,n,r){var o=e.querySelector(".a9s-inner"),i=e.querySelector(".a9s-outer");Me(o,t,n,r),Me(i,t,n,r)},_e=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),r:parseFloat(t.getAttribute("r"))}};function ke(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ge=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Te(this,"redraw",(function(){var e=_e(r.circle),t=e.cx,n=e.cy,o=e.r,i=t+o>r.w?r.w-o:t,a=n+o>r.h?r.h-o:n+o;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(i," ").concat(a," a ").concat(o," ").concat(o," 0 1 1 1 0"))})),Te(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.circle=n;var o=_e(this.circle),i=o.cx,u=o.cy,c=o.r,l=i+c>this.w?this.w-c:i,s=u+c>this.h?this.h-c:u+c;this.mask=document.createElementNS(a,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(l," ").concat(s," a ").concat(c," ").concat(c," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&ke(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function De(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ne=function(){function e(t,n,r,o){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),He(this,"dragTo",(function(e,t){var n=i.env.image,r=n.naturalWidth,o=n.naturalHeight;i.group.style.display=null;var a=e-i.anchor[0],u=t-i.anchor[1],c=Math.max(1,Math.pow(Math.pow(a,2)+Math.pow(u,2),.5)/2),l=i.anchor[0]+a/2,s=i.anchor[1]+u/2;l-c<0||l+c>r||s-c<0||s+c>o||(Re(i.circle,l,s,c),i.mask.redraw())})),He(this,"getBoundingClientRect",(function(){return i.circle.getBoundingClientRect()})),He(this,"toSelection",(function(){return new _(Ce(i.group,i.env.image))})),He(this,"destroy",(function(){i.group.parentNode.removeChild(i.group),i.mask=null,i.circle=null,i.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(a,"g"),this.circle=function(e,t,n){var r=document.createElementNS(a,"g"),o=document.createElementNS(a,"circle"),i=document.createElementNS(a,"circle");return i.setAttribute("class","a9s-inner"),Me(i,e,t,2),o.setAttribute("class","a9s-outer"),Me(o,e,t,2),r.appendChild(o),r.appendChild(i),r}(t,n),this.circle.setAttribute("class","a9s-selection"),this.mask=new Ge(o.image,this.circle),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.circle),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.circle}}])&&De(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Le(e){return function(e){if(Array.isArray(e))return Be(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Be(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Be(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ue=/firefox/i.test(navigator.userAgent),Ie=function(e,t,n,r,o){e.setAttribute("width",r),e.setAttribute("height",o),Ue?(e.setAttribute("x",0),e.setAttribute("y",0),e.setAttribute("transform","translate(".concat(t,", ").concat(n,")"))):(e.setAttribute("x",t),e.setAttribute("y",n))},qe=function(e,t,n){if(console.log("formatters",n),!n)return e;var r=n.reduce((function(e,n){var r=n(t);if(console.log("formating res",r,n,t.body),!r)return e;if("string"==typeof r||r instanceof String)e.className=e.className?"".concat(e.className," ").concat(r):r;else if(r.nodeType===Node.ELEMENT_NODE)e.elements=e.elements?[].concat(Le(e.elements),[r]):[r];else{var o=r.className,i=r.style,a=r.element;o&&(e.className=e.className?"".concat(e.className," ").concat(o):o),i&&(e.style=e.style?"".concat(e.style," ").concat(i):i),a&&(e.elements=e.elements?[].concat(Le(e.elements),[a]):[a])}for(var u in r)r.hasOwnProperty(u)&&u.startsWith("data-")&&(e[u]=r[u]);return e}),{}),o=r.className,i=r.style,u=r.elements;if(o&&c(e,o),i){var l=e.querySelector(".a9s-outer"),s=e.querySelector(".a9s-inner");l&&s?(l.setAttribute("style","display:none"),s.setAttribute("style",i)):e.setAttribute("style",i)}for(var f in u&&u.forEach((function(t){return function(e,t){var n=t.getBBox(),r=n.x,o=n.y,i=n.width,u=n.height,c=document.createElementNS(a,"svg");c.setAttribute("class","a9s-formatter-el"),Ie(c,r,o,i,u);var l=document.createElementNS(a,"g");l.appendChild(e),c.appendChild(l),t.append(c)}(t,e)})),r)r.hasOwnProperty(f)&&f.startsWith("data-")&&e.setAttribute(f,r[f])},Fe=function(e,t,n,r,o){var i=e.querySelector(".a9s-formatter-el");i&&Ie(i,t,n,r,o)};function Xe(e){return Xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Xe(e)}function Ye(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ve(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ze(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function We(){return We="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Ze(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},We.apply(this,arguments)}function Ze(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Qe(e)););return e}function $e(e,t){return $e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$e(e,t)}function Ke(e,t){if(t&&("object"===Xe(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Je(e)}function Je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Qe(e){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Qe(e)}function et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$e(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Qe(r);if(o){var n=Qe(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ke(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),et(Je(o=i.call(this,e,t,n,r)),"setSize",(function(e,t,n){Re(o.circle,e,t,n),o.mask.redraw(),Fe(o.elementGroup,e,t,n,n);var r=Ye(o.handles,4),i=r[0],a=r[1],u=r[2],c=r[3];o.setHandleXY(i,e,t-n),o.setHandleXY(a,e+n,t),o.setHandleXY(u,e,t+n),o.setHandleXY(c,e-n,t)})),et(Je(o),"stretchCorners",(function(e,t,n){var r,i=o.getHandleXY(t),a=n.x,u=n.y,c=0,l=0;0==e||2==e?(a=i.x,l=u-i.y,r=Math.abs(l)/2):(u=i.y,c=a-i.x,r=Math.abs(c)/2);var s=c>0?i.x:a,f=l>0?i.y:u,p=s+Math.abs(c)/2,d=f+Math.abs(l)/2;if(Re(o.circle,p,d,r),o.mask.redraw(),Fe(o.elementGroup,p,d,r,r),0==e||2==e){var y=0,b=2;(0==e&&l>0||2==e&&l<0)&&(y=2,b=0),o.setHandleXY(o.handles[y],p,d-r),o.setHandleXY(o.handles[b],p,d+r),o.setHandleXY(o.handles[1],p+r,d),o.setHandleXY(o.handles[3],p-r,d)}else{var h=3,v=1;(1==e&&c>0||3==e&&c<0)&&(h=1,v=3),o.setHandleXY(o.handles[h],p+r,d),o.setHandleXY(o.handles[v],p-r,d),o.setHandleXY(o.handles[0],p,d-r),o.setHandleXY(o.handles[2],p,d+r)}})),et(Je(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=_e(o.circle),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),et(Je(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.circle){var r=_e(o.circle).r,i=o.env.image,a=i.naturalWidth,u=i.naturalHeight,c=Math.max(t(n.x-o.grabbedAt.x,a-r),r),l=Math.max(t(n.y-o.grabbedAt.y,u-r),r);o.setSize(c,l,r),o.emit("update",Ce(o.circle,o.env.image))}else{var s=o.handles.indexOf(o.grabbedElem),f=s<2?o.handles[s+2]:o.handles[s-2];o.stretchCorners(s,f,n),o.emit("update",Ce(o.circle,o.env.image))}}})),et(Je(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),et(Je(o),"updateState",(function(e){var t=Ee(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("r"));o.setSize(n,r,i)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(a,"g"),o.circle=xe(e),o.circle.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.circle)),o.mask=new Ge(r.image,o.circle),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(a,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.circle);var c=_e(o.circle),l=c.cx,s=c.cy,f=c.r;return o.handles=[[l,s-f],[l+f,s],[l,s+f],[l-f,s]].map((function(e){var t=Ye(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),qe(o.circle,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),We(Qe(u.prototype),"destroy",this).call(this)}}])&&ze(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(ee);function nt(e){return nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},nt(e)}function rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ot(e,t){return ot=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ot(e,t)}function it(e,t){if(t&&("object"===nt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return at(e)}function at(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ut(e)}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ot(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ut(r);if(o){var n=ut(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return it(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),ct(at(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new Ne(e,t,r.g,r.env)})),ct(at(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),ct(at(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),ct(at(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),ct(at(r),"createEditableShape",(function(e){return new tt(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&rt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(V);lt.identifier="circle",lt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<circle/g)};var st=function(e,t,n,r,o){e.setAttribute("cx",t),e.setAttribute("cy",n),e.setAttribute("rx",r),e.setAttribute("ry",o)},ft=function(e,t,n,r,o){var i=e.querySelector(".a9s-inner"),a=e.querySelector(".a9s-outer");st(i,t,n,r,o),st(a,t,n,r,o)},pt=function(e){var t=e.querySelector(".a9s-outer");return{cx:parseFloat(t.getAttribute("cx")),cy:parseFloat(t.getAttribute("cy")),rx:parseFloat(t.getAttribute("rx")),ry:parseFloat(t.getAttribute("ry"))}};function dt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function yt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var bt=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),yt(this,"redraw",(function(){var e=pt(r.ellipse),t=e.cx,n=e.cy,o=e.rx,i=e.ry,a=n+i;r.mask.setAttribute("d","M0 0 h".concat(r.w," v").concat(r.h," h-").concat(r.w," z M").concat(t," ").concat(a," a ").concat(o," ").concat(i," 0 1 1 1 0"))})),yt(this,"destroy",(function(){return r.mask.parentNode.removeChild(r.mask)})),this.w=t.naturalWidth,this.h=t.naturalHeight,this.ellipse=n;var o=pt(this.ellipse),i=o.cx,u=o.cy,c=o.rx,l=o.ry,s=u+l;this.mask=document.createElementNS(a,"path"),this.mask.setAttribute("fill-rule","evenodd"),this.mask.setAttribute("class","a9s-selection-mask"),this.mask.setAttribute("d","M0 0 h".concat(this.w," v").concat(this.h," h-").concat(this.w," z M").concat(i," ").concat(s," a ").concat(c," ").concat(l," 0 1 1 1 0"))}var t,n;return t=e,(n=[{key:"element",get:function(){return this.mask}}])&&dt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ht(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gt=function(){function e(t,n,r,o){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),vt(this,"dragTo",(function(e,t){i.group.style.display=null;var n=e-i.anchor[0],r=t-i.anchor[1],o=n>0?i.anchor[0]+n/2:e+n/2,a=r>0?i.anchor[1]+r/2:t+r/2,u=Math.abs(n/2),c=Math.abs(r/2);ft(i.ellipse,o,a,u,c),i.mask.redraw()})),vt(this,"getBoundingClientRect",(function(){return i.ellipse.getBoundingClientRect()})),vt(this,"toSelection",(function(){return new _(Ce(i.group,i.env.image))})),vt(this,"destroy",(function(){i.group.parentNode.removeChild(i.group),i.mask=null,i.ellipse=null,i.group=null})),this.anchor=[t,n],this.env=o,this.group=document.createElementNS(a,"g"),this.ellipse=function(e,t,n,r){var o=document.createElementNS(a,"g"),i=document.createElementNS(a,"ellipse"),u=document.createElementNS(a,"ellipse");return i.setAttribute("class","a9s-inner"),st(i,e,t,2,r),u.setAttribute("class","a9s-outer"),st(u,e,t,2,r),o.appendChild(u),o.appendChild(i),o}(t,n),this.ellipse.setAttribute("class","a9s-selection"),this.mask=new bt(o.image,this.ellipse),this.group.style.pointerEvents="none",this.group.style.display="none",this.group.appendChild(this.mask.element),this.group.appendChild(this.ellipse),r.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.ellipse}}])&&ht(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function mt(e){return mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mt(e)}function wt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Ot(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ot(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function St(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function jt(){return jt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Pt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},jt.apply(this,arguments)}function Pt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ct(e)););return e}function At(e,t){return At=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},At(e,t)}function Et(e,t){if(t&&("object"===mt(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return xt(e)}function xt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ct(e){return Ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ct(e)}function Mt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&At(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ct(r);if(o){var n=Ct(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Et(this,e)});function u(e,t,n,r){var o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Mt(xt(o=i.call(this,e,t,n,r)),"setSize",(function(e,t,n,r){ft(o.ellipse,e,t,n,r),o.mask.redraw(),Fe(o.elementGroup,e,t,n,r);var i=wt(o.handles,4),a=i[0],u=i[1],c=i[2],l=i[3];o.setHandleXY(a,e,t-r),o.setHandleXY(u,e+n,t),o.setHandleXY(c,e,t+r),o.setHandleXY(l,e-n,t)})),Mt(xt(o),"stretchCorners",(function(e,t,n,r){var i=o.getHandleXY(t),a=o.getHandleXY(n),u=r.x,c=r.y,l=0,s=0;0==e||2==e?u=i.x:c=i.y;var f=u-i.x,p=c-i.y,d=f>0?i.x:u,y=p>0?i.y:c,b=Math.abs(f),h=Math.abs(p),v=d+b/2,g=y+h/2;if(l=b/2,s=h/2,0==e||2==e?l=Math.abs(i.x-a.x):s=Math.abs(i.y-a.y),ft(o.ellipse,v,g,l,s),o.mask.redraw(),Fe(o.elementGroup,v,g,l,s),0==e||2==e){var m=0,w=2;(0==e&&p>0||2==e&&p<0)&&(m=2,w=0),o.setHandleXY(o.handles[m],v,g-s),o.setHandleXY(o.handles[w],v,g+s),o.setHandleXY(o.handles[1],v+l,g),o.setHandleXY(o.handles[3],v-l,g)}else{var O=3,S=1;(1==e&&f>0||3==e&&f<0)&&(O=1,S=3),o.setHandleXY(o.handles[O],v+l,g),o.setHandleXY(o.handles[S],v-l,g),o.setHandleXY(o.handles[0],v,g-s),o.setHandleXY(o.handles[2],v,g+s)}})),Mt(xt(o),"onGrab",(function(e){return function(t){o.grabbedElem=e;var n=o.getSVGPoint(t),r=pt(o.ellipse),i=r.cx,a=r.cy;o.grabbedAt={x:n.x-i,y:n.y-a}}})),Mt(xt(o),"onMouseMove",(function(e){var t=function(e,t){return e<0?0:e>t?t:e};if(o.grabbedElem){var n=o.getSVGPoint(e);if(o.grabbedElem===o.ellipse){var r=pt(o.ellipse),i=r.rx,a=r.ry,u=o.env.image,c=u.naturalWidth,l=u.naturalHeight,s=t(n.x-o.grabbedAt.x,c-i),f=t(n.y-o.grabbedAt.y,l-a);o.setSize(s,f,i,a),o.emit("update",Ce(o.ellipse,o.env.image))}else{var p=o.handles.indexOf(o.grabbedElem),d=p<2?o.handles[p+2]:o.handles[p-2],y=o.handles[(p+3)%4];o.stretchCorners(p,d,y,n),o.emit("update",Ce(o.ellipse,o.env.image))}}})),Mt(xt(o),"onMouseUp",(function(){o.grabbedElem=null,o.grabbedAt=null})),Mt(xt(o),"updateState",(function(e){var t=Ee(e),n=parseFloat(t.getAttribute("cx")),r=parseFloat(t.getAttribute("cy")),i=parseFloat(t.getAttribute("rx")),a=parseFloat(t.getAttribute("ry"));o.setSize(n,r,i,a)})),o.svg.addEventListener("mousemove",o.onMouseMove),o.svg.addEventListener("mouseup",o.onMouseUp),o.containerGroup=document.createElementNS(a,"g"),o.ellipse=xe(e),o.ellipse.querySelector(".a9s-inner").addEventListener("mousedown",o.onGrab(o.ellipse)),o.mask=new bt(r.image,o.ellipse),o.containerGroup.appendChild(o.mask.element),o.elementGroup=document.createElementNS(a,"g"),o.elementGroup.setAttribute("class","a9s-annotation editable selected"),o.elementGroup.appendChild(o.ellipse);var c=pt(o.ellipse),l=c.cx,s=c.cy,f=c.rx,p=c.ry;return o.handles=[[l,s-p],[l+f,s],[l,s+p],[l-f,s]].map((function(e){var t=wt(e,2),n=t[0],r=t[1],i=o.drawHandle(n,r);return i.addEventListener("mousedown",o.onGrab(i)),o.elementGroup.appendChild(i),i})),o.containerGroup.appendChild(o.elementGroup),t.appendChild(o.containerGroup),qe(o.ellipse,e,n.formatter),o.grabbedElem=null,o.grabbedAt=null,o}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}},{key:"destroy",value:function(){this.containerGroup.parentNode.removeChild(this.containerGroup),jt(Ct(u.prototype),"destroy",this).call(this)}}])&&St(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(ee);function _t(e){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_t(e)}function kt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Tt(e,t){return Tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Tt(e,t)}function Gt(e,t){if(t&&("object"===_t(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Dt(e)}function Dt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ht(e){return Ht=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ht(e)}function Nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Lt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tt(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ht(r);if(o){var n=Ht(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Gt(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Nt(Dt(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp}),r.rubberband=new gt(e,t,r.g,r.env)})),Nt(Dt(r),"stop",(function(){r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Nt(Dt(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo(e,t)})),Nt(Dt(r),"onMouseUp",(function(){r.detachListeners(),r.started=!1;var e=r.rubberband.getBoundingClientRect(),t=e.width,n=e.height,o=r.config.minSelectionWidth||4,i=r.config.minSelectionHeight||4;if(t>=o&&n>=i){var a=r.rubberband.element;a.annotation=r.rubberband.toSelection(),r.emit("complete",a)}else r.emit("cancel");r.stop()})),Nt(Dt(r),"createEditableShape",(function(e){return new Rt(e,r.g,r.config,r.env)})),r.rubberband=null,r}return t=a,(n=[{key:"isDrawing",get:function(){return null!=this.rubberband}}])&&kt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(V);function Bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ut(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function It(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Lt.identifier="ellipse",Lt.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<ellipse/g)};var qt=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),It(this,"setPoints",(function(e){var t=e.map((function(e){return"L".concat(e[0]," ").concat(e[1])})).join(" ");t="M"+t.substring(1),o.outer.setAttribute("d",t),o.inner.setAttribute("d",t)})),It(this,"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),It(this,"dragTo",(function(e){o.group.style.display=null,o.addPoint(e)})),It(this,"addPoint",(function(e){var t;o.points=[].concat(function(e){if(Array.isArray(e))return Bt(e)}(t=o.points)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return Bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bt(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[e]),o.setPoints(o.points)})),It(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.freehand=null,o.group=null})),It(this,"toSelection",(function(){return new _(Ce(o.group,o.env.image))})),this.points=[t],this.env=r,this.group=document.createElementNS(a,"g"),this.freehand=document.createElementNS(a,"g"),this.freehand.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(a,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(a,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.freehand.appendChild(this.outer),this.freehand.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.freehand),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.freehand}}])&&Ut(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Ft(e){return Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(e)}function Xt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Yt(e,t){return Yt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Yt(e,t)}function Vt(e,t){if(t&&("object"===Ft(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return zt(e)}function zt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wt(){return Wt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Zt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Wt.apply(this,arguments)}function Zt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$t(e)););return e}function $t(e){return $t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$t(e)}function Kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jt=function(e){var t=e.getAttribute("d").split("L"),n=[];if(t.length>0){var r=t[0].substring(1).trim().split(" ");n.push({x:parseFloat(r[0]),y:parseFloat(r[1])});for(var o=1;o<t.length;o++)r=t[o].trim().split(" "),n.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return n},Qt=function(e){return e.querySelector(".a9s-inner").getBBox()},en=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Yt(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=$t(r);if(o){var n=$t(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Vt(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Kt(zt(c=i.call(this,e,t,n,r)),"setPoints",(function(e){var t=function(e){return Math.round(10*e)/10},n=e.map((function(e){return"L".concat(t(e.x)," ").concat(t(e.y))})).join(" ");n="M"+n.substring(1),c.shape.querySelector(".a9s-inner").setAttribute("d",n);var r=c.shape.querySelector(".a9s-outer");r.setAttribute("d",n);var o=r.getBBox(),i=o.x,a=o.y,u=o.width,l=o.height;Fe(c.elementGroup,i,a,u,l)})),Kt(zt(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),Kt(zt(c),"onMouseMove",(function(e){var t=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t};if(c.grabbedElem){var n=c.getSVGPoint(e),r=Qt(c.shape),o=r.x,i=r.y,a=r.width,u=r.height;if(c.grabbedElem===c.shape){var l=c.env.image,s=l.naturalWidth,f=l.naturalHeight,p=t(o,n.x-c.grabbedAt.x,s-a),d=t(i,n.y-c.grabbedAt.y,f-u),y=c.shape.querySelector(".a9s-inner"),b=Jt(y).map((function(e){return{x:e.x+p,y:e.y+d}}));c.grabbedAt=n,c.setPoints(b),c.emit("update",Ce(c.shape,c.env.image))}}})),Kt(zt(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),Kt(zt(c),"updateState",(function(e){var t=Jt(Ee(e));c.setPoints(t)})),Kt(zt(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Wt((o=zt(c),$t(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(a,"g"),c.shape=xe(e),c.elementGroup=document.createElementNS(a,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape),c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),qe(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var l=Qt(c.shape);return l.x,l.y,l.width,l.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&Xt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(ee);function tn(e){return tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tn(e)}function nn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rn(e,t){return rn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rn(e,t)}function on(e,t){if(t&&("object"===tn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return an(e)}function an(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function un(e){return un=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},un(e)}function cn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ln=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rn(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=un(r);if(o){var n=un(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return on(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),cn(an(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new qt([e,t],r.g,r.env)})),cn(an(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),cn(an(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),cn(an(r),"onMouseUp",(function(e,t){r.onDblClick(e,t)})),cn(an(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]),r.detachListeners();var n=r.rubberband.getBoundingClientRect(),o=n.width,i=n.height,a=r.config.minSelectionWidth||4,u=r.config.minSelectionHeight||4;if(o>=a||i>=u){var c=r.rubberband.element;c.annotation=r.rubberband.toSelection(),r.emit("complete",c)}else r.emit("cancel");r.stop()})),cn(an(r),"createEditableShape",(function(e){return new en(e,r.g,r.config,r.env)})),r._isDrawing=!1,r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&nn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(V);function sn(e){return function(e){if(Array.isArray(e))return dn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||pn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=pn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function pn(e,t){if(e){if("string"==typeof e)return dn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dn(e,t):void 0}}function dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}ln.identifier="freehand",ln.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return(null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<path*/g))&&!n.value.toUpperCase().includes("Z")};var hn=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),bn(this,"setPoints",(function(e){var t,n="",r=fn(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a="";if(i.length>0){var u,c=fn(i);try{for(c.s();!(u=c.n()).done;){var l=u.value;l&&(a+=""===a?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(e){c.e(e)}finally{c.f()}n+=a}}}catch(e){r.e(e)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),bn(this,"getBoundingClientRect",(function(){console.log("getBoundingClientRect",o.outer),o.outer.getBoundingClientRect()})),bn(this,"dragTo",(function(e){o.group.style.display=null;var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(sn(t),[e,t[0]]);n.push(r),o.setPoints(n)})),bn(this,"addPoint",(function(e){if(o.points[o.points.length-1].length>0){var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=t[t.length-1];Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(sn(t),[e,t[0]]),o.setPoints(o.points))}else o.points[o.points.length-1]=[e,e],o.setPoints(o.points)})),bn(this,"undo",(function(){console.log("last",o.points[o.points.length-1].length),o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop()})),bn(this,"newPart",(function(){o.points.push([])})),bn(this,"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),bn(this,"toSelection",(function(){return new _(Ce(o.group,o.env.image))})),this.points=[],this.points.push([t,t]),this.env=r,this.group=document.createElementNS(a,"g"),this.multipolygon=document.createElementNS(a,"g"),this.multipolygon.setAttribute("class","a9s-selection"),this.outer=document.createElementNS(a,"path"),this.outer.setAttribute("class","a9s-outer"),this.inner=document.createElementNS(a,"path"),this.inner.setAttribute("class","a9s-inner"),this.setPoints(this.points),this.multipolygon.appendChild(this.outer),this.multipolygon.appendChild(this.inner),this.group.style.display="none",this.group.appendChild(this.multipolygon),n.appendChild(this.group)}var t,n;return t=e,(n=[{key:"element",get:function(){return this.multipolygon}}])&&yn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function vn(e){return vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vn(e)}function gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(n),!0).forEach((function(t){xn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function On(e,t){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},On(e,t)}function Sn(e,t){if(t&&("object"===vn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return jn(e)}function jn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Pn(){return Pn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=An(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Pn.apply(this,arguments)}function An(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=En(e)););return e}function En(e){return En=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},En(e)}function xn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Mn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Mn(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Mn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Rn=function(e){var t,n=[],r=Cn(_n(e.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(t=r.n()).done;){var o,i=t.value,a=[],u=Cn(i);try{for(u.s();!(o=u.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};a.push(l)}}catch(e){u.e(e)}finally{u.f()}n.push(a)}}catch(e){r.e(e)}finally{r.f()}return n},_n=function(e){var t=e.split("M"),n=[];return t.forEach((function(e,t){if(e.length>0){var r=[];(e=(e=(e=(e=(e=e.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(e,t){r.push([parseFloat(e.split(",")[0]).toFixed(2).toString(),parseFloat(e.split(",")[1]).toFixed(2).toString()])})),r[0]!==r[r.length-1]&&r.push(r[0]),n.push(r)}})),n},kn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&On(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=En(r);if(o){var n=En(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Sn(this,e)});function u(e,t,n,r){var o,c;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),xn(jn(c=i.call(this,e,t,n,r)),"setPoints",(function(e){var t,n=function(e){return Math.round(10*e)/10},r="",o=Cn(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r+="M";var a,u=!0,l=Cn(i);try{for(l.s();!(a=l.n()).done;){var s=a.value;u?(u=!1,r+=s.x.toString()+","+s.y.toString()):r+=" L"+n(s.x).toString()+","+n(s.y).toString()}}catch(e){l.e(e)}finally{l.f()}r+=" Z"}}catch(e){o.e(e)}finally{o.f()}c.shape.querySelector(".a9s-inner").setAttribute("d",r);var f=c.shape.querySelector(".a9s-outer");f.setAttribute("d",r);var p=f.getBBox(),d=p.x,y=p.y,b=p.width,h=p.height;Fe(c.elementGroup,d,y,b,h)})),xn(jn(c),"onGrab",(function(e){return function(t){c.grabbedElem=e;var n=c.getSVGPoint(t);c.grabbedAt={x:n.x,y:n.y}}})),xn(jn(c),"onMouseMove",(function(e){var t;c.grabbedElem&&(t=c.getSVGPoint(e),c.grabbedElem===c.shape?function(){var e,n=t.x-c.grabbedAt.x,r=t.y-c.grabbedAt.y,o=[],i=Cn(Rn(c.shape));try{for(i.s();!(e=i.n()).done;){var a=e.value;o.push(a.map((function(e){return{x:e.x+n,y:e.y+r}})))}}catch(e){i.e(e)}finally{i.f()}c.grabbedAt=t,c.setPoints(o);for(var u=0,l=0,s=o;l<s.length;l++)s[l].forEach((function(e,t){void 0!==c.handles[u][t]&&c.setHandleXY(c.handles[u][t],e.x,e.y)})),u+=1;c.emit("update",mn(mn({},Ce(c.shape,c.env.image)),{},{renderedVia:{name:"multipolygon"}}))}():function(){var e,n=-1,r=0,o=!1,i=Cn(c.handles);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.indexOf(c.grabbedElem)>0?(n=a.indexOf(c.grabbedElem),o=!0):o||(r+=1)}}catch(e){i.e(e)}finally{i.f()}var u,l=Rn(c.shape),s=[],f=0,p=Cn(l);try{for(p.s();!(u=p.n()).done;){var d=u.value;f===r?function(){var e=[];d.forEach((function(r,o){o===n?e.push(t):e.push(r)})),s.push(e)}():s.push(d),f+=1}}catch(e){p.e(e)}finally{p.f()}c.setPoints(s),f=0;var y,b=Cn(c.handles);try{for(b.s();!(y=b.n()).done;){var h=y.value;f===r&&c.setHandleXY(h[n],t.x,t.y),f+=1}}catch(e){b.e(e)}finally{b.f()}c.emit("update",mn(mn({},Ce(c.shape,c.env.image)),{},{renderedVia:{name:"multipolygon"}}))}())})),xn(jn(c),"onMouseUp",(function(e){c.grabbedElem=null,c.grabbedAt=null})),xn(jn(c),"updateState",(function(e){var t=Rn(Ee(e));c.setPoints(t)})),xn(jn(c),"destroy",(function(){c.containerGroup.parentNode.removeChild(c.containerGroup),Pn((o=jn(c),En(u.prototype)),"destroy",o).call(o)})),c.svg.addEventListener("mousemove",c.onMouseMove),c.svg.addEventListener("mouseup",c.onMouseUp),c.containerGroup=document.createElementNS(a,"g"),c.shape=function(e){var t=Ee(e);!function(e){var t=Ee(e).getAttribute("d");_n(t)}(e);var n=document.createElementNS(a,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n}(e),c.elementGroup=document.createElementNS(a,"g"),c.elementGroup.setAttribute("class","a9s-annotation editable selected"),c.elementGroup.appendChild(c.shape);var l=Rn(c.shape);c.handles=[];var s,f=Cn(l);try{for(f.s();!(s=f.n()).done;){var p=s.value;c.handles.push(p.map((function(e){var t=c.drawHandle(e.x,e.y);return t.addEventListener("mousedown",c.onGrab(t)),c.elementGroup.appendChild(t),t})))}}catch(e){f.e(e)}finally{f.f()}c.containerGroup.appendChild(c.elementGroup),t.appendChild(c.containerGroup),qe(c.shape,e,n.formatter),c.shape.querySelector(".a9s-inner").addEventListener("mousedown",c.onGrab(c.shape));var d=c.shape.querySelector(".a9s-inner").getBBox();return d.x,d.y,d.width,d.height,c.grabbedElem=null,c.grabbedAt=null,c}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&wn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(ee);function Tn(e){return Tn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tn(e)}function Gn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Dn(e,t){return Dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Dn(e,t)}function Hn(e,t){if(t&&("object"===Tn(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Nn(e)}function Nn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ln(e){return Ln=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ln(e)}function Bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Un=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Dn(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ln(r);if(o){var n=Ln(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Hn(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),Bn(Nn(r=i.call(this,e,t,n)),"startDrawing",(function(e,t){r._isDrawing=!0,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new hn([e,t],r.g,r.env)})),Bn(Nn(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),Bn(Nn(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),Bn(Nn(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),Bn(Nn(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),Bn(Nn(r),"onMouseUp",(function(e,t,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else{var o=r.rubberband.getBoundingClientRect(),i=o.width,a=o.height,u=r.config.minSelectionWidth||4,c=r.config.minSelectionHeight||4;i>=u||a>=c?r.rubberband.addPoint([e,t]):(r.emit("cancel"),r.stop())}})),Bn(Nn(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]);var n=r.rubberband.element;n.annotation=r.rubberband.toSelection(),r.emit("complete",n),r.stop()})),Bn(Nn(r),"createEditableShape",(function(e){return new kn(e,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&r.undo(),"n"==e.key&&r.newPart()})),r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&Gn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(V);function In(e){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},In(e)}function qn(e){return function(e){if(Array.isArray(e))return Yn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Xn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Xn(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Xn(e,t){if(e){if("string"==typeof e)return Yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yn(e,t):void 0}}function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function zn(e,t){return zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},zn(e,t)}function Wn(e,t){if(t&&("object"===In(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Zn(e)}function Zn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $n(e){return $n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$n(e)}function Kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Un.identifier="multipolygon",Un.supports=function(e){var t,n;console.log("supports started");var r=e.selector("SvgSelector");if(console.log("selector",r),console.log(null===(t=r.value)||void 0===t?void 0:t.match(/^<svg.*<path d=/g)),r)return null===(n=r.value)||void 0===n?void 0:n.match(/^<svg.*<path d=/g)};var Jn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&zn(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=$n(r);if(o){var n=$n(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Wn(this,e)});function u(e,t,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),Kn(Zn(o=i.call(this,t,n,r)),"setPoints",(function(e){var t,n="",r=Fn(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a="";if(i.length>0){var u,c=Fn(i);try{for(c.s();!(u=c.n()).done;){var l=u.value;l&&(a+=""===a?"M".concat(l[0],",").concat(l[1]):" L".concat(l[0],",").concat(l[1]))}}catch(e){c.e(e)}finally{c.f()}n+=a}}}catch(e){r.e(e)}finally{r.f()}n+=" Z",o.outer.setAttribute("d",n),o.inner.setAttribute("d",n)})),Kn(Zn(o),"close",(function(){var e=new e(Ce(o.points,o.env.image));o.emit("close",{shape:o.multipolygon,multipolygon:e})})),Kn(Zn(o),"getBoundingClientRect",(function(){return o.outer.getBoundingClientRect()})),Kn(Zn(o),"dragTo",(function(e){o.group.style.display=null,o.mousepos=e;var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=o.points.slice(0,-1),r=[].concat(qn(t),[e,t[0]]);n.push(r),o.setPoints(n)})),Kn(Zn(o),"onScaleChanged",(function(e){o.scale=e;var t=o.closeHandle.querySelector(".a9s-handle-inner"),n=o.closeHandle.querySelector(".a9s-handle-outer"),r=e*(o.config.handleRadius||6);t.setAttribute("r",r),n.setAttribute("r",r)})),Kn(Zn(o),"addPoint",(function(e){if(o.isClosable())o.close();else if(o.points[o.points.length-1].length>0){var t=o.points[o.points.length-1].slice(0,o.points[o.points.length-1].length-1),n=t[t.length-1];Math.pow(e[0]-n[0],2)+Math.pow(e[1]-n[1],2)>4&&(o.points[o.points.length-1]=[].concat(qn(t),[e,t[0]]),o.setPoints(o.points))}else o.points[o.points.length-1]=[e,e],o.setPoints(o.points)})),Kn(Zn(o),"undo",(function(){o.pop()})),Kn(Zn(o),"isClosable",(function(){return o.getDistanceToStart()<6*o.scale})),Kn(Zn(o),"pop",(function(){o.points[o.points.length-1].length>2?o.points[o.points.length-1].pop():o.points.length>1&&o.points.pop(),o.setPoints(o.points),o.mask.redraw()})),Kn(Zn(o),"newPart",(function(){o.points.push([])})),Kn(Zn(o),"getDistanceToStart",(function(){if(o.points[o.points.length-1].length<3)return 1/0;var e=Math.abs(o.mousepos[0]-o.points[o.points.length-1][0][0]),t=Math.abs(o.mousepos[1]-o.points[o.points.length-1][0][1]);return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))/o.scale})),Kn(Zn(o),"destroy",(function(){o.group.parentNode.removeChild(o.group),o.multipolygon=null,o.group=null})),Kn(Zn(o),"toSelection",(function(){return new _(Ce(o.group,o.env.image))})),o.points=[],o.points.push([e,e]),o.mousepos=e,o.env=r,o.scale=1,o.group=document.createElementNS(a,"g"),o.multipolygon=document.createElementNS(a,"g"),o.multipolygon.setAttribute("class","a9s-selection a9s-multipolygon improved-polygon"),o.rubberband=document.createElementNS(a,"polygon"),o.rubberband.setAttribute("class","a9s-rubberband"),o.closeHandle=o.drawHandle(e[0],e[1]),o.closeHandle.style.display="none",o.outer=document.createElementNS(a,"path"),o.outer.setAttribute("class","a9s-outer"),o.inner=document.createElementNS(a,"path"),o.inner.setAttribute("class","a9s-inner"),o.setPoints(o.points),o.multipolygon.appendChild(o.rubberband),o.multipolygon.appendChild(o.outer),o.multipolygon.appendChild(o.inner),o.multipolygon.appendChild(o.closeHandle),o.group.style.display="none",o.group.appendChild(o.multipolygon),t.appendChild(o.group),o}return t=u,(n=[{key:"element",get:function(){return this.multipolygon}}])&&Vn(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(Y),Qn=function(e,t){for(var n,r,o,i,a=t.length,u=!1,c=e[0],l=e[1],s=0;s<a-1;++s)n=t[s][0],r=t[s+1][0],l<(o=t[s][1])!=l<(i=t[s+1][1])&&c<(r-n)*(l-o)/(i-o)+n&&(u=!u);return u};function er(e){return er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},er(e)}function tr(e){return function(e){if(Array.isArray(e))return pr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||fr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function rr(e,t){return rr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},rr(e,t)}function or(e,t){if(t&&("object"===er(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ir(e)}function ir(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ar(){return ar="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=ur(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ar.apply(this,arguments)}function ur(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=cr(e)););return e}function cr(e){return cr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},cr(e)}function lr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=fr(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function fr(e,t){if(e){if("string"==typeof e)return pr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pr(e,t):void 0}}function pr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var dr=function(e){var t=e.split("M"),n=[];return t.forEach((function(e,t){if(e.length>0){var r=[];(e=(e=(e=(e=(e=e.replace(/ Z/g,"Z")).replace(/Z /g,"Z")).replace(/Z/g,"")).replace(/L /g,"L")).replace(/ L/g,"L")).split("L").forEach((function(e,t){r.push([parseFloat(e.split(",")[0]).toFixed(2).toString(),parseFloat(e.split(",")[1]).toFixed(2).toString()])})),r[0][0]!==r[r.length-1][0]&&r[0][1]!==r[r.length-1][1]&&r.push(r[0]),n.push(r)}})),n},yr=function(e){var t,n=[],r=sr(dr(e.querySelector(".a9s-inner").attributes.d.nodeValue));try{for(r.s();!(t=r.n()).done;){var o,i=t.value,a=[],u=sr(i);try{for(u.s();!(o=u.n()).done;){var c=o.value,l={x:parseFloat(c[0]),y:parseFloat(c[1])};a.push(l)}}catch(e){u.e(e)}finally{u.f()}n.push(a)}}catch(e){r.e(e)}finally{r.f()}return n},br=function(e){var t=Ee(e);!function(e){var t=Ee(e).getAttribute("d");dr(t)}(e);var n=document.createElementNS(a,"g"),r=t.cloneNode(!0);r.setAttribute("class","a9s-inner");var o=t.cloneNode(!0);return o.setAttribute("class","a9s-outer"),n.appendChild(o),n.appendChild(r),n},hr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&rr(e,t)}(u,e);var t,n,r,o,i=(r=u,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=cr(r);if(o){var n=cr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return or(this,e)});function u(e,t,n,r){var o,f;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),lr(ir(f=i.call(this,e,t,n,r)),"createCornerHandle",(function(e){var t=f.drawHandle(e.x,e.y);return t.addEventListener("mousedown",f.onGrab(t)),t.addEventListener("click",f.onSelectCorner(t)),f.scaleHandle(t),f.elementGroup.appendChild(t),t})),lr(ir(f),"createMidpoint",(function(e,t){var n=e[t],r=t===e.length-1?e[0]:e[t+1],o=(n.x+r.x)/2,i=(n.y+r.y)/2,a=f.drawMidpoint(o,i);return a.addEventListener("mousedown",f.onGrab(a)),f.shape.appendChild(a),a})),lr(ir(f),"deleteSelected",(function(){var e=yr(f.shape);f.selected.length>0&&function(){var t,n=-1,r=[],o=[],i=sr(f.midpoints);try{for(i.s();!(t=i.n()).done;){var a=t.value,u=a.filter((function(e,t){return-1===f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)})),c=a.filter((function(e,t){return f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)>-1}));c.forEach((function(e){return e.parentNode.removeChild(e)})),u.length>2&&o.push(u)}}catch(e){i.e(e)}finally{i.f()}var l,s=sr(e);try{for(s.s();!(l=s.n()).done;){var p=l.value;n+=1;var d=p.filter((function(e,t){return-1===f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)}));d.length>2&&r.push(d)}}catch(e){s.e(e)}finally{s.f()}n=-1;var y,b=[],h=sr(f.cornerHandles);try{for(h.s();!(y=h.n()).done;){var v=y.value;n+=1;var g=v.filter((function(e,t){return-1!==f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)})),m=v.filter((function(e,t){return-1===f.selected.map((function(e){return e[0]===n&&e[1]===t})).indexOf(!0)}));m.length>2&&b.push(m),g.forEach((function(e){return e.parentNode.removeChild(e)}))}}catch(e){h.e(e)}finally{h.f()}f.midpoints=o,f.cornerHandles=b,f.selected=[],f.setPoints(r),f.emit("update",xr(r,f.env.image))}()})),lr(ir(f),"deselectCorners",(function(){return f.cornerHandles.forEach((function(e){return l(e,"selected")}))})),lr(ir(f),"destroy",(function(){f.container.parentNode.removeChild(f.container),f.svg.removeEventListener("mousemove",f.onMouseMove),f.svg.removeEventListener("mouseup",f.onMouseUp),document.body.removeEventListener("keydown",f.onKeyDown),ar((o=ir(f),cr(u.prototype)),"destroy",o).call(o)})),lr(ir(f),"drawMidpoint",(function(e,t){var n=document.createElementNS(a,"circle");return n.setAttribute("class","a9s-midpoint"),n.setAttribute("cx",e),n.setAttribute("cy",t),n.setAttribute("r",5*f.scale),n})),lr(ir(f),"onAddPoint",(function(e){var t,n=yr(f.shape),r=-1,o=-1,i=sr(f.midpoints);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(o+=1,(r=a.indexOf(f.grabbedElement))>-1)break}}catch(e){i.e(e)}finally{i.f()}var u,c=[],l=-1,s=null,p=null,d=sr(n);try{for(d.s();!(u=d.n()).done;){var y=u.value;if((l+=1)===o){var b,h=[],v=-1,g=sr(y);try{for(g.s();!(b=g.n()).done;){var m=b.value;v+=1,h.push(m),v===r&&(h.push(e),s=f.createMidpoint(y,v-1),p=f.createMidpoint(y,v))}}catch(e){g.e(e)}finally{g.f()}c.push(h)}else c.push(y)}}catch(e){d.e(e)}finally{d.f()}var w=f.createCornerHandle(e);f.cornerHandles[o]=[].concat(tr(f.cornerHandles[o].slice(0,r+1)),[w],tr(f.cornerHandles[o].slice(r+1))),f.midpoints[o]=[].concat(tr(f.midpoints[o].slice(0,r)),[s,p],tr(f.midpoints[o].slice(r+1))),f.grabbedElement.parentNode.removeChild(f.grabbedElement),f.grabbedElement=w,f.setPoints(c)})),lr(ir(f),"onGrab",(function(e){return function(t){0===t.button&&(t.stopPropagation(),f.grabbedElement=e,f.grabbedAt=f.getSVGPoint(t),f.lastMouseDown=(new Date).getTime())}})),lr(ir(f),"onKeyDown",(function(e){46===e.which&&f.deleteSelected()})),lr(ir(f),"onMoveShape",(function(e){var t,n=function(e,t,n){return e+t<0?-e:e+t>n?n-e:t},r=f.shape.querySelector(".a9s-inner").getBBox(),o=r.x,i=r.y,a=r.width,u=r.height,c=f.env.image,l=c.naturalWidth,s=c.naturalHeight,p=n(o,e.x-f.grabbedAt.x,l-a),d=n(i,e.y-f.grabbedAt.y,s-u),y=[],b=sr(yr(f.shape));try{for(b.s();!(t=b.n()).done;){var h=t.value,v=h.map((function(e){return[e.x,e.y]}));Qn([f.grabbedAt.x,f.grabbedAt.y],v)?y.push(h.map((function(e){return{x:e.x+p,y:e.y+d}}))):y.push(h)}}catch(e){b.e(e)}finally{b.f()}f.grabbedAt=e,f.setPoints(y)})),lr(ir(f),"onMoveCornerHandle",(function(e,t){var n,r=-1,o=0,i=sr(f.cornerHandles);try{for(i.s();!(n=i.n()).done;){var a=n.value;if((r=a.indexOf(f.grabbedElement))>-1)break;o+=1}}catch(e){i.e(e)}finally{i.f()}t.ctrlKey?f.selected=Array.from(new Set([].concat(tr(f.selected),[r]))):f.selected.includes(r)||(f.selected=[r]);var u,c=yr(f.shape),l=f.selected.map((function(e){var t=c[o][r],n=c[o][e];return{index:e,dx:n.x-t.x,dy:n.y-t.y}})),s=0,p=[],d=sr(yr(f.shape));try{for(d.s();!(u=d.n()).done;){var y=u.value;if(s===o){var b=y.map((function(t,n){if(n===r)return e;if(f.selected.includes(n)){var o=l.find((function(e){return e.index===n})),i=o.dx,a=o.dy;return{x:e.x+i,y:e.y+a}}return t}));p.push(b)}else p.push(y);s+=1}}catch(e){d.e(e)}finally{d.f()}f.setPoints(p)})),lr(ir(f),"onMouseMove",(function(e){if(f.grabbedElement){var t=f.getSVGPoint(e);f.grabbedElement===f.shape?f.onMoveShape(t):s(f.grabbedElement,"a9s-handle")?f.onMoveCornerHandle(t,e):s(f.grabbedElement,"a9s-midpoint")&&f.onAddPoint(t),f.emit("update",xr(yr(f.shape),f.env.image))}})),lr(ir(f),"onMouseUp",(function(e){f.grabbedElement=null,f.grabbedAt=null})),lr(ir(f),"onScaleChanged",(function(e){var t,n=sr(f.cornerHandles);try{for(n.s();!(t=n.n()).done;)t.value.map(f.scaleHandle)}catch(e){n.e(e)}finally{n.f()}var r,o=sr(f.midpoints);try{for(o.s();!(r=o.n()).done;)r.value.map((function(e){e.setAttribute("r",5*f.scale)}))}catch(e){o.e(e)}finally{o.f()}})),lr(ir(f),"onSelectCorner",(function(e){return function(t){if(!((new Date).getTime()-f.lastMouseDown>250)){var n,r=-1,o=-1,i=sr(f.cornerHandles);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(r+=1,(o=a.indexOf(e))>0)break}}catch(e){i.e(e)}finally{i.f()}null!=t&&t.ctrlKey?f.selected.map((function(e){return e[0]===r&&e[1]===o})).indexOf(!0)>-1?f.selected=f.selected.filter((function(e){return!(e[1]===o&&e[0]===r)})):f.selected=[].concat(tr(f.selected),[[r,o]]):1===f.selected.length&&f.selected[0][1]===o&&f.selected[0][0]===r?f.selected=[]:f.selected=[[r,o]],f.setPoints(yr(f.shape))}}})),lr(ir(f),"setPoints",(function(e){var t=Er(e);f.shape.querySelector(".a9s-inner").setAttribute("d",t);var n=f.shape.querySelector(".a9s-outer");n.setAttribute("d",t);var r,o=0,i=sr(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;a.forEach((function(e,t){f.setHandleXY(f.cornerHandles[o][t],e.x,e.y)}));for(var u=0;u<a.length;u++){var p=a[u],d=u===a.length-1?a[0]:a[u+1],y=(p.x+d.x)/2,b=(p.y+d.y)/2,h=f.midpoints[o][u];h.setAttribute("cx",y),h.setAttribute("cy",b)}o+=1}}catch(e){i.e(e)}finally{i.f()}var v,g=-1,m=sr(f.cornerHandles);try{for(m.s();!(v=m.n()).done;){var w=v.value;g+=1,w.forEach((function(e,t){var n=f.selected.map((function(e){return e[0]===g&&e[1]===t})).indexOf(!0)>-1;n&&!s(e,"selectedCorner")?c(e,"selectedCorner"):!n&&s(e,"selectedCorner")&&l(e,"selectedCorner")}))}}catch(e){m.e(e)}finally{m.f()}var O=n.getBBox(),S=O.x,j=O.y,P=O.width,A=O.height;Fe(f.shape,S,j,P,A)})),lr(ir(f),"updateState",(function(e){var t=br(e),n=yr(t);f.setPoints(n)})),f.svg.addEventListener("mousemove",f.onMouseMove),f.svg.addEventListener("mouseup",f.onMouseUp),document.body.addEventListener("keydown",f.onKeyDown),f.container=document.createElementNS(a,"g"),f.shape=br(e),f.shape.setAttribute("class","a9s-annotation editable selected improved-polygon"),f.elementGroup=document.createElementNS(a,"g"),f.elementGroup.setAttribute("class","a9s-annotation editable selected"),f.elementGroup.appendChild(f.shape);var p=yr(f.shape);f.cornerHandles=[],f.midpoints=[];var d,y=sr(p);try{var b=function(){var e=d.value,t=[];f.cornerHandles.push(e.map((function(n,r){return t.push(f.createMidpoint(e,r)),f.createCornerHandle(n)}))),f.midpoints.push(t)};for(y.s();!(d=y.n()).done;)b()}catch(e){y.e(e)}finally{y.f()}return f.container.appendChild(f.elementGroup),t.appendChild(f.container),qe(f.shape,e,n.formatter),f.shape.querySelector(".a9s-inner").addEventListener("mousedown",f.onGrab(f.shape)),f.grabbedElement=null,f.grabbedAt=null,f.selected=[],f.lastMouseDown=null,f}return t=u,(n=[{key:"element",get:function(){return this.elementGroup}}])&&nr(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),u}(ee);function vr(e){return vr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vr(e)}function gr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function mr(e,t){return mr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},mr(e,t)}function wr(e,t){if(t&&("object"===vr(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Or(e)}function Or(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Sr(e){return Sr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Sr(e)}function jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pr(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ar(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ar(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function Ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}i();var Er=function(e){var t,n=function(e){return Math.round(10*e)/10},r="",o=Pr(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r+="M";var a,u=!0,c=Pr(i);try{for(c.s();!(a=c.n()).done;){var l=a.value;u?(u=!1,r+=n(l.x).toString()+","+n(l.y).toString()):r+=" L"+n(l.x).toString()+","+n(l.y).toString()}}catch(e){c.e(e)}finally{c.f()}r+=" Z"}}catch(e){o.e(e)}finally{o.f()}return r},xr=function(e,t){return{source:null==t?void 0:t.src,selector:{type:"SvgSelector",value:'<svg><path d="'.concat(Er(e),'" /></svg>')}}},Cr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mr(e,t)}(a,e);var t,n,r,o,i=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Sr(r);if(o){var n=Sr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return wr(this,e)});function a(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),jr(Or(r=i.call(this,e,t,n)),"startDrawing",(function(e,t,n){r._isDrawing=!0,r._startOnSingleClick=n||!1,r.attachListeners({mouseMove:r.onMouseMove,mouseUp:r.onMouseUp,dblClick:r.onDblClick}),r.rubberband=new Jn([e,t],r.g,r.config,r.env),r.rubberband.on("close",(function(e){var t=e.shape,n=e.selection;t.annotation=n,r.emit("complete",t),r.stop()}))})),jr(Or(r),"stop",(function(){r.detachListeners(),r._isDrawing=!1,r.rubberband&&(r.rubberband.destroy(),r.rubberband=null)})),jr(Or(r),"undo",(function(){r.rubberband&&r.rubberband.undo()})),jr(Or(r),"renderDebugImages",(function(e,t,n,r,o){var i=cv.Mat.zeros(t.rows,t.cols,cv.CV_8UC3),a=new cv.Scalar(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()));cv.drawContours(i,n,-1,a,1,8,r,0);var u=document.createElement("CANVAS");u.width=e.width,u.height=e.height,cv.imshow(u,t),o.appendChild(u);var c=document.createElement("CANVAS");c.width=e.width,c.height=e.height,cv.imshow(c,i),o.appendChild(c),i.delete()})),jr(Or(r),"chunk",(function(e,t){for(var n=[],r=0;r<e.length;)n.push(e.slice(r,t+r)),r+=t;return n})),jr(Or(r),"findContourPolygon",(function(e){console.log("blubb",r.viewer.drawer);var t=r.viewer.drawer.canvas,n=cv.imread(t);console.log("src",cv.THRESH_BINARY,cv.THRESH_OTSU),cv.cvtColor(n,n,cv.COLOR_RGB2GRAY,0),cv.adaptiveThreshold(n,n,200,cv.ADAPTIVE_THRESH_GAUSSIAN_C,cv.THRESH_BINARY,5,15);var o=new cv.MatVector,i=new cv.Mat;cv.findContours(n,o,i,cv.RETR_CCOMP,cv.CHAIN_APPROX_SIMPLE),console.log("contours",o);for(var a=cv.Mat.zeros(n.cols,n.rows,cv.CV_8UC3),u=0;u<o.size();++u){var c=new cv.Scalar(Math.round(255*Math.random()),Math.round(255*Math.random()),Math.round(255*Math.random()));cv.drawContours(a,o,u,c,1,cv.LINE_8,i,100)}for(var l=new cv.MatVector,s=[],f={area:0},p=0;p<o.size();++p){var d=new cv.Mat,y=o.get(p);cv.approxPolyDP(y,d,.03,!0),s=s.concat(r.chunk(d.data32S,2)),l.push_back(d);var b=cv.contourArea(d);f.area,f={area:b,polygon:d}}var h=svgFragmentToShape(e,r.env.image);console.log("shape",h);var v=svgPathToPolygons(h);console.log("points",v),console.log("allContourPoints",s);var g,m=[],w=Pr(v);try{for(w.s();!(g=w.n()).done;){var O,S=g.value,j=[],P=Pr(S);try{for(P.s();!(O=P.n()).done;){var A,E=O.value,x={dist:5e3,point:null},C=Pr(s);try{for(C.s();!(A=C.n()).done;){var M=A.value,R=Math.sqrt(Math.pow(E[0]-M[0],2)+Math.pow(E[1]-M[1],2));R<x.dist&&(x.dist=R,x.point=M)}}catch(e){C.e(e)}finally{C.f()}x.dist<5?j.push(x.point):j.push(E)}}catch(e){P.e(e)}finally{P.f()}m.push(j)}}catch(e){w.e(e)}finally{w.f()}return console.log(r.tools.current),n.delete(),i.delete(),o.delete(),l.delete(),s})),jr(Or(r),"newPart",(function(){r.rubberband&&r.rubberband.newPart()})),jr(Or(r),"onMouseMove",(function(e,t){return r.rubberband.dragTo([e,t])})),jr(Or(r),"onMouseUp",(function(e,t,n){if(n.altKey)r.onDblClick(n);else if(n.ctrlKey)r.rubberband.undo();else{var o=r.rubberband.getBoundingClientRect(),i=o.width,a=o.height,u=r.config.minSelectionWidth||4,c=r.config.minSelectionHeight||4;i>=u||a>=c?r.rubberband.addPoint([e,t]):(r.emit("cancel"),r.stop())}})),jr(Or(r),"onScaleChanged",(function(e){r.rubberband&&r.rubberband.onScaleChanged(e)})),jr(Or(r),"onDblClick",(function(e,t){r._isDrawing=!1,r.rubberband.addPoint([e,t]);var n=r.rubberband.element;n.annotation=r.rubberband.toSelection(),r.emit("complete",n),r.stop()})),jr(Or(r),"createEditableShape",(function(e){return new hr(e,r.g,r.config,r.env)})),r._isDrawing=!1,document.addEventListener("keydown",(function(e){"z"==e.key&&e.ctrlKey&&r.undo(),"n"==e.key&&r.newPart()})),r._startOnSingleClick=!1,r}return t=a,(n=[{key:"isDrawing",get:function(){return this._isDrawing}}])&&gr(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(V);Cr.identifier="bettermultipolygon",Cr.supports=function(e){var t,n=e.selector("SvgSelector");if(n)return null===(t=n.value)||void 0===t?void 0:t.match(/^<svg.*<path d=/g)};var Mr=new Set(["point","circle","ellipse","freehand","bettermultipolygon"]);const Rr=function(e,t){var n=null!=t&&t.tools?new Set(t.tools.map((function(e){return e.toLowerCase()}))):Mr;console.log("use tools:",n),n.has("circle")&&e.addDrawingTool(lt),n.has("point")&&e.addDrawingTool(Pe),n.has("ellipse")&&e.addDrawingTool(Lt),n.has("freehand")&&e.addDrawingTool(ln),n.has("multipolygon")&&e.addDrawingTool(Un),n.has("bettermultipolygon")&&e.addDrawingTool(Cr)}})(),r.default})()}));
//# sourceMappingURL=annotorious-selector-pack.min.js.map